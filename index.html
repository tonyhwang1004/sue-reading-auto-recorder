<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실제 AI 슬라이드 자동 생성기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .title {
            font-size: 2.8em;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientFlow 3s ease-in-out infinite;
        }

        @keyframes gradientFlow {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(180deg); }
        }

        .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .description {
            font-size: 1.1em;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .api-setup {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid rgba(255, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .api-setup.configured {
            background: rgba(0, 255, 0, 0.1);
            border-color: rgba(0, 255, 0, 0.3);
        }

        .api-input {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            margin: 15px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1.1em;
        }

        .api-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .input-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            transition: all 0.3s ease;
        }

        .input-section:hover {
            border-color: rgba(0, 255, 255, 0.5);
        }

        .input-group {
            margin-bottom: 30px;
        }

        .input-label {
            font-size: 1.3em;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 10px;
            display: block;
        }

        .input-field {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            font-size: 1.1em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .input-field:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .textarea-field {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .generate-button {
            display: block;
            width: 100%;
            max-width: 500px;
            margin: 50px auto;
            padding: 25px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 300% 300%;
            border: none;
            border-radius: 25px;
            font-size: 1.8em;
            font-weight: 900;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: gradientShift 4s ease infinite;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .generate-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            animation: none;
        }

        .generate-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(0, 255, 255, 0.5);
        }

        .feature-icon {
            font-size: 3.5em;
            margin-bottom: 20px;
        }

        .feature-title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 10px;
            color: #00ffff;
        }

        .feature-desc {
            font-size: 1em;
            opacity: 0.8;
            line-height: 1.4;
        }

        .status-panel {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: none;
        }

        .status-panel.show {
            display: block;
        }

        .status-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 15px;
            color: #00ffff;
        }

        .ai-thinking {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .thinking-dots {
            display: flex;
            gap: 5px;
        }

        .thinking-dot {
            width: 12px;
            height: 12px;
            background: #00ffff;
            border-radius: 50%;
            animation: thinking 1.4s ease-in-out infinite both;
        }

        .thinking-dot:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes thinking {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .countdown {
            font-size: 4em;
            font-weight: 900;
            margin: 20px 0;
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .progress-container {
            margin: 25px 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 6px;
        }

        .progress-text {
            font-size: 1.1em;
            font-weight: 600;
        }

        .recording-status {
            display: none;
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid rgba(255, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .recording-status.active {
            display: block;
            animation: recordingPulse 1s ease-in-out infinite;
        }

        @keyframes recordingPulse {
            0%, 100% { border-color: rgba(255, 0, 0, 0.5); }
            50% { border-color: rgba(255, 0, 0, 1); }
        }

        .recording-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #ff0000;
            border-radius: 50%;
            margin-right: 10px;
            animation: blink 1s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .preview-section {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: none;
        }

        .preview-section.show {
            display: block;
        }

        .preview-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 15px;
            color: #00ffff;
            text-align: center;
        }

        .slide-preview {
            background: #000;
            border-radius: 15px;
            width: 300px;
            height: 533px;
            margin: 0 auto 20px;
            overflow: hidden;
            border: 3px solid #333;
            position: relative;
        }

        .ai-analysis {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid rgba(0, 255, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .sample-templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .template-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            border-color: #00ffff;
            transform: translateY(-5px);
        }

        .template-card.selected {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
        }

        .template-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 10px;
        }

        .template-desc {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .hidden {
            display: none !important;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .title {
                font-size: 2.2em;
            }

            .generate-button {
                font-size: 1.4em;
                padding: 20px;
            }

            .countdown {
                font-size: 3em;
            }

            .input-section {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">🤖</div>
            <h1 class="title">실제 AI 슬라이드 생성기</h1>
            <p class="subtitle">GPT-4 API로 실제 AI가 슬라이드를 분석하고 자동 생성</p>
            <p class="description">
                진짜 OpenAI GPT-4 API를 사용해서 당신의 내용을 지능적으로 분석하고, 
                11장의 전문적인 슬라이드를 자동 생성하여 완벽한 27.5초 유튜브 쇼츠 영상을 만들어드립니다.
            </p>
        </div>

        <!-- GPT API 설정 -->
        <div class="api-setup" id="apiSetup">
            <h3>🔑 OpenAI API 키 설정 (필수)</h3>
            <p>실제 GPT-4 AI를 사용하려면 OpenAI API 키가 필요합니다.</p>
            <input type="password" class="api-input" id="apiKeyInput" placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
            <br>
            <button onclick="setApiKey()" style="padding: 10px 20px; background: #00ffff; color: #000; border: none; border-radius: 10px; margin: 10px; cursor: pointer;">API 키 설정</button>
            <button onclick="showApiGuide()" style="padding: 10px 20px; background: #ff6b6b; color: white; border: none; border-radius: 10px; margin: 10px; cursor: pointer;">API 키 발급 방법</button>
            <div id="apiStatus" style="margin-top: 15px; font-weight: bold;"></div>
        </div>

        <!-- 기능 소개 -->
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">🧠</div>
                <div class="feature-title">실제 GPT-4 AI 분석</div>
                <div class="feature-desc">OpenAI의 최신 GPT-4 모델이 당신의 내용을 지능적으로 분석하고 최적의 슬라이드 구조를 생성</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🎨</div>
                <div class="feature-title">스마트 디자인 선택</div>
                <div class="feature-desc">AI가 내용의 성격을 파악해서 가장 적합한 색상, 아이콘, 레이아웃을 자동 선택</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">📊</div>
                <div class="feature-title">지능적 정보 구조화</div>
                <div class="feature-desc">연락처, 통계, 기능 등을 AI가 자동으로 분류하고 최적의 슬라이드 순서로 배치</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">⚡</div>
                <div class="feature-title">실시간 AI 생성</div>
                <div class="feature-desc">시뮬레이션이 아닌 실제 GPT API 호출로 매번 새롭고 창의적인 슬라이드 생성</div>
            </div>
        </div>

        <!-- 템플릿 선택 -->
        <div class="input-section">
            <h3 style="color: #00ffff; margin-bottom: 20px; font-size: 1.5em;">📋 AI 분석 템플릿</h3>
            <div class="sample-templates">
                <div class="template-card selected" data-template="business">
                    <div class="template-name">비즈니스</div>
                    <div class="template-desc">회사/서비스 소개, 마케팅용</div>
                </div>
                <div class="template-card" data-template="education">
                    <div class="template-name">교육</div>
                    <div class="template-desc">강의, 튜토리얼, 설명용</div>
                </div>
                <div class="template-card" data-template="product">
                    <div class="template-name">제품</div>
                    <div class="template-desc">제품 소개, 기능 설명용</div>
                </div>
                <div class="template-card" data-template="personal">
                    <div class="template-name">개인</div>
                    <div class="template-desc">자기소개, 포트폴리오용</div>
                </div>
            </div>
        </div>

        <!-- 입력 섹션 -->
        <div class="input-section">
            <div class="input-group">
                <label class="input-label">📝 제목</label>
                <input type="text" class="input-field" id="titleInput" placeholder="예: Sue Reading Club - AI 영어교육의 혁신" maxlength="100">
            </div>

            <div class="input-group">
                <label class="input-label">📄 상세 내용 (AI가 분석할 모든 정보)</label>
                <textarea class="input-field textarea-field" id="contentInput" placeholder="예: 
Sue Reading Club은 AI 기반 영어교육 서비스입니다.

주요 프로그램:
- AI 독해 시스템: 개인별 맞춤 분석으로 독해력 향상
- 스마트 속독: 과학적 훈련법으로 읽기 속도 3배 향상  
- AI 토론 클래스: AI와 함께하는 실시간 토론 학습
- 실시간 피드백: 즉석에서 제공되는 정확한 피드백
- AI 개별 분석: 학습자의 읽기 패턴 실시간 분석

성과:
- 98% 학부모 만족도
- 3.2배 읽기속도 향상

위치: 인천 연수구 송도동 해온더라운지 702호
연락처: 010-9579-4429
상담시간: 평일 09:00-18:00

특별 혜택: 첫 달 30% 할인"></textarea>
            </div>

            <div class="input-group">
                <label class="input-label">🎨 컬러 테마</label>
                <select class="input-field" id="colorTheme">
                    <option value="blue-purple">파랑-보라 (기본)</option>
                    <option value="red-orange">빨강-주황</option>
                    <option value="green-teal">초록-청록</option>
                    <option value="purple-pink">보라-분홍</option>
                    <option value="dark-neon">다크-네온</option>
                    <option value="auto">AI가 자동 선택</option>
                </select>
            </div>
        </div>

        <button class="generate-button" id="generateButton" onclick="generateAISlides()" disabled>
            🤖 실제 AI로 슬라이드 생성 시작
        </button>

        <!-- AI 분석 결과 -->
        <div class="ai-analysis hidden" id="aiAnalysis">
            <h4>🧠 AI 분석 결과:</h4>
            <div id="analysisResult"></div>
        </div>

        <!-- 미리보기 섹션 -->
        <div class="preview-section" id="previewSection">
            <div class="preview-title">📱 AI 생성 슬라이드 미리보기</div>
            <div class="slide-preview" id="slidePreview">
                <!-- AI 생성된 슬라이드 미리보기 -->
            </div>
            <button class="generate-button" onclick="startRecording()" style="max-width: 300px; font-size: 1.2em; padding: 15px;">
                🎬 영상 녹화 시작
            </button>
        </div>

        <!-- 상태 패널 -->
        <div class="status-panel" id="statusPanel">
            <div class="status-title" id="statusTitle">🤖 실제 AI 분석 중...</div>
            <div class="ai-thinking" id="aiThinking">
                <div class="thinking-dots">
                    <div class="thinking-dot"></div>
                    <div class="thinking-dot"></div>
                    <div class="thinking-dot"></div>
                </div>
            </div>
            <div class="countdown hidden" id="countdown">5</div>
            <div class="progress-container hidden" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0% 완료</div>
            </div>
            <div class="recording-status" id="recordingStatus">
                <span class="recording-dot"></span>
                <span>AI 영상 제작 중...</span>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let apiKey = '';
        let generatedSlideHTML = null;
        let slideshowWindow = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let selectedTemplate = 'business';
        let aiAnalysisResult = null;

        // API 키 설정
        function setApiKey() {
            const input = document.getElementById('apiKeyInput');
            const apiSetup = document.getElementById('apiSetup');
            const apiStatus = document.getElementById('apiStatus');
            const generateButton = document.getElementById('generateButton');
            
            apiKey = input.value.trim();
            
            if (apiKey.startsWith('sk-') && apiKey.length > 20) {
                apiSetup.classList.add('configured');
                apiStatus.innerHTML = '✅ API 키가 설정되었습니다. 이제 실제 AI 슬라이드 생성이 가능합니다!';
                apiStatus.style.color = '#00ff00';
                generateButton.disabled = false;
                generateButton.textContent = '🤖 실제 GPT-4 AI로 슬라이드 생성 시작';
                
                // API 키 저장 (세션 스토리지)
                sessionStorage.setItem('openai_api_key', apiKey);
                
                console.log('✅ OpenAI API 키 설정 완료');
            } else {
                apiStatus.innerHTML = '❌ 올바른 API 키 형식이 아닙니다. sk-로 시작하는 키를 입력해주세요.';
                apiStatus.style.color = '#ff6b6b';
            }
        }

        // API 키 발급 방법 안내
        function showApiGuide() {
            alert(`🔑 OpenAI API 키 발급 방법:

1. https://platform.openai.com 접속
2. 회원가입 또는 로그인
3. 우상단 프로필 → "View API keys" 클릭
4. "Create new secret key" 클릭
5. 생성된 키를 복사해서 위에 입력

⚠️ 주의사항:
- API 사용료: GPT-4 기준 슬라이드 1개당 약 $0.06
- 새 계정에는 $5 무료 크레딧 제공
- API 키는 안전하게 보관하세요`);
        }

        // 템플릿 선택 이벤트
        function initTemplateSelection() {
            document.querySelectorAll('.template-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedTemplate = this.dataset.template;
                    console.log('📋 템플릿 선택:', selectedTemplate);
                });
            });
        }

        // 실제 GPT API 호출
        async function callGPTAPI(prompt) {
            try {
                console.log('🤖 GPT-4 API 호출 시작...');
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: [{
                            role: "system",
                            content: `당신은 전문적인 슬라이드 구조 생성 AI입니다. 주어진 내용을 분석해서 11장의 유튜브 쇼츠용 슬라이드 구조를 JSON 형태로 생성해주세요.

각 슬라이드는 다음 형식이어야 합니다:
{
  "slideNumber": 1,
  "type": "intro|brand|feature|stats|testimonial|location|contact",
  "title": "슬라이드 제목 (25자 이내)",
  "subtitle": "부제목 또는 설명 (50자 이내)",
  "icon": "적절한 이모지 1개",
  "background": "gradient1-11 중 하나",
  "animation": "pulse|bounce|fade|glow 중 하나"
}

특별 지시사항:
1. 반드시 11장의 슬라이드 생성
2. 첫 번째는 인트로, 마지막은 연락처
3. 중간에 기능, 장점, 통계 등 배치
4. 연락처/위치 정보가 있으면 별도 슬라이드로
5. JSON 형태로만 응답 (다른 텍스트 없이)`
                        }, {
                            role: "user", 
                            content: prompt
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API 호출 실패: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                console.log('✅ GPT-4 API 응답 수신');
                
                return data.choices[0].message.content;
                
            } catch (error) {
                console.error('❌ GPT API 호출 오류:', error);
                throw error;
            }
        }

        // AI 슬라이드 생성 메인 함수
        async function generateAISlides() {
            const title = document.getElementById('titleInput').value.trim();
            const content = document.getElementById('contentInput').value.trim();
            const colorTheme = document.getElementById('colorTheme').value;

            if (!apiKey) {
                alert('먼저 OpenAI API 키를 설정해주세요!');
                return;
            }

            if (!title || !content) {
                alert('제목과 내용을 모두 입력해주세요!');
                return;
            }

            const statusPanel = document.getElementById('statusPanel');
            const statusTitle = document.getElementById('statusTitle');
            const generateButton = document.getElementById('generateButton');
            const aiThinking = document.getElementById('aiThinking');
            const aiAnalysis = document.getElementById('aiAnalysis');
            const analysisResult = document.getElementById('analysisResult');

            generateButton.disabled = true;
            statusPanel.classList.add('show');
            aiThinking.style.display = 'flex';

            try {
                // 1. GPT API로 내용 분석
                statusTitle.textContent = '🧠 GPT-4가 당신의 내용을 지능적으로 분석 중...';
                
                const prompt = `템플릿: ${selectedTemplate}
제목: ${title}
내용: ${content}
컬러테마: ${colorTheme}

위 정보를 바탕으로 11장의 유튜브 쇼츠용 슬라이드 구조를 생성해주세요.`;

                const gptResponse = await callGPTAPI(prompt);
                
                // 2. AI 응답 파싱
                statusTitle.textContent = '🎨 AI가 생성한 구조를 슬라이드로 변환 중...';
                
                let slideStructure;
                try {
                    // JSON 파싱
                    const cleanResponse = gptResponse.replace(/```json|```/g, '').trim();
                    slideStructure = JSON.parse(cleanResponse);
                } catch (parseError) {
                    console.warn('JSON 파싱 실패, 백업 구조 사용');
                    slideStructure = createBackupStructure(title, content);
                }

                // 3. AI 분석 결과 표시
                aiAnalysisResult = slideStructure;
                aiAnalysis.classList.remove('hidden');
                analysisResult.innerHTML = `
                    <strong>📊 AI가 분석한 내용 구조:</strong><br>
                    • 총 ${slideStructure.length}장의 슬라이드 생성<br>
                    • 템플릿: ${selectedTemplate}<br>
                    • 컬러 테마: ${colorTheme}<br>
                    • 특별 요소: ${slideStructure.filter(s => s.type === 'stats').length}개 통계, ${slideStructure.filter(s => s.type === 'contact').length}개 연락처<br>
                    • AI 추천 애니메이션: ${[...new Set(slideStructure.map(s => s.animation))].join(', ')}
                `;

                // 4. HTML 생성
                statusTitle.textContent = '🎬 유튜브 쇼츠 최적화 영상 생성 중...';
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                generatedSlideHTML = createAdvancedSlideHTML(slideStructure, colorTheme);
                
                // 5. 완료
                aiThinking.style.display = 'none';
                statusTitle.textContent = '✅ 실제 AI 슬라이드 생성 완료!';
                statusPanel.classList.remove('show');
                
                // 6. 미리보기 표시
                showAIPreview();
                generateButton.disabled = false;
                
                console.log('🎊 AI 슬라이드 생성 완료!');
                
            } catch (error) {
                console.error('❌ AI 생성 오류:', error);
                aiThinking.style.display = 'none';
                statusTitle.textContent = `❌ 오류: ${error.message}`;
                
                // API 키 오류인 경우 안내
                if (error.message.includes('401') || error.message.includes('API')) {
                    statusTitle.innerHTML = '❌ API 키 오류: OpenAI API 키를 확인해주세요.<br><small>크레딧이 부족하거나 잘못된 키일 수 있습니다.</small>';
                }
                
                setTimeout(() => {
                    statusPanel.classList.remove('show');
                    generateButton.disabled = false;
                }, 5000);
            }
        }

        // 백업 구조 생성 (API 실패 시)
        function createBackupStructure(title, content) {
            const lines = content.split('\n').filter(line => line.trim());
            const features = lines.filter(line => line.includes('-') || line.includes(':')).slice(0, 6);
            
            return [
                { slideNumber: 1, type: "intro", title: title, subtitle: "혁신적인 솔루션", icon: "🚀", background: "gradient1", animation: "glow" },
                { slideNumber: 2, type: "brand", title: title.split('-')[0] || title, subtitle: "브랜드 소개", icon: "⭐", background: "gradient2", animation: "bounce" },
                ...features.map((feature, i) => ({
                    slideNumber: i + 3,
                    type: "feature", 
                    title: feature.split(':')[0].replace('-', '').trim(),
                    subtitle: feature.split(':')[1]?.trim() || '',
                    icon: getSmartIcon(feature, i),
                    background: `gradient${(i % 9) + 3}`,
                    animation: ['pulse', 'bounce', 'fade', 'glow'][i % 4]
                })),
                { slideNumber: 11, type: "contact", title: "연락처", subtitle: "상담 문의", icon: "📞", background: "gradient11", animation: "bounce" }
            ].slice(0, 11);
        }

        // 스마트 아이콘 선택
        function getSmartIcon(text, index) {
            const icons = ['🧠', '🎯', '💬', '🤖', '⚡', '💝', '🔥', '✨', '🎊', '🏆'];
            
            if (text.includes('AI') || text.includes('인공지능')) return '🤖';
            if (text.includes('속독') || text.includes('빠른')) return '🎯';
            if (text.includes('토론') || text.includes('대화')) return '💬';
            if (text.includes('피드백') || text.includes('즉석')) return '⚡';
            if (text.includes('분석') || text.includes('독해')) return '🧠';
            
            return icons[index % icons.length];
        }

        // 고급 슬라이드 HTML 생성
        function createAdvancedSlideHTML(slides, colorTheme) {
            const colors = getColorTheme(colorTheme);
            const backgrounds = getBackgroundStyles(colors);
            
            let slidesHTML = '';
            
            slides.forEach((slide, index) => {
                const isActive = index === 0 ? 'active' : '';
                const bgStyle = backgrounds[slide.background] || backgrounds.gradient1;
                
                slidesHTML += `
                <div class="slide ${isActive}" data-slide="${index}" style="${bgStyle}">
                    <div class="slide-content">
                        <div class="big-icon" style="animation: ${slide.animation} 2s infinite;">${slide.icon}</div>
                        <div class="slide-title" style="color: ${colors.accent};">${slide.title}</div>
                        <div class="slide-desc">${slide.subtitle}</div>
                    </div>
                    <div class="slide-indicator">${slide.slideNumber}/11</div>
                </div>`;
            });

            return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Generated Slides</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; overflow: hidden; font-family: Arial; height: 100vh; display: flex; justify-content: center; align-items: center; }
        .container { width: 405px; height: 720px; background: #000; border-radius: 25px; position: relative; overflow: hidden; border: 3px solid #333; }
        .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: all 0.8s ease; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px 25px; color: white; }
        .slide.active { opacity: 1; }
        .slide-content { width: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; }
        .slide-title { font-size: 2.2em; font-weight: 900; margin-bottom: 20px; line-height: 1.1; text-shadow: 0 0 25px rgba(255,255,255,0.8); }
        .slide-desc { font-size: 1.1em; line-height: 1.4; opacity: 0.95; }
        .big-icon { font-size: 4em; margin-bottom: 25px; filter: drop-shadow(0 0 15px rgba(255,255,255,0.6)); }
        .slide-indicator { position: absolute; top: 20px; right: 20px; font-size: 0.9em; background: rgba(0,0,0,0.7); padding: 8px 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-15px); } 60% { transform: translateY(-8px); } }
        @keyframes fade { 0%, 100% { opacity: 0.8; } 50% { opacity: 1; } }
        @keyframes glow { 0%, 100% { text-shadow: 0 0 20px rgba(255,255,255,0.8); } 50% { text-shadow: 0 0 35px rgba(0,255,255,0.9); } }
    </style>
</head>
<body>
    <div class="container">
        ${slidesHTML}
    </div>
    <script>
        let current = 0;
        const total = ${slides.length};
        
        function next() {
            document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
            current = (current + 1) % total;
            if (document.querySelectorAll('.slide')[current]) {
                document.querySelectorAll('.slide')[current].classList.add('active');
            }
            if (current === 0) return false;
            return true;
        }
        
        function start() {
            document.querySelectorAll('.slide')[0].classList.add('active');
            const interval = setInterval(() => {
                if (!next()) clearInterval(interval);
            }, 2500);
        }
        
        setTimeout(start, 1000);
        console.log('🤖 실제 AI 생성 슬라이드쇼 시작!');
    </script>
</body>
</html>`;
        }

        // 컬러 테마 가져오기
        function getColorTheme(theme) {
            const themes = {
                'blue-purple': { primary: '#667eea', secondary: '#764ba2', accent: '#00ffff' },
                'red-orange': { primary: '#ff6b6b', secondary: '#ff8e53', accent: '#ffff00' },
                'green-teal': { primary: '#11998e', secondary: '#38ef7d', accent: '#00ff00' },
                'purple-pink': { primary: '#a8edea', secondary: '#fed6e3', accent: '#ff00ff' },
                'dark-neon': { primary: '#0f0f0f', secondary: '#1a1a1a', accent: '#00ffff' },
                'auto': { primary: '#667eea', secondary: '#764ba2', accent: '#00ffff' }
            };
            return themes[theme] || themes['blue-purple'];
        }

        // 배경 스타일 가져오기
        function getBackgroundStyles(colors) {
            return {
                gradient1: `background: linear-gradient(135deg, ${colors.primary} 0%, ${colors.secondary} 100%);`,
                gradient2: `background: radial-gradient(circle, #000428 0%, #004e92 100%);`,
                gradient3: `background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);`,
                gradient4: `background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);`,
                gradient5: `background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);`,
                gradient6: `background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);`,
                gradient7: `background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);`,
                gradient8: `background: linear-gradient(135deg, #0f0f0f 0%, #2d1b69 50%, #11998e 100%);`,
                gradient9: `background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);`,
                gradient10: `background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);`,
                gradient11: `background: linear-gradient(135deg, ${colors.primary} 0%, ${colors.secondary} 100%);`
            };
        }

        // AI 미리보기 표시
        function showAIPreview() {
            const previewSection = document.getElementById('previewSection');
            const slidePreview = document.getElementById('slidePreview');
            
            slidePreview.innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: white; text-align: center; flex-direction: column;">
                    <div style="font-size: 3em; margin-bottom: 20px;">🤖</div>
                    <div style="font-size: 1.2em; margin-bottom: 10px;">실제 AI 슬라이드 생성 완료!</div>
                    <div style="font-size: 0.9em; opacity: 0.8;">GPT-4가 분석한 11장의 전문 슬라이드</div>
                    <div style="font-size: 0.8em; opacity: 0.6; margin-top: 10px;">총 ${aiAnalysisResult?.length || 11}장 생성됨</div>
                </div>
            `;
            
            previewSection.classList.add('show');
        }

        // 녹화 시작 (기존 코드와 동일)
        async function startRecording() {
            if (!generatedSlideHTML) {
                alert('먼저 AI 슬라이드를 생성해주세요!');
                return;
            }

            try {
                const statusPanel = document.getElementById('statusPanel');
                const statusTitle = document.getElementById('statusTitle');
                const countdown = document.getElementById('countdown');
                const progressContainer = document.getElementById('progressContainer');
                const recordingStatus = document.getElementById('recordingStatus');

                statusPanel.classList.add('show');
                statusTitle.textContent = '🎬 AI 생성 슬라이드쇼 창 열기...';

                // 슬라이드쇼 창 열기
                const blob = new Blob([generatedSlideHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                slideshowWindow = window.open(url, 'slideshow', 'width=450,height=800');

                if (!slideshowWindow) {
                    throw new Error('팝업이 차단되었습니다. 팝업을 허용하고 다시 시도해주세요.');
                }

                await new Promise(resolve => setTimeout(resolve, 2000));

                // 화면 공유 요청
                statusTitle.textContent = '🖥️ 화면 공유 권한 요청';
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { width: { ideal: 405 }, height: { ideal: 720 } }
                });

                // MediaRecorder 설정
                recordedChunks = [];
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) recordedChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    downloadVideo(blob);
                    stream.getTracks().forEach(track => track.stop());
                    if (slideshowWindow) slideshowWindow.close();
                };

                // 카운트다운
                statusTitle.textContent = '🎬 AI 영상 녹화 시작 준비';
                countdown.classList.remove('hidden');
                
                let count = 5;
                countdown.textContent = count;
                
                const countInterval = setInterval(() => {
                    count--;
                    if (count > 0) {
                        countdown.textContent = count;
                    } else {
                        countdown.textContent = '시작!';
                        clearInterval(countInterval);
                        
                        setTimeout(() => {
                            countdown.classList.add('hidden');
                            
                            // 녹화 시작
                            mediaRecorder.start();
                            statusTitle.textContent = '🔴 AI 생성 영상 제작 중...';
                            recordingStatus.classList.add('active');
                            progressContainer.classList.remove('hidden');
                            
                            // 진행률 표시
                            let progress = 0;
                            const duration = 27500;
                            const progressFill = document.getElementById('progressFill');
                            const progressText = document.getElementById('progressText');
                            
                            const progressInterval = setInterval(() => {
                                progress += 100;
                                const percentage = Math.min((progress / duration) * 100, 100);
                                progressFill.style.width = percentage + '%';
                                progressText.textContent = Math.round(percentage) + '% 완료';
                                
                                if (progress >= duration) {
                                    clearInterval(progressInterval);
                                    mediaRecorder.stop();
                                    recordingStatus.classList.remove('active');
                                    statusTitle.textContent = '✅ AI 영상 제작 완료!';
                                }
                            }, 100);
                            
                        }, 1000);
                    }
                }, 1000);

            } catch (error) {
                document.getElementById('statusTitle').textContent = '❌ 오류: ' + error.message;
                if (slideshowWindow) slideshowWindow.close();
            }
        }

        // 영상 다운로드
        function downloadVideo(blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const now = new Date();
            const title = document.getElementById('titleInput').value.replace(/[^a-zA-Z0-9가-힣]/g, '_');
            const filename = `AI_Generated_${title}_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}.webm`;
            
            a.href = url;
            a.download = filename;
            a.click();
            
            console.log('🤖 AI 생성 영상 다운로드 완료:', filename);
            
            setTimeout(() => {
                document.getElementById('statusPanel').classList.remove('show');
            }, 3000);
        }

        // 초기화
        function init() {
            try {
                // 브라우저 호환성 검사
                if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {
                    document.getElementById('generateButton').textContent = '⚠️ 브라우저가 지원되지 않습니다 (Chrome 권장)';
                    document.getElementById('generateButton').disabled = true;
                    return;
                }

                // 템플릿 선택 이벤트 등록
                initTemplateSelection();
                
                // 저장된 API 키 복원
                const savedApiKey = sessionStorage.getItem('openai_api_key');
                if (savedApiKey) {
                    document.getElementById('apiKeyInput').value = savedApiKey;
                    setApiKey();
                }
                
                console.log('🤖 실제 AI 슬라이드 생성기 로드 완료!');
                console.log('🧠 OpenAI GPT-4 API 연동 준비');
                console.log('✨ 실제 AI가 분석하고 생성하는 슬라이드');
                
            } catch (error) {
                console.error('초기화 오류:', error);
            }
        }

        // DOM 로드 시 초기화
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
