<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ ìœ íŠœë¸Œ ì‡¼ì¸  ìë™ ìƒì„±ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b6b 100%);
            --shorts-gradient: linear-gradient(45deg, #ff0844, #ffb199);
            --json-gradient: linear-gradient(45deg, #ff9a56, #ff6b95);
            --success-gradient: linear-gradient(45deg, #00ff88, #00b894);
            --text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            --box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            --border-radius: 25px;
            --transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary-gradient);
            background-size: 400% 400%;
            animation: gradientFlow 8s ease infinite;
            min-height: 100vh;
            color: white;
            line-height: 1.6;
            overflow-x: hidden;
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
            position: relative;
            z-index: 2;
        }

        .hero {
            text-align: center;
            padding: 60px 40px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: var(--border-radius);
            margin-bottom: 60px;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .hero-icon {
            font-size: 5em;
            margin-bottom: 30px;
            animation: iconPulse 3s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.6));
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .hero-title {
            font-size: 3.5em;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textShimmer 4s ease infinite;
        }

        @keyframes textShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .section {
            background: rgba(255, 255, 255, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            padding: 50px;
            margin: 40px 0;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .section-title {
            font-size: 2.5em;
            margin-bottom: 30px;
            text-align: center;
            color: #feca57;
            text-shadow: 0 0 25px rgba(254, 202, 87, 0.6);
            font-weight: 800;
        }

        .input-group {
            margin-bottom: 30px;
        }

        .input-label {
            display: block;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 10px;
            color: #4ecdc4;
        }

        .input-field {
            width: 100%;
            padding: 20px;
            background: rgba(255, 255, 255, 0.12);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 18px;
            color: white;
            font-size: 1.2em;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.4);
            transform: scale(1.01);
        }

        .textarea-field {
            min-height: 200px;
            resize: vertical;
        }

        .btn {
            padding: 18px 35px;
            margin: 10px;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }

        .btn-shorts {
            background: var(--shorts-gradient);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 8, 68, 0.4);
            font-size: 1.8em;
            padding: 30px 60px;
            animation: shortsPulse 3s ease infinite;
        }

        @keyframes shortsPulse {
            0%, 100% { 
                box-shadow: 0 8px 25px rgba(255, 8, 68, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 12px 35px rgba(255, 8, 68, 0.8);
                transform: scale(1.02);
            }
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .shorts-preview {
            width: 100%;
            max-width: 450px;
            height: 800px;
            background: #000;
            border-radius: 30px;
            border: 4px solid #333;
            margin: 30px auto;
            overflow: hidden;
            position: relative;
            box-shadow: var(--box-shadow);
        }

        .canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #shortsCanvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 26px;
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .progress-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(15px);
        }

        .progress-modal.show {
            display: flex;
        }

        .progress-content {
            background: rgba(255, 255, 255, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 30px;
            padding: 60px;
            text-align: center;
            backdrop-filter: blur(25px);
            max-width: 600px;
            width: 90%;
        }

        .progress-icon {
            font-size: 5em;
            margin-bottom: 30px;
            animation: progressRotate 2s linear infinite;
        }

        @keyframes progressRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .progress-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #4ecdc4;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0844, #ffb199);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .shorts-info {
            background: rgba(255, 8, 68, 0.1);
            border: 3px solid rgba(255, 8, 68, 0.4);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .shorts-info h4 {
            color: #ff0844;
            margin-bottom: 15px;
            font-size: 1.6em;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #ff0844;
            box-shadow: 0 15px 40px rgba(255, 8, 68, 0.3);
        }

        .feature-card .icon {
            font-size: 3em;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px currentColor);
        }

        .feature-card h4 {
            color: #feca57;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .download-section {
            text-align: center;
            padding: 40px;
            background: var(--success-gradient);
            border-radius: 25px;
            margin: 40px 0;
            display: none;
            animation: successPulse 2s ease infinite;
        }

        @keyframes successPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(0, 255, 136, 0.4); }
            50% { box-shadow: 0 0 50px rgba(0, 255, 136, 0.8); }
        }

        .download-section h3 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .download-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.6em;
            padding: 25px 50px;
            border-radius: 20px;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
            border: 2px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px) scale(1.05);
        }

        .api-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        .api-status.success {
            background: rgba(0, 255, 100, 0.2);
            border: 2px solid rgba(0, 255, 100, 0.5);
            color: #00ff88;
        }

        .api-status.error {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid rgba(255, 107, 107, 0.5);
            color: #ff6b6b;
        }

        .video-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255, 8, 68, 0.3);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #ff0844;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .hero-title { font-size: 2.5em; }
            .section { padding: 30px 20px; }
            .video-controls { flex-direction: column; align-items: center; }
            .btn { width: 100%; max-width: 300px; }
            .shorts-preview { height: 600px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <div class="hero-icon">ğŸ“±</div>
            <h1 class="hero-title">ìœ íŠœë¸Œ ì‡¼ì¸  ìë™ ìƒì„±ê¸°</h1>
            <p style="font-size: 1.4em; opacity: 0.9; margin-top: 20px;">
                GPT-4 ë¶„ì„ â†’ JSON2Video ìƒì„± â†’ ì‹¤ì œ MP4 ì‡¼ì¸  ì˜ìƒ ì™„ì„±!<br>
                <strong>ì™„ì „ ìë™í™”ëœ ìœ íŠœë¸Œ ì‡¼ì¸  ì œì‘ ì‹œìŠ¤í…œ</strong>
            </p>
        </div>

        <!-- ìœ íŠœë¸Œ ì‡¼ì¸  íŠ¹ì§• -->
        <div class="shorts-info">
            <h4>ğŸ¯ ì™„ë²½í•œ ìœ íŠœë¸Œ ì‡¼ì¸  ìµœì í™”</h4>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="icon">ğŸ“±</div>
                    <h4>9:16 ì„¸ë¡œ ë¹„ìœ¨</h4>
                    <p>1080Ã—1920 í•´ìƒë„ë¡œ ëª¨ë°”ì¼ì— ì™„ë²½ ìµœì í™”</p>
                </div>
                <div class="feature-card">
                    <div class="icon">â±ï¸</div>
                    <h4>15-60ì´ˆ ê¸¸ì´</h4>
                    <p>ìœ íŠœë¸Œ ì‡¼ì¸  ì•Œê³ ë¦¬ì¦˜ì— ìµœì í™”ëœ ê¸¸ì´</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ¨</div>
                    <h4>ê³ ëŒ€ë¹„ ë””ìì¸</h4>
                    <p>ëª¨ë°”ì¼ì—ì„œ ì„ ëª…í•˜ê²Œ ë³´ì´ëŠ” í° í…ìŠ¤íŠ¸</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸš€</div>
                    <h4>ì™„ì „ ìë™í™”</h4>
                    <p>ì½˜í…ì¸  ì…ë ¥ë§Œìœ¼ë¡œ MP4 ì™„ì„±</p>
                </div>
            </div>
        </div>

        <!-- API ì„¤ì • -->
        <div class="section">
            <h2 class="section-title">ğŸ”‘ OpenAI API ì„¤ì •</h2>
            <div class="input-group">
                <label class="input-label">OpenAI API í‚¤</label>
                <input type="password" class="input-field" id="apiInput" 
                       placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
            </div>
            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="setupApiKey()">API í‚¤ ì„¤ì •</button>
            </div>
            <div id="apiStatus" class="api-status"></div>
        </div>

        <!-- ì½˜í…ì¸  ì…ë ¥ -->
        <div class="section">
            <h2 class="section-title">ğŸ“ ì‡¼ì¸  ì½˜í…ì¸  ì…ë ¥</h2>
            <div class="input-group">
                <label class="input-label">ì£¼ì œ (Hook)</label>
                <input type="text" class="input-field" id="topicInput" 
                       placeholder="ì˜ˆ: 3ì´ˆë§Œì— ë°°ìš°ëŠ” íˆ¬ì ë¹„ë²•">
            </div>
            <div class="input-group">
                <label class="input-label">ìƒì„¸ ë‚´ìš©</label>
                <textarea class="input-field textarea-field" id="contentInput" 
                          placeholder="ìœ íŠœë¸Œ ì‡¼ì¸ ìš© ì½˜í…ì¸ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:

ğŸ“ˆ íˆ¬ì ì´ˆë³´ìë¥¼ ìœ„í•œ 3ê°€ì§€ í™©ê¸ˆ ë²•ì¹™

1. ë¶„ì‚° íˆ¬ìì˜ í˜
- í•œ ë°”êµ¬ë‹ˆì— ê³„ë€ì„ ë‹´ì§€ ë§ˆë¼
- ì£¼ì‹, ì±„ê¶Œ, ë¶€ë™ì‚°ìœ¼ë¡œ ìœ„í—˜ ë¶„ì‚°

2. ì¥ê¸° íˆ¬ì ë§ˆì¸ë“œ
- ë³µë¦¬ì˜ ë§ˆë²•ì„ ë¯¿ì–´ë¼
- ì‹œì¥ íƒ€ì´ë°ë³´ë‹¤ íˆ¬ì ê¸°ê°„ì´ ì¤‘ìš”

3. ê¾¸ì¤€í•œ ì ë¦½ì‹ íˆ¬ì
- ë§¤ì›” ì¼ì • ê¸ˆì•¡ íˆ¬ì
- ë‹¬ëŸ¬ ì½”ìŠ¤íŠ¸ ì• ë²„ë¦¬ì§• íš¨ê³¼

ğŸ’¡ ê¸°ì–µí•˜ì„¸ìš”: íˆ¬ìëŠ” ë§ˆë¼í†¤ì…ë‹ˆë‹¤!

ëŒ€ìƒ: 20-30ëŒ€ íˆ¬ì ì´ˆë³´ì
í†¤ì•¤ë§¤ë„ˆ: ì¹œê·¼í•˜ê³  ì‰¬ìš´ ì„¤ëª…
ëª©í‘œ: êµ¬ë…ê³¼ ì¢‹ì•„ìš” ìœ ë„"></textarea>
            </div>
        </div>

        <!-- ì‡¼ì¸  ìƒì„± ë²„íŠ¼ -->
        <div style="text-align: center; margin: 50px 0;">
            <button class="btn btn-shorts" id="generateShortsBtn" onclick="generateYouTubeShorts()" disabled>
                ğŸš€ ìœ íŠœë¸Œ ì‡¼ì¸  ìë™ ìƒì„±
            </button>
        </div>

        <!-- ì‡¼ì¸  ë¯¸ë¦¬ë³´ê¸° -->
        <div class="section" id="previewSection" style="display: none;">
            <h2 class="section-title">ğŸ“± ì‡¼ì¸  ë¯¸ë¦¬ë³´ê¸°</h2>
            <div class="shorts-preview">
                <div class="canvas-container">
                    <canvas id="shortsCanvas" width="1080" height="1920"></canvas>
                </div>
            </div>
            
            <div class="video-stats" id="videoStats">
                <div class="stat-card">
                    <div class="stat-value" id="slideCount">0</div>
                    <div class="stat-label">ìŠ¬ë¼ì´ë“œ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="videoDuration">0s</div>
                    <div class="stat-label">ì´ ê¸¸ì´</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">1080Ã—1920</div>
                    <div class="stat-label">í•´ìƒë„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">30 FPS</div>
                    <div class="stat-label">í”„ë ˆì„ë ˆì´íŠ¸</div>
                </div>
            </div>
            
            <div class="video-controls">
                <button class="btn btn-primary" onclick="previewShorts()">
                    â–¶ï¸ ë¯¸ë¦¬ë³´ê¸° ì¬ìƒ
                </button>
                <button class="btn btn-shorts" onclick="generateShortsMP4()">
                    ğŸ¬ MP4 ì‡¼ì¸  ìƒì„±
                </button>
                <button class="btn btn-primary" onclick="stopPreview()">
                    â¹ï¸ ì •ì§€
                </button>
            </div>
        </div>

        <!-- ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ -->
        <div class="download-section" id="downloadSection">
            <h3>ğŸ‰ ìœ íŠœë¸Œ ì‡¼ì¸  ì™„ì„±!</h3>
            <p style="margin-bottom: 25px; font-size: 1.2em;">
                ê³ í’ˆì§ˆ MP4 ì‡¼ì¸  ì˜ìƒì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!
            </p>
            <button class="download-btn" id="downloadBtn" onclick="downloadShorts()">
                ğŸ“¥ ì‡¼ì¸  ì˜ìƒ ë‹¤ìš´ë¡œë“œ
            </button>
            <div style="margin-top: 30px; opacity: 0.9;">
                <p><strong>âœ… ìœ íŠœë¸Œ ì—…ë¡œë“œ ì¤€ë¹„ ì™„ë£Œ</strong></p>
                <p>â€¢ ì™„ë²½í•œ 9:16 ë¹„ìœ¨ (1080Ã—1920)</p>
                <p>â€¢ ëª¨ë°”ì¼ ìµœì í™” ê³ ëŒ€ë¹„ í…ìŠ¤íŠ¸</p>
                <p>â€¢ ì‹œì„  ì§‘ì¤‘ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼</p>
                <p>â€¢ ë°”ë¡œ ì—…ë¡œë“œ ê°€ëŠ¥í•œ MP4 íŒŒì¼</p>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œê·¸ë˜ìŠ¤ ëª¨ë‹¬ -->
    <div class="progress-modal" id="progressModal">
        <div class="progress-content">
            <div class="progress-icon" id="progressIcon">ğŸ“±</div>
            <h3 class="progress-title" id="progressTitle">ìœ íŠœë¸Œ ì‡¼ì¸  ìƒì„± ì¤‘...</h3>
            <p id="progressDesc">GPT-4ê°€ ì‡¼ì¸  ìµœì í™” ì½˜í…ì¸ ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="progressText" style="font-size: 1.4em; font-weight: bold; color: #ff0844;">0%</div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let apiKey = '';
        let shortsSlides = [];
        let videoBlob = null;
        let isGenerating = false;
        let canvas, ctx;
        let animationId = null;

        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            initializeCanvas();
            updateGenerateButton();
        });

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            const topicInput = document.getElementById('topicInput');
            const contentInput = document.getElementById('contentInput');
            const apiInput = document.getElementById('apiInput');

            topicInput?.addEventListener('input', updateGenerateButton);
            contentInput?.addEventListener('input', updateGenerateButton);
            
            apiInput?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    setupApiKey();
                }
            });
        }

        // Canvas ì´ˆê¸°í™”
        function initializeCanvas() {
            canvas = document.getElementById('shortsCanvas');
            if (canvas) {
                ctx = canvas.getContext('2d');
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                
                // ì´ˆê¸° ìº”ë²„ìŠ¤ ì„¤ì •
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ë¡œê³  í‘œì‹œ
                ctx.fillStyle = '#ffffff';
                ctx.font = '100px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ“±', canvas.width / 2, canvas.height / 2);
                
                ctx.font = '40px Arial';
                ctx.fillText('ìœ íŠœë¸Œ ì‡¼ì¸  ì¤€ë¹„ ì¤‘...', canvas.width / 2, canvas.height / 2 + 100);
            }
        }

        // API í‚¤ ì„¤ì •
        async function setupApiKey() {
            const input = document.getElementById('apiInput');
            const status = document.getElementById('apiStatus');
            
            if (!input || !status) return;
            
            const key = input.value.trim();
            
            if (!key) {
                showApiStatus('âŒ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            if (!key.startsWith('sk-') || key.length < 40) {
                showApiStatus('âŒ ì˜¬ë°”ë¥¸ OpenAI API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const isValid = await testApiKey(key);
                if (isValid) {
                    apiKey = key;
                    showApiStatus('âœ… API í‚¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    updateGenerateButton();
                } else {
                    showApiStatus('âŒ API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('API í‚¤ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                apiKey = key;
                showApiStatus('âš ï¸ API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ê²€ì¦ ì‹¤íŒ¨)', 'error');
                updateGenerateButton();
            }
        }

        // API í‚¤ í…ŒìŠ¤íŠ¸
        async function testApiKey(key) {
            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    }
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // API ìƒíƒœ ë©”ì‹œì§€
        function showApiStatus(message, type) {
            const status = document.getElementById('apiStatus');
            if (status) {
                status.textContent = message;
                status.className = `api-status ${type}`;
                status.style.display = 'block';
                
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
        }

        // ìƒì„± ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateGenerateButton() {
            const topicInput = document.getElementById('topicInput');
            const contentInput = document.getElementById('contentInput');
            const generateBtn = document.getElementById('generateShortsBtn');
            
            if (!topicInput || !contentInput || !generateBtn) return;
            
            const topic = topicInput.value.trim();
            const content = contentInput.value.trim();
            
            generateBtn.disabled = !(apiKey && topic && content);
        }

        // ìœ íŠœë¸Œ ì‡¼ì¸  ìƒì„± ë©”ì¸ í•¨ìˆ˜
        async function generateYouTubeShorts() {
            if (isGenerating) return;
            
            const topicInput = document.getElementById('topicInput');
            const contentInput = document.getElementById('contentInput');
            
            if (!topicInput || !contentInput) return;
            
            const topic = topicInput.value.trim();
            const content = contentInput.value.trim();
            
            if (!apiKey || !topic || !content) {
                alert('âŒ API í‚¤, ì£¼ì œ, ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            isGenerating = true;
            showProgressModal(true);
            
            try {
                // 1ë‹¨ê³„: GPTë¡œ ìœ íŠœë¸Œ ì‡¼ì¸  ìµœì í™” ìŠ¬ë¼ì´ë“œ ìƒì„±
                updateProgress(20, 'ğŸ§  ì‡¼ì¸  ì½˜í…ì¸  ë¶„ì„', 'GPT-4ê°€ ìœ íŠœë¸Œ ì‡¼ì¸ ì— ìµœì í™”ëœ ì½˜í…ì¸ ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
                const slides = await generateShortsSlides(topic, content);
                
                if (!slides || slides.length === 0) {
                    throw new Error('ì‡¼ì¸  ìŠ¬ë¼ì´ë“œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                shortsSlides = slides;
                
                // 2ë‹¨ê³„: ì‡¼ì¸  í†µê³„ ì—…ë°ì´íŠ¸
                updateProgress(40, 'ğŸ“Š ì‡¼ì¸  ì„¤ì •', 'ìœ íŠœë¸Œ ì‡¼ì¸  ìµœì í™” ì„¤ì •ì„ ì ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
                updateShortsStats(slides);
                
                // 3ë‹¨ê³„: Canvas ë Œë”ë§ ì¤€ë¹„
                updateProgress(60, 'ğŸ¨ ë¹„ì£¼ì–¼ ì¤€ë¹„', 'ì‡¼ì¸  ë¹„ì£¼ì–¼ ìš”ì†Œë¥¼ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
                await delay(500);
                
                // 4ë‹¨ê³„: ì²« ë²ˆì§¸ ìŠ¬ë¼ì´ë“œ ë Œë”ë§
                updateProgress(80, 'ğŸ“± ì²« í™”ë©´ ë Œë”ë§', 'ì‡¼ì¸  ì²« í™”ë©´ì„ ë Œë”ë§í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
                await renderSlideToCanvas(0);
                
                updateProgress(100, 'ğŸ‰ ì™„ì„±!', 'ìœ íŠœë¸Œ ì‡¼ì¸ ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
                await delay(1000);
                
                showProgressModal(false);
                showPreviewSection();
                
            } catch (error) {
                console.error('ìœ íŠœë¸Œ ì‡¼ì¸  ìƒì„± ì˜¤ë¥˜:', error);
                showProgressModal(false);
                alert('âŒ ìœ íŠœë¸Œ ì‡¼ì¸  ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                isGenerating = false;
            }
        }

        // GPTë¡œ ìœ íŠœë¸Œ ì‡¼ì¸  ìµœì í™” ìŠ¬ë¼ì´ë“œ ìƒì„±
        async function generateShortsSlides(topic, content) {
            const prompt = `ë‹¤ìŒ ë‚´ìš©ì„ ìœ íŠœë¸Œ ì‡¼ì¸ ì— ìµœì í™”ëœ ìŠ¬ë¼ì´ë“œë¡œ ë³€í™˜í•´ì£¼ì„¸ìš”:

ì£¼ì œ: ${topic}

ë‚´ìš©:
${content}

ìœ íŠœë¸Œ ì‡¼ì¸  ìµœì í™” ìš”êµ¬ì‚¬í•­:
- ìŠ¬ë¼ì´ë“œ ê°œìˆ˜: 12-15ê°œ (ì´ 30-45ì´ˆ ê¸¸ì´)
- ì²« ìŠ¬ë¼ì´ë“œ: ê°•ë ¥í•œ Hook (ì‹œì„  ì§‘ì¤‘)
- ê° ìŠ¬ë¼ì´ë“œ: 2-3ì´ˆ ì•ˆì— ì´í•´ ê°€ëŠ¥í•œ ê°„ë‹¨í•œ ë©”ì‹œì§€
- ë§ˆì§€ë§‰ ìŠ¬ë¼ì´ë“œ: CTA (êµ¬ë…, ì¢‹ì•„ìš” ìœ ë„)
- ëª¨ë°”ì¼ì—ì„œ ì½ê¸° ì‰¬ìš´ í° í…ìŠ¤íŠ¸
- ê° ìŠ¬ë¼ì´ë“œë§ˆë‹¤ ì‹œì„ ì„ ë„ëŠ” ì´ëª¨ì§€ í¬í•¨
- ë°ê³  ëŒ€ë¹„ê°€ ê°•í•œ ìƒ‰ìƒ ì‚¬ìš©

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì •í™•íˆ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
  "slides": [
    {
      "id": 1,
      "icon": "ğŸ”¥",
      "title": "3ì´ˆë§Œì— ë°°ìš°ëŠ”",
      "subtitle": "íˆ¬ì ë¹„ë²• ê³µê°œ!",
      "type": "hook",
      "backgroundColor": "#ff0844",
      "textColor": "#ffffff",
      "duration": 3
    }
  ]
}

type: hook(ì²«ìŠ¬ë¼ì´ë“œ), content(ë‚´ìš©), highlight(ê°•ì¡°), cta(êµ¬ë…ìœ ë„)
duration: ê° ìŠ¬ë¼ì´ë“œ ë…¸ì¶œ ì‹œê°„ (ì´ˆ)`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: [
                            {
                                role: "system",
                                content: "ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ì‡¼ì¸  ì œì‘ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ì‹œì²­ìì˜ ì£¼ì˜ë¥¼ ëŒê³  ëê¹Œì§€ ë³´ê²Œ ë§Œë“œëŠ” ì½˜í…ì¸ ë¥¼ ë§Œë“­ë‹ˆë‹¤. ë°˜ë“œì‹œ ìœ íš¨í•œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”."
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.8,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    throw new Error(`GPT API ì˜¤ë¥˜: ${response.status}`);
                }

                const data = await response.json();
                const content = data.choices[0]?.message?.content;
                
                if (!content) {
                    throw new Error('GPT ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                }

                try {
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) {
                        throw new Error('JSON í˜•ì‹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    
                    const parsed = JSON.parse(jsonMatch[0]);
                    return parsed.slides || [];
                } catch (parseError) {
                    console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', parseError);
                    throw new Error('JSON íŒŒì‹±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('GPT ì‡¼ì¸  ìŠ¬ë¼ì´ë“œ ìƒì„± ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ì‡¼ì¸  í†µê³„ ì—…ë°ì´íŠ¸
        function updateShortsStats(slides) {
            const slideCountEl = document.getElementById('slideCount');
            const videoDurationEl = document.getElementById('videoDuration');
            
            if (slideCountEl) {
                slideCountEl.textContent = slides.length;
            }
            
            if (videoDurationEl) {
                const totalDuration = slides.reduce((sum, slide) => sum + (slide.duration || 3), 0);
                videoDurationEl.textContent = `${totalDuration}s`;
            }
        }

        // Canvasì— í™˜ìƒì ì¸ ë°°ê²½ íš¨ê³¼ì™€ ìŠ¬ë¼ì´ë“œ ë Œë”ë§
        async function renderSlideToCanvas(slideIndex) {
            if (!ctx || !shortsSlides[slideIndex]) return;
            
            const slide = shortsSlides[slideIndex];
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ í´ë¦¬ì–´
            ctx.clearRect(0, 0, width, height);
            
            // 1. í™˜ìƒì ì¸ ê·¸ë¼ë°ì´ì…˜ ë°°ê²½
            const bgColor = slide.backgroundColor || '#667eea';
            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, Math.max(width, height));
            gradient.addColorStop(0, bgColor);
            gradient.addColorStop(0.7, adjustBrightness(bgColor, -20));
            gradient.addColorStop(1, adjustBrightness(bgColor, -40));
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // 2. ë™ì  íŒ¨í„´ ì˜¤ë²„ë ˆì´
            drawAnimatedPattern(slideIndex);
            
            // 3. ê¸€ë¡œìš° íš¨ê³¼
            drawGlowEffects(slideIndex);
            
            // 4. í…ìŠ¤íŠ¸ ë Œë”ë§
            renderSlideText(slide, slideIndex);
        }

        // ë°ê¸° ì¡°ì ˆ í•¨ìˆ˜
        function adjustBrightness(hex, amount) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * amount);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        // í™˜ìƒì ì¸ ì• ë‹ˆë©”ì´ì…˜ íŒ¨í„´
        function drawAnimatedPattern(slideIndex) {
            const width = canvas.width;
            const height = canvas.height;
            const time = Date.now() * 0.001;
            
            ctx.globalAlpha = 0.15;
            
            // íŒ¨í„´ íƒ€ì…ë³„ ë‹¤ë¥¸ íš¨ê³¼
            const patternType = slideIndex % 5;
            
            switch(patternType) {
                case 0: // íšŒì „í•˜ëŠ” ì›ë“¤
                    for (let i = 0; i < 8; i++) {
                        const angle = (time + i * 0.5) * 0.5;
                        const x = width/2 + Math.cos(angle) * (width * 0.3);
                        const y = height/2 + Math.sin(angle) * (height * 0.2);
                        const radius = 50 + Math.sin(time + i) * 20;
                        
                        const circleGradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
                        circleGradient.addColorStop(0, 'rgba(255,255,255,0.3)');
                        circleGradient.addColorStop(1, 'rgba(255,255,255,0)');
                        
                        ctx.fillStyle = circleGradient;
                        ctx.beginPath();
                        ctx.arc(x, y, radius, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    break;
                    
                case 1: // ì›¨ì´ë¸Œ ë¼ì¸ë“¤
                    ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                    ctx.lineWidth = 3;
                    for (let i = 0; i < 6; i++) {
                        ctx.beginPath();
                        for (let x = 0; x <= width; x += 10) {
                            const y = height/2 + Math.sin((x + time * 100 + i * 50) * 0.01) * (100 + i * 20);
                            if (x === 0) ctx.moveTo(x, y);
                            else ctx.lineTo(x, y);
                        }
                        ctx.stroke();
                    }
                    break;
                    
                case 2: // ìœ¡ê°í˜• ê·¸ë¦¬ë“œ
                    const hexSize = 60;
                    for (let row = 0; row < height / hexSize + 2; row++) {
                        for (let col = 0; col < width / hexSize + 2; col++) {
                            const x = col * hexSize * 0.75 - hexSize;
                            const y = row * hexSize - (col % 2) * hexSize * 0.5 - hexSize;
                            const alpha = Math.sin(time + row * 0.5 + col * 0.3) * 0.1 + 0.1;
                            
                            ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
                            ctx.lineWidth = 2;
                            drawHexagon(x, y, hexSize * 0.4);
                        }
                    }
                    break;
                    
                case 3: // íŒŒí‹°í´ íš¨ê³¼
                    for (let i = 0; i < 30; i++) {
                        const x = (Math.sin(time * 0.5 + i * 0.2) * width * 0.3) + width/2;
                        const y = (Math.cos(time * 0.3 + i * 0.15) * height * 0.3) + height/2;
                        const size = Math.sin(time + i) * 3 + 5;
                        
                        const particleGradient = ctx.createRadialGradient(x, y, 0, x, y, size);
                        particleGradient.addColorStop(0, 'rgba(255,255,255,0.6)');
                        particleGradient.addColorStop(1, 'rgba(255,255,255,0)');
                        
                        ctx.fillStyle = particleGradient;
                        ctx.beginPath();
                        ctx.arc(x, y, size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    break;
                    
                case 4: // ê¸°í•˜í•™ì  ì‚¼ê°í˜•
                    for (let i = 0; i < 12; i++) {
                        const angle = (time + i * 0.5) * 0.3;
                        const x = width/2 + Math.cos(angle) * (width * 0.25);
                        const y = height/2 + Math.sin(angle) * (height * 0.25);
                        const size = 40 + Math.sin(time * 2 + i) * 15;
                        
                        ctx.strokeStyle = `rgba(255,255,255,0.2)`;
                        ctx.lineWidth = 2;
                        drawTriangle(x, y, size, angle);
                    }
                    break;
            }
            
            ctx.globalAlpha = 1;
        }

        // ìœ¡ê°í˜• ê·¸ë¦¬ê¸°
        function drawHexagon(x, y, size) {
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = (i * Math.PI) / 3;
                const px = x + Math.cos(angle) * size;
                const py = y + Math.sin(angle) * size;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.stroke();
        }

        // ì‚¼ê°í˜• ê·¸ë¦¬ê¸°
        function drawTriangle(x, y, size, rotation) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.beginPath();
            ctx.moveTo(0, -size);
            ctx.lineTo(-size * 0.866, size * 0.5);
            ctx.lineTo(size * 0.866, size * 0.5);
            ctx.closePath();
            ctx.stroke();
            ctx.restore();
        }

        // ê¸€ë¡œìš° íš¨ê³¼
        function drawGlowEffects(slideIndex) {
            const width = canvas.width;
            const height = canvas.height;
            const time = Date.now() * 0.001;
            
            ctx.globalAlpha = 0.1;
            
            // ì½”ë„ˆ ê¸€ë¡œìš°
            const corners = [
                {x: 0, y: 0},
                {x: width, y: 0},
                {x: 0, y: height},
                {x: width, y: height}
            ];
            
            corners.forEach((corner, i) => {
                const intensity = Math.sin(time + i * 1.5) * 0.5 + 0.5;
                const glowGradient = ctx.createRadialGradient(
                    corner.x, corner.y, 0,
                    corner.x, corner.y, Math.min(width, height) * 0.5
                );
                glowGradient.addColorStop(0, `rgba(255,255,255,${intensity * 0.3})`);
                glowGradient.addColorStop(1, 'rgba(255,255,255,0)');
                
                ctx.fillStyle = glowGradient;
                ctx.fillRect(0, 0, width, height);
            });
            
            ctx.globalAlpha = 1;
        }

        // í…ìŠ¤íŠ¸ ë Œë”ë§ (ë¶„ë¦¬ëœ í•¨ìˆ˜)
        function renderSlideText(slide, slideIndex) {
            const width = canvas.width;
            const height = canvas.height;
            
            // í…ìŠ¤íŠ¸ ìƒ‰ìƒ
            const textColor = slide.textColor || '#ffffff';
            ctx.fillStyle = textColor;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // ê°•í™”ëœ ê·¸ë¦¼ì íš¨ê³¼
            ctx.shadowColor = 'rgba(0,0,0,0.9)';
            ctx.shadowBlur = 25;
            ctx.shadowOffsetX = 4;
            ctx.shadowOffsetY = 4;
            
            // ì•„ì´ì½˜ (ë” í¬ê³  ê¸€ë¡œìš° íš¨ê³¼)
            ctx.font = `${height * 0.12}px Arial`;
            
            // ì•„ì´ì½˜ ê¸€ë¡œìš° íš¨ê³¼
            ctx.shadowColor = 'rgba(255,255,255,0.8)';
            ctx.shadowBlur = 30;
            ctx.fillText(slide.icon || 'ğŸ“±', width / 2, height * 0.25);
            
            // ê·¸ë¦¼ì ë¦¬ì…‹
            ctx.shadowColor = 'rgba(0,0,0,0.9)';
            ctx.shadowBlur = 25;
            
            // ì œëª© (ìœ íŠœë¸Œ ì‡¼ì¸ ìš© í° í…ìŠ¤íŠ¸)
            ctx.font = `bold ${height * 0.06}px Arial Black`;
            const titleLines = wrapText(slide.title, width * 0.85);
            let titleY = height * 0.45;
            
            titleLines.forEach((line, i) => {
                ctx.fillText(line, width / 2, titleY + (i * height * 0.07));
            });
            
            // ë¶€ì œëª©
            ctx.font = `${height * 0.035}px Arial`;
            ctx.fillStyle = textColor === '#ffffff' ? 'rgba(255,255,255,0.95)' : 'rgba(0,0,0,0.8)';
            const subtitleLines = wrapText(slide.subtitle, width * 0.9);
            let subtitleY = height * 0.7;
            
            subtitleLines.forEach((line, i) => {
                ctx.fillText(line, width / 2, subtitleY + (i * height * 0.04));
            });
            
            // íƒ€ì…ë³„ íŠ¹ë³„ íš¨ê³¼
            if (slide.type === 'hook') {
                // Hook ìŠ¬ë¼ì´ë“œì— í„ì‹± í…Œë‘ë¦¬ íš¨ê³¼
                const time = Date.now() * 0.005;
                const pulseIntensity = Math.sin(time) * 0.5 + 0.5;
                
                ctx.strokeStyle = `rgba(255, 255, 0, ${pulseIntensity})`;
                ctx.lineWidth = 8 + pulseIntensity * 4;
                ctx.strokeRect(20, 20, width - 40, height - 40);
                
                // ë‚´ë¶€ ê¸€ë¡œìš°
                ctx.strokeStyle = `rgba(255, 255, 255, ${pulseIntensity * 0.3})`;
                ctx.lineWidth = 2;
                ctx.strokeRect(30, 30, width - 60, height - 60);
                
            } else if (slide.type === 'cta') {
                // CTA ìŠ¬ë¼ì´ë“œì— ì• ë‹ˆë©”ì´ì…˜ ë²„íŠ¼
                const buttonY = height * 0.85;
                const buttonWidth = width * 0.7;
                const buttonHeight = height * 0.08;
                const time = Date.now() * 0.003;
                const pulse = Math.sin(time) * 0.2 + 1;
                
                // ë²„íŠ¼ ê¸€ë¡œìš°
                const buttonGradient = ctx.createRadialGradient(
                    width/2, buttonY, 0,
                    width/2, buttonY, buttonWidth * 0.7
                );
                buttonGradient.addColorStop(0, '#ff0844');
                buttonGradient.addColorStop(1, '#ff6b95');
                
                ctx.fillStyle = buttonGradient;
                ctx.fillRect(
                    (width - buttonWidth * pulse) / 2, 
                    buttonY - (buttonHeight * pulse) / 2, 
                    buttonWidth * pulse, 
                    buttonHeight * pulse
                );
                
                ctx.fillStyle = '#ffffff';
                ctx.font = `bold ${height * 0.03}px Arial`;
                ctx.shadowBlur = 15;
                ctx.fillText('êµ¬ë… & ì¢‹ì•„ìš”!', width / 2, buttonY);
            }
            
            // ê·¸ë¦¼ì ì œê±°
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }

        // í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ (ì‡¼ì¸  ìµœì í™”)
        function wrapText(text, maxWidth) {
            if (!text) return [''];
            
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0] || '';
            
            for (let i = 1; i < words.length; i++) {
                const testLine = currentLine + ' ' + words[i];
                const testWidth = ctx.measureText(testLine).width;
                
                if (testWidth > maxWidth) {
                    lines.push(currentLine);
                    currentLine = words[i];
                } else {
                    currentLine = testLine;
                }
            }
            lines.push(currentLine);
            
            // ì‡¼ì¸ ëŠ” ìµœëŒ€ 3ì¤„ê¹Œì§€ë§Œ
            return lines.slice(0, 3);
        }

        // ì‡¼ì¸  ë¯¸ë¦¬ë³´ê¸°
        async function previewShorts() {
            if (!shortsSlides || shortsSlides.length === 0) return;
            
            stopPreview(); // ê¸°ì¡´ ë¯¸ë¦¬ë³´ê¸° ì •ì§€
            
            let currentSlide = 0;
            let startTime = Date.now();
            
            async function animate() {
                const slide = shortsSlides[currentSlide];
                const duration = (slide.duration || 3) * 1000; // ms ë³€í™˜
                const elapsed = Date.now() - startTime;
                
                if (elapsed >= duration) {
                    currentSlide = (currentSlide + 1) % shortsSlides.length;
                    startTime = Date.now();
                    await renderSlideToCanvas(currentSlide);
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            await renderSlideToCanvas(0);
            animate();
        }

        // ë¯¸ë¦¬ë³´ê¸° ì •ì§€
        function stopPreview() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // ì‡¼ì¸  MP4 ìƒì„±
        async function generateShortsMP4() {
            if (!canvas || !shortsSlides || shortsSlides.length === 0) {
                alert('âŒ ë¨¼ì € ì‡¼ì¸ ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            try {
                showProgressModal(true);
                updateProgress(10, 'ğŸ¬ ì‡¼ì¸  MP4 ì¤€ë¹„', 'ê³ í’ˆì§ˆ ìœ íŠœë¸Œ ì‡¼ì¸  MP4 ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤.');
                
                // Canvas ìŠ¤íŠ¸ë¦¼ ìƒì„±
                const stream = canvas.captureStream(30);
                
                let mimeType = 'video/webm;codecs=vp9';
                let videoBitrate = 8000000; // 8Mbps (ì‡¼ì¸  ìµœì í™”)
                
                if (!MediaRecorder.isTypeSupported(mimeType)) {
                    mimeType = 'video/webm;codecs=vp8';
                    videoBitrate = 5000000;
                }
                
                const mediaRecorder = new MediaRecorder(stream, {
                    mimeType: mimeType,
                    videoBitsPerSecond: videoBitrate
                });
                
                const chunks = [];
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        chunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    videoBlob = new Blob(chunks, { type: mimeType });
                    showProgressModal(false);
                    showDownloadSection();
                };
                
                updateProgress(25, 'ğŸ“¹ ë…¹í™” ì‹œì‘', 'ê° ìŠ¬ë¼ì´ë“œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë…¹í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
                mediaRecorder.start(100);
                
                // ê° ìŠ¬ë¼ì´ë“œ ë Œë”ë§
                for (let i = 0; i < shortsSlides.length; i++) {
                    const slide = shortsSlides[i];
                    const progress = 25 + (i / shortsSlides.length) * 65;
                    
                    updateProgress(progress, `ğŸ“± ìŠ¬ë¼ì´ë“œ ${i + 1} ë…¹í™”`, `"${slide.title}" ìŠ¬ë¼ì´ë“œë¥¼ ë…¹í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤.`);
                    
                    await renderSlideToCanvas(i);
                    
                    // ìŠ¬ë¼ì´ë“œ ì§€ì†ì‹œê°„ë§Œí¼ ëŒ€ê¸°
                    const duration = (slide.duration || 3) * 1000;
                    await delay(duration);
                }
                
                updateProgress(95, 'ğŸ ë§ˆë¬´ë¦¬', 'ì‡¼ì¸  ë¹„ë””ì˜¤ë¥¼ ìµœì¢… ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
                mediaRecorder.stop();
                
            } catch (error) {
                console.error('ì‡¼ì¸  MP4 ìƒì„± ì˜¤ë¥˜:', error);
                showProgressModal(false);
                alert('âŒ ì‡¼ì¸  MP4 ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì‡¼ì¸  ë‹¤ìš´ë¡œë“œ
        function downloadShorts() {
            if (!videoBlob) {
                alert('âŒ ìƒì„±ëœ ì‡¼ì¸  ë¹„ë””ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            const url = URL.createObjectURL(videoBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `youtube-shorts-${new Date().getTime()}.webm`;
            a.click();
            
            URL.revokeObjectURL(url);
            
            const fileSize = Math.round(videoBlob.size / 1024 / 1024 * 100) / 100;
            
            alert(`ğŸ‰ ìœ íŠœë¸Œ ì‡¼ì¸  ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!

ğŸ“Š íŒŒì¼ ì •ë³´:
â€¢ íŒŒì¼ëª…: youtube-shorts-${new Date().getTime()}.webm
â€¢ í¬ê¸°: ${fileSize} MB
â€¢ í•´ìƒë„: 1080Ã—1920 (ì™„ë²½í•œ 9:16 ë¹„ìœ¨)
â€¢ ê¸¸ì´: ${shortsSlides.reduce((sum, s) => sum + (s.duration || 3), 0)}ì´ˆ

ğŸš€ ë°”ë¡œ ìœ íŠœë¸Œì— ì—…ë¡œë“œí•˜ì„¸ìš”!
ëª¨ë°”ì¼ì— ìµœì í™”ëœ ê³ í’ˆì§ˆ ì‡¼ì¸ ì…ë‹ˆë‹¤.`);
        }

        // ë¯¸ë¦¬ë³´ê¸° ì„¹ì…˜ í‘œì‹œ
        function showPreviewSection() {
            const section = document.getElementById('previewSection');
            if (section) {
                section.style.display = 'block';
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ í‘œì‹œ
        function showDownloadSection() {
            const section = document.getElementById('downloadSection');
            if (section) {
                section.style.display = 'block';
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // í”„ë¡œê·¸ë˜ìŠ¤ ëª¨ë‹¬ ì œì–´
        function showProgressModal(show) {
            const modal = document.getElementById('progressModal');
            if (modal) {
                modal.classList.toggle('show', show);
            }
        }

        // í”„ë¡œê·¸ë˜ìŠ¤ ì—…ë°ì´íŠ¸
        function updateProgress(percent, title, desc) {
            const fill = document.getElementById('progressFill');
            const text = document.getElementById('progressText');
            const titleEl = document.getElementById('progressTitle');
            const descEl = document.getElementById('progressDesc');
            
            if (fill) fill.style.width = `${Math.min(100, percent)}%`;
            if (text) text.textContent = `${Math.round(percent)}%`;
            if (titleEl) titleEl.textContent = title;
            if (descEl) descEl.textContent = desc;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ì—ëŸ¬ ì²˜ë¦¬
        window.addEventListener('error', function(event) {
            console.error('ì „ì—­ ì˜¤ë¥˜:', event.error);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Promise ê±°ë¶€:', event.reason);
            event.preventDefault();
        });
    </script>
</body>
</html>
