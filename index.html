<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† 100ë§Œ ìœ íŠœë²„ ìë™ ìƒì„±ê¸° Ultimate</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
            --danger: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            --dark: #1a1a1a;
            --light: #ffffff;
            --shadow: 0 20px 60px rgba(0,0,0,0.3);
            --glow: 0 0 40px rgba(102, 126, 234, 0.6);
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 70%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            color: white;
            overflow-x: hidden;
            line-height: 1.6;
            min-height: 100vh;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        /* ë©”ì¸ í—¤ë” */
        .hero {
            text-align: center;
            padding: 100px 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 30px;
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
            border: 3px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.1), transparent);
            animation: heroRotate 25s linear infinite;
            z-index: -1;
        }

        @keyframes heroRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .hero h1 {
            font-size: clamp(3em, 8vw, 5em);
            font-weight: 900;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff6b6b);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: textShimmer 5s ease infinite;
            filter: drop-shadow(0 0 30px rgba(255,255,255,0.3));
        }

        @keyframes textShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hero-subtitle {
            font-size: 1.8em;
            opacity: 0.95;
            margin-bottom: 40px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.7);
        }

        .hero-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 50px;
        }

        .feature-card {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255,255,255,0.2);
            transition: all 0.4s ease;
            text-align: center;
        }

        .feature-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border-color: #4ecdc4;
        }

        .feature-icon {
            font-size: 3.5em;
            margin-bottom: 20px;
            display: block;
            filter: drop-shadow(0 0 15px currentColor);
        }

        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section {
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            padding: 50px;
            margin: 40px 0;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.8s ease;
        }

        .section:hover::before {
            left: 100%;
        }

        .section.connected {
            background: rgba(0,255,100,0.15);
            border-color: rgba(0,255,100,0.5);
            box-shadow: var(--glow);
        }

        .section h2 {
            font-size: 2.5em;
            margin-bottom: 30px;
            text-align: center;
            color: #4ecdc4;
            text-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
            font-weight: 900;
        }

        /* ì…ë ¥ í•„ë“œ */
        .input-group {
            margin: 30px 0;
        }

        .input-label {
            display: block;
            font-weight: 700;
            margin-bottom: 15px;
            color: #4ecdc4;
            font-size: 1.4em;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }

        .input-field {
            width: 100%;
            padding: 22px 30px;
            background: rgba(255,255,255,0.1);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            color: white;
            font-size: 1.3em;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.4);
            transform: scale(1.02);
            background: rgba(255,255,255,0.15);
        }

        .input-field::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .textarea-field {
            min-height: 200px;
            resize: vertical;
            line-height: 1.6;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s ease;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
            margin: 12px;
            font-family: inherit;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: all 0.6s ease;
            transform: translate(-50%, -50%);
        }

        .btn:hover:not(:disabled)::before {
            width: 400px;
            height: 400px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-generate {
            background: var(--secondary);
            color: white;
            font-size: 1.8em;
            padding: 30px 60px;
            border-radius: 30px;
            display: block;
            width: 100%;
            max-width: 800px;
            margin: 60px auto;
            position: relative;
            z-index: 1;
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.4s ease;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* ëª¨ë“œ ì„ íƒ */
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .mode-card {
            background: rgba(255,255,255,0.1);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s ease;
        }

        .mode-card:hover::before {
            left: 100%;
        }

        .mode-card.selected {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
            box-shadow: 0 0 40px rgba(78, 205, 196, 0.4);
            transform: translateY(-5px);
        }

        .mode-card:hover {
            transform: translateY(-8px);
            border-color: #4ecdc4;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .mode-icon {
            font-size: 4em;
            margin-bottom: 20px;
            display: block;
            filter: drop-shadow(0 0 20px currentColor);
        }

        /* API ì„¤ì • */
        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }

        .api-card {
            background: rgba(255,255,255,0.1);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(15px);
            transition: all 0.3s ease;
        }

        .api-card.connected {
            border-color: #43e97b;
            background: rgba(67, 233, 123, 0.1);
            box-shadow: 0 0 30px rgba(67, 233, 123, 0.3);
        }

        /* ì§„í–‰ ìƒí™© ëª¨ë‹¬ */
        .progress-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            backdrop-filter: blur(20px);
        }

        .progress-modal.show {
            display: flex;
        }

        .progress-content {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 35px;
            padding: 80px;
            text-align: center;
            backdrop-filter: blur(30px);
            max-width: 600px;
            width: 90%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 30px 80px rgba(0,0,0,0.5);
        }

        .progress-icon {
            font-size: 6em;
            margin-bottom: 30px;
            animation: progressRotate 3s ease-in-out infinite;
            filter: drop-shadow(0 0 40px currentColor);
        }

        @keyframes progressRotate {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            overflow: hidden;
            margin: 30px 0;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(79, 172, 254, 0.5);
        }

        /* ê²°ê³¼ ì„¹ì…˜ */
        .result-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 30px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 1.1em;
        }

        .tab-btn.active {
            background: rgba(78,205,196,0.3);
            border-color: #4ecdc4;
            color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78,205,196,0.3);
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: #4ecdc4;
        }

        .tab-content {
            display: none;
            margin: 30px 0;
        }

        .tab-content.active {
            display: block;
        }

        /* ìŠ¬ë¼ì´ë“œì‡¼ */
        .slideshow-container {
            position: relative;
            max-width: 600px;
            margin: 40px auto;
            background: #000;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 4px solid rgba(255,255,255,0.3);
            aspect-ratio: 9/16;
        }

        .slide {
            display: none;
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .slide.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 30px;
            animation: slideIn 1s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .slide-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                135deg,
                rgba(0,0,0,0.7) 0%,
                rgba(0,0,0,0.3) 50%,
                rgba(0,0,0,0.7) 100%
            );
            z-index: 1;
        }

        .slide-content {
            position: relative;
            z-index: 3;
            text-align: center;
            max-width: 100%;
        }

        .slide-icon {
            font-size: 4.5em;
            margin-bottom: 25px;
            animation: iconFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 0 20px currentColor);
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        .slide-title {
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 3px 3px 10px rgba(0,0,0,0.8);
            line-height: 1.1;
            background: linear-gradient(45deg, #fff, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            word-wrap: break-word;
        }

        .slide-subtitle {
            font-size: 1.4em;
            opacity: 0.95;
            margin-bottom: 25px;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
            line-height: 1.4;
            word-wrap: break-word;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .slide-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255,255,255,0.15);
            border: 3px solid rgba(255,255,255,0.4);
            color: white;
            padding: 18px 30px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(15px);
            font-weight: 700;
            font-size: 1.2em;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .slide-counter {
            background: rgba(0,0,0,0.7);
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: 700;
            color: #4ecdc4;
            font-size: 1.3em;
            border: 3px solid rgba(78, 205, 196, 0.3);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }

        /* ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ */
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .gallery-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            aspect-ratio: 1;
        }

        .gallery-item:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: #4ecdc4;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 0.9em;
            font-weight: bold;
        }

        /* ìƒíƒœ ë©”ì‹œì§€ */
        .status-message {
            margin: 25px 0;
            padding: 20px 35px;
            border-radius: 20px;
            font-weight: 700;
            text-align: center;
            display: none;
            backdrop-filter: blur(15px);
            font-size: 1.2em;
            border: 2px solid;
        }

        .status-message.success {
            background: rgba(0,255,100,0.2);
            border-color: rgba(0,255,100,0.5);
            color: #00ff88;
            box-shadow: 0 0 30px rgba(0,255,100,0.3);
        }

        .status-message.error {
            background: rgba(255,0,100,0.2);
            border-color: rgba(255,0,100,0.5);
            color: #ff6b6b;
            box-shadow: 0 0 30px rgba(255,0,100,0.3);
        }

        .status-message.warning {
            background: rgba(255,165,0,0.2);
            border-color: rgba(255,165,0,0.5);
            color: #ffa500;
            box-shadow: 0 0 30px rgba(255,165,0,0.3);
        }

        /* ë…¹í™” UI */
        .recording-ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(30,30,60,0.98) 100%);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(20px);
        }

        .recording-ui.show {
            display: flex;
        }

        .recording-content {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 4px solid rgba(255,68,68,0.6);
            border-radius: 35px;
            padding: 60px;
            text-align: center;
            backdrop-filter: blur(30px);
            max-width: 700px;
            box-shadow: 0 0 60px rgba(255,68,68,0.3);
            position: relative;
            overflow: hidden;
        }

        .recording-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255,68,68,0.1), transparent);
            animation: recordingRotate 10s linear infinite;
            z-index: -1;
        }

        @keyframes recordingRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ì„±ê³µ ì•Œë¦¼ */
        .success-notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 25px 35px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 15px 40px rgba(67, 233, 123, 0.4);
            transform: translateX(500px);
            transition: transform 0.6s ease;
            z-index: 8000;
            font-size: 1.1em;
        }

        .success-notification.show {
            transform: translateX(0);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .hero {
                padding: 60px 20px;
            }
            
            .section {
                padding: 30px 20px;
            }
            
            .hero h1 {
                font-size: 2.5em;
            }
            
            .hero-subtitle {
                font-size: 1.4em;
            }
            
            .slide-title {
                font-size: 2em;
            }
            
            .slide-subtitle {
                font-size: 1.2em;
            }
            
            .mode-selector {
                grid-template-columns: 1fr;
            }
            
            .api-grid {
                grid-template-columns: 1fr;
            }
            
            .image-gallery {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .slide-navigation {
                gap: 20px;
            }
            
            .nav-btn {
                padding: 15px 25px;
                font-size: 1em;
            }
            
            .btn-generate {
                font-size: 1.4em;
                padding: 25px 40px;
            }
        }

        /* ì• ë‹ˆë©”ì´ì…˜ í‚¤í”„ë ˆì„ */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(78, 205, 196, 0.3); }
            50% { box-shadow: 0 0 40px rgba(78, 205, 196, 0.8); }
        }

        /* íŠ¹ìˆ˜ íš¨ê³¼ */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            animation: particleFloat 8s ease-in-out infinite;
        }

        @keyframes particleFloat {
            0%, 100% {
                transform: translateY(0) translateX(0) scale(1);
                opacity: 0.6;
            }
            50% {
                transform: translateY(-30px) translateX(15px) scale(1.3);
                opacity: 1;
            }
        }

        /* ì¶”ê°€ ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .p-20 { padding: 20px; }
        .p-30 { padding: 30px; }
        
        .hidden { display: none !important; }
        .visible { display: block !important; }
        
        .loading {
            animation: spin 1s linear infinite;
        }
        
        .pulsing {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .glowing {
            animation: glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <!-- ë– ë‹¤ë‹ˆëŠ” íŒŒí‹°í´ ì‹œìŠ¤í…œ -->
    <div class="floating-particles" id="floatingParticles"></div>

    <div class="container">
        <!-- ë©”ì¸ í—¤ë” -->
        <div class="hero">
            <h1>ğŸ† 100ë§Œ ìœ íŠœë²„ ìë™ ìƒì„±ê¸°</h1>
            <p class="hero-subtitle">GPT-4 + DALL-E 3ë¡œ ì½˜í…ì¸ ë¶€í„° ì´ë¯¸ì§€, ì˜ìƒê¹Œì§€ ì™„ì „ ìë™í™”!</p>
            
            <div class="hero-features">
                <div class="feature-card">
                    <span class="feature-icon">ğŸ¤–</span>
                    <h3>GPT-4 ì‹¤ì œ ë¶„ì„</h3>
                    <p>í‚¤ì›Œë“œë§Œ ì…ë ¥í•˜ë©´ ë°”ì´ëŸ´ ì½˜í…ì¸  ìë™ ìƒì„±</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ğŸ¨</span>
                    <h3>DALL-E 3 ì´ë¯¸ì§€</h3>
                    <p>AIê°€ ë§Œë“  ì™„ë²½í•œ ì¸ë„¤ì¼ê³¼ ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ğŸ¬</span>
                    <h3>ìë™ ì˜ìƒ ìƒì„±</h3>
                    <p>ìœ íŠœë¸Œ ì‡¼ì¸  ì™„ë²½ ìµœì í™” 45ì´ˆ ì˜ìƒ</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ğŸš€</span>
                    <h3>100ë§Œë·° ìµœì í™”</h3>
                    <p>ë°”ì´ëŸ´ ê³µì‹ ì ìš©ëœ ì™„ë²½í•œ ì½˜í…ì¸ </p>
                </div>
            </div>
        </div>

        <!-- API ì„¤ì • ì„¹ì…˜ -->
        <div class="section">
            <h2>ğŸ”‘ AI ì—”ì§„ ì„¤ì •</h2>
            <p style="text-align: center; margin-bottom: 30px; font-size: 1.2em;">
                GPT-4ì™€ DALL-E 3ì„ ì—°ê²°í•˜ì—¬ ì™„ì „ ìë™í™”ëœ ì½˜í…ì¸  ìƒì„±ì„ ì‹œì‘í•˜ì„¸ìš”
            </p>
            
            <div class="api-grid">
                <!-- OpenAI API ì„¤ì • -->
                <div class="api-card" id="openaiCard">
                    <h3 style="color: #4ecdc4; margin-bottom: 20px; font-size: 1.8em;">ğŸ§  OpenAI API</h3>
                    
                    <div class="input-group">
                        <label class="input-label">ğŸ”‘ API í‚¤</label>
                        <input type="password" class="input-field" id="openaiKey" 
                               placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">ğŸ¤– GPT ëª¨ë¸</label>
                        <div class="mode-selector" style="margin: 15px 0;">
                            <div class="mode-card selected" id="gpt4oCard" onclick="selectGPTModel('gpt-4o')">
                                <span class="mode-icon">ğŸ§ </span>
                                <h4>GPT-4o</h4>
                                <p>ìµœê³  ì„±ëŠ¥, ì™„ë²½í•œ ë¶„ì„</p>
                            </div>
                            <div class="mode-card" id="gpt4Card" onclick="selectGPTModel('gpt-4')">
                                <span class="mode-icon">âš¡</span>
                                <h4>GPT-4</h4>
                                <p>ì•ˆì •ì ì´ê³  ì •í™•í•œ ë¶„ì„</p>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="connectOpenAIBtn">ğŸ”— OpenAI ì—°ê²°</button>
                    <div class="status-message" id="openaiStatus"></div>
                </div>

                <!-- DALL-E 3 ì„¤ì • -->
                <div class="api-card" id="dalleCard">
                    <h3 style="color: #4ecdc4; margin-bottom: 20px; font-size: 1.8em;">ğŸ¨ DALL-E 3</h3>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <h4 style="color: #feca57; margin-bottom: 15px;">ğŸ¯ ì´ë¯¸ì§€ ìƒì„± ì„¤ì •</h4>
                        
                        <div class="input-group">
                            <label class="input-label">ğŸ–¼ï¸ ì´ë¯¸ì§€ í’ˆì§ˆ</label>
                            <select class="input-field" id="imageQuality">
                                <option value="hd">HD (ê³ í’ˆì§ˆ) - ì¶”ì²œ</option>
                                <option value="standard">í‘œì¤€ (ë¹ ë¥¸ ìƒì„±)</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">ğŸ“ ì´ë¯¸ì§€ í¬ê¸°</label>
                            <select class="input-field" id="imageSize">
                                <option value="1024x1792">ì„¸ë¡œí˜• (1024x1792) - ì‡¼ì¸  ìµœì í™”</option>
                                <option value="1792x1024">ê°€ë¡œí˜• (1792x1024)</option>
                                <option value="1024x1024">ì •ì‚¬ê°í˜• (1024x1024)</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">ğŸ¨ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼</label>
                            <select class="input-field" id="imageStyle">
                                <option value="vivid">ìƒìƒí•¨ (Vivid) - ë°”ì´ëŸ´ ìµœì í™”</option>
                                <option value="natural">ìì—°ìŠ¤ëŸ¬ì›€ (Natural)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" id="testDALLEBtn">ğŸ¨ DALL-E 3 í…ŒìŠ¤íŠ¸</button>
                    <div class="status-message" id="dalleStatus"></div>
                </div>
            </div>
            
            <!-- ì—°ê²° ìƒíƒœ í™•ì¸ -->
            <div style="background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 20px; padding: 30px; margin: 30px 0; text-align: center;">
                <h3 style="color: #4ecdc4; margin-bottom: 20px;">ğŸ”— AI ì—°ê²° ìƒíƒœ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div id="gptStatus" style="padding: 15px; border-radius: 15px; background: rgba(255,68,68,0.2); border: 2px solid rgba(255,68,68,0.5);">
                        <div style="font-size: 2em; margin-bottom: 10px;">âŒ</div>
                        <div>GPT-4 ì—°ê²° ëŒ€ê¸°ì¤‘</div>
                    </div>
                    <div id="dalleConnectionStatus" style="padding: 15px; border-radius: 15px; background: rgba(255,68,68,0.2); border: 2px solid rgba(255,68,68,0.5);">
                        <div style="font-size: 2em; margin-bottom: 10px;">âŒ</div>
                        <div>DALL-E 3 ì—°ê²° ëŒ€ê¸°ì¤‘</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì½˜í…ì¸  ìƒì„± ì„¹ì…˜ -->
        <div class="section">
            <h2>ğŸš€ ë°”ì´ëŸ´ ì½˜í…ì¸  ìë™ ìƒì„±</h2>
            <p style="text-align: center; margin-bottom: 30px; font-size: 1.2em;">
                í‚¤ì›Œë“œë‚˜ ì£¼ì œë§Œ ì…ë ¥í•˜ë©´ 100ë§Œë·° ì½˜í…ì¸ ê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤
            </p>
            
            <!-- ìƒì„± ëª¨ë“œ ì„ íƒ -->
            <div class="input-group">
                <label class="input-label">ğŸ¯ ìƒì„± ëª¨ë“œ</label>
                <div class="mode-selector">
                    <div class="mode-card selected" id="autoMode" onclick="selectGenerationMode('auto')">
                        <span class="mode-icon">ğŸ¤–</span>
                        <h3>ì™„ì „ ìë™ ëª¨ë“œ</h3>
                        <p>í‚¤ì›Œë“œë§Œ ì…ë ¥í•˜ë©´ ì½˜í…ì¸ ë¶€í„° ì´ë¯¸ì§€ê¹Œì§€ ìë™ ìƒì„±</p>
                        <div style="color: #43e97b; font-weight: bold; margin-top: 10px;">âœ… ì¶”ì²œ (100ë§Œë·° ìµœì í™”)</div>
                    </div>
                    <div class="mode-card" id="semiAutoMode" onclick="selectGenerationMode('semi-auto')">
                        <span class="mode-icon">âœï¸</span>
                        <h3>ë°˜ìë™ ëª¨ë“œ</h3>
                        <p>ì œëª©ê³¼ ë‚´ìš©ì„ ì§ì ‘ ì…ë ¥í•˜ê³  ì´ë¯¸ì§€ëŠ” ìë™ ìƒì„±</p>
                        <div style="color: #feca57; font-weight: bold; margin-top: 10px;">âš¡ ë¹ ë¥¸ ì œì‘</div>
                    </div>
                    <div class="mode-card" id="manualMode" onclick="selectGenerationMode('manual')">
                        <span class="mode-icon">ğŸ“</span>
                        <h3>ìˆ˜ë™ ëª¨ë“œ</h3>
                        <p>ëª¨ë“  ë‚´ìš©ì„ ì§ì ‘ ì…ë ¥ (ê¸°ì¡´ ë°©ì‹)</p>
                        <div style="color: #95a5a6; font-weight: bold; margin-top: 10px;">ğŸ› ï¸ ì»¤ìŠ¤í…€</div>
                    </div>
                </div>
            </div>

            <!-- ì™„ì „ ìë™ ëª¨ë“œ ì…ë ¥ -->
            <div id="autoModeInputs" class="mode-inputs">
                <div class="input-group">
                    <label class="input-label">ğŸ”¥ ë°”ì´ëŸ´ í‚¤ì›Œë“œ ë˜ëŠ” ì£¼ì œ</label>
                    <input type="text" class="input-field" id="viralKeyword" 
                           placeholder="ì˜ˆ: AI, íˆ¬ì, ë‹¤ì´ì–´íŠ¸, ì—°ì• , ë¶€ì—…, ì„±ê³µë¹„ë²• ë“±">
                </div>
                
                <div class="input-group">
                    <label class="input-label">ğŸ¯ íƒ€ê²Ÿ ì±„ë„ ìœ í˜•</label>
                    <select class="input-field" id="channelType">
                        <option value="educational">êµìœ¡/ì •ë³´ (How-to, íŒ)</option>
                        <option value="entertainment">ì—”í„°í…Œì¸ë¨¼íŠ¸ (ì¬ë¯¸, ìœ ë¨¸)</option>
                        <option value="lifestyle">ë¼ì´í”„ìŠ¤íƒ€ì¼ (ì¼ìƒ, ì·¨ë¯¸)</option>
                        <option value="business">ë¹„ì¦ˆë‹ˆìŠ¤ (ì°½ì—…, íˆ¬ì)</option>
                        <option value="motivation">ë™ê¸°ë¶€ì—¬ (ì„±ê³µ, ìê¸°ê³„ë°œ)</option>
                        <option value="trending">íŠ¸ë Œë“œ (ìµœì‹  ì´ìŠˆ)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="input-label">ğŸ¨ ì½˜í…ì¸  í†¤ì•¤ë§¤ë„ˆ</label>
                    <select class="input-field" id="contentTone">
                        <option value="casual">ì¹œê·¼í•˜ê³  ìºì£¼ì–¼</option>
                        <option value="professional">ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ”</option>
                        <option value="energetic">ì—ë„ˆì§€ ë„˜ì¹˜ê³  ì—´ì •ì ì¸</option>
                        <option value="mysterious">ì‹ ë¹„ë¡­ê³  í˜¸ê¸°ì‹¬ ìœ ë°œ</option>
                        <option value="humorous">ìœ ë¨¸ëŸ¬ìŠ¤í•˜ê³  ì¬ë¯¸ìˆëŠ”</option>
                    </select>
                </div>
            </div>

            <!-- ë°˜ìë™ ëª¨ë“œ ì…ë ¥ -->
            <div id="semiAutoModeInputs" class="mode-inputs hidden">
                <div class="input-group">
                    <label class="input-label">ğŸ“ ì½˜í…ì¸  ì œëª©</label>
                    <input type="text" class="input-field" id="contentTitle" 
                           placeholder="ë§¤ë ¥ì ì¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="input-group">
                    <label class="input-label">ğŸ“„ ì½˜í…ì¸  ë‚´ìš©</label>
                    <textarea class="input-field textarea-field" id="contentDescription" 
                              placeholder="ì „ë‹¬í•˜ê³  ì‹¶ì€ ë©”ì‹œì§€ë‚˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
            </div>

            <!-- ìˆ˜ë™ ëª¨ë“œ ì…ë ¥ -->
            <div id="manualModeInputs" class="mode-inputs hidden">
                <div class="input-group">
                    <label class="input-label">ğŸ“ ì œëª©</label>
                    <input type="text" class="input-field" id="manualTitle" 
                           placeholder="ìŠ¬ë¼ì´ë“œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="input-group">
                    <label class="input-label">ğŸ“„ ë‚´ìš©</label>
                    <textarea class="input-field textarea-field" id="manualContent" 
                              placeholder="ìŠ¬ë¼ì´ë“œì— í¬í•¨í•  ë‚´ìš©ì„ ìƒì„¸íˆ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
            </div>

            <!-- ê³ ê¸‰ ì„¤ì • -->
            <div style="background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 20px; padding: 30px; margin: 30px 0;">
                <h3 style="color: #4ecdc4; margin-bottom: 20px;">âš™ï¸ ê³ ê¸‰ ì„¤ì •</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div class="input-group">
                        <label class="input-label">ğŸ“Š ìŠ¬ë¼ì´ë“œ ê°œìˆ˜</label>
                        <select class="input-field" id="slideCount">
                            <option value="10">10ì¥ (ì§§ê³  ì„íŒ©íŠ¸)</option>
                            <option value="15" selected>15ì¥ (ìµœì  ê¸¸ì´)</option>
                            <option value="20">20ì¥ (ìƒì„¸í•œ ì„¤ëª…)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">ğŸ¨ ë¹„ì£¼ì–¼ ìŠ¤íƒ€ì¼</label>
                        <select class="input-field" id="visualStyle">
                            <option value="modern">ëª¨ë˜í•˜ê³  ì„¸ë ¨ëœ</option>
                            <option value="minimalist">ë¯¸ë‹ˆë©€í•˜ê³  ê¹”ë”í•œ</option>
                            <option value="colorful">ë‹¤ì±„ë¡­ê³  í™œê¸°ì°¬</option>
                            <option value="elegant">ìš°ì•„í•˜ê³  ê³ ê¸‰ìŠ¤ëŸ¬ìš´</option>
                            <option value="trendy">íŠ¸ë Œë””í•˜ê³  ì Šì€</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">ğŸ¬ ì• ë‹ˆë©”ì´ì…˜</label>
                        <select class="input-field" id="animationStyle">
                            <option value="smooth">ë¶€ë“œëŸ¬ìš´ ì „í™˜</option>
                            <option value="dynamic">ì—­ë™ì ì¸ ì›€ì§ì„</option>
                            <option value="minimal">ìµœì†Œí•œì˜ ì›€ì§ì„</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">ğŸµ ë°°ê²½ìŒì•…</label>
                        <select class="input-field" id="backgroundMusic">
                            <option value="upbeat">ì—…ë¹„íŠ¸ (ì—ë„ˆì§€ ë„˜ì¹˜ëŠ”)</option>
                            <option value="ambient">ì— ë¹„ì–¸íŠ¸ (ì°¨ë¶„í•œ)</option>
                            <option value="corporate">ë¹„ì¦ˆë‹ˆìŠ¤ (ì „ë¬¸ì ì¸)</option>
                            <option value="none">ìŒì•… ì—†ìŒ</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ìƒì„± ë²„íŠ¼ -->
            <button class="btn-generate" id="generateButton" onclick="startAutoGeneration()" disabled>
                ğŸš€ 100ë§Œë·° ì½˜í…ì¸  ìë™ ìƒì„±í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div id="resultSection" class="section hidden">
            <h2>ğŸ‰ ì™„ì„±ëœ ë°”ì´ëŸ´ ì½˜í…ì¸ </h2>
            
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="result-tabs">
                <button class="tab-btn active" onclick="showTab('preview')">ğŸ¬ ë¯¸ë¦¬ë³´ê¸°</button>
                <button class="tab-btn" onclick="showTab('images')">ğŸ¨ AI ì´ë¯¸ì§€</button>
                <button class="tab-btn" onclick="showTab('content')">ğŸ“ ì½˜í…ì¸ </button>
                <button class="tab-btn" onclick="showTab('analytics')">ğŸ“Š ë¶„ì„</button>
            </div>

            <!-- ë¯¸ë¦¬ë³´ê¸° íƒ­ -->
            <div id="previewTab" class="tab-content active">
                <div class="slideshow-container" id="slideshowContainer">
                    <!-- ìŠ¬ë¼ì´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <div class="slide-navigation">
                    <button class="nav-btn" onclick="prevSlide()">â¬…ï¸ ì´ì „</button>
                    <span class="slide-counter" id="slideCounter">1 / 15</span>
                    <button class="nav-btn" onclick="nextSlide()">ë‹¤ìŒ â¡ï¸</button>
                    <button class="nav-btn" onclick="toggleAutoPlay()" id="autoPlayBtn">â–¶ï¸ ìë™ì¬ìƒ</button>
                </div>
            </div>

            <!-- AI ì´ë¯¸ì§€ íƒ­ -->
            <div id="imagesTab" class="tab-content">
                <h3 style="text-align: center; margin-bottom: 20px;">ğŸ¨ DALL-E 3ê°€ ìƒì„±í•œ ì´ë¯¸ì§€ë“¤</h3>
                <div class="image-gallery" id="imageGallery">
                    <!-- AI ìƒì„± ì´ë¯¸ì§€ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ì½˜í…ì¸  íƒ­ -->
            <div id="contentTab" class="tab-content">
                <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“ ìƒì„±ëœ ì½˜í…ì¸ </h3>
                <div id="generatedContent" style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; line-height: 1.8;">
                    <!-- ìƒì„±ëœ ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ë¶„ì„ íƒ­ -->
            <div id="analyticsTab" class="tab-content">
                <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“Š ë°”ì´ëŸ´ ë¶„ì„</h3>
                <div id="contentAnalytics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <!-- ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
            <div style="text-align: center; margin: 40px 0;">
                <button class="btn btn-danger" onclick="startRecording()" style="font-size: 1.5em; padding: 25px 50px; margin: 10px;">
                    ğŸ¬ ì˜ìƒ ë…¹í™”í•˜ê¸°
                </button>
                <button class="btn btn-primary" onclick="downloadContent()" style="font-size: 1.3em; padding: 20px 40px; margin: 10px;">
                    ğŸ’¾ ì½˜í…ì¸  ë‹¤ìš´ë¡œë“œ
                </button>
                <button class="btn btn-secondary" onclick="shareToYouTube()" style="font-size: 1.3em; padding: 20px 40px; margin: 10px;">
                    ğŸ“º ìœ íŠœë¸Œ ì—…ë¡œë“œ
                </button>
                <button class="btn btn-success" onclick="regenerateContent()" style="font-size: 1.3em; padding: 20px 40px; margin: 10px;">
                    ğŸ”„ ë‹¤ì‹œ ìƒì„±í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ì§„í–‰ ìƒí™© ëª¨ë‹¬ -->
    <div class="progress-modal" id="progressModal">
        <div class="progress-content">
            <div class="progress-icon" id="progressIcon">ğŸ¤–</div>
            <h3 id="progressTitle">AIê°€ ë°”ì´ëŸ´ ì½˜í…ì¸ ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h3>
            <p id="progressDesc">GPT-4ê°€ 100ë§Œë·° ê³µì‹ì„ ì ìš©í•´ì„œ ìµœì ì˜ ì½˜í…ì¸ ë¥¼ ìƒì„±ì¤‘ì…ë‹ˆë‹¤.</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="progressText" style="font-size: 1.4em; font-weight: bold; color: #4ecdc4; margin-top: 20px;">0%</div>
        </div>
    </div>

    <!-- ë…¹í™” UI -->
    <div class="recording-ui" id="recordingUI">
        <div class="recording-content">
            <div style="font-size: 6em; margin-bottom: 30px; animation: pulse 2s infinite;">ğŸ¬</div>
            <h2 style="color: #ff4444; margin-bottom: 25px; font-size: 3em; font-weight: 900;">
                ì™„ë²½í•œ ì˜ìƒ ë…¹í™” ì¤‘
            </h2>
            <p style="color: white; margin-bottom: 30px; font-size: 1.5em; line-height: 1.6;">
                ìœ íŠœë¸Œ ì‡¼ì¸  ìµœì í™” 45ì´ˆ ì˜ìƒì„ ë…¹í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤<br>
                <span style="color: #4ecdc4; font-weight: bold;">100% ì™„ì„±ì´ ë³´ì¥ë©ë‹ˆë‹¤!</span>
            </p>
            <div id="recordingProgress" style="background: rgba(255,255,255,0.2); height: 30px; border-radius: 15px; overflow: hidden; margin: 30px 0; border: 2px solid rgba(255,68,68,0.3);">
                <div id="recordingProgressBar" style="background: linear-gradient(45deg, #ff4444, #ff6666); height: 100%; width: 0%; transition: width 0.8s ease; border-radius: 12px;"></div>
            </div>
            <div id="recordingStatus" style="color: #4ecdc4; font-weight: bold; font-size: 1.5em; margin-bottom: 25px;">
                ì•ˆì •ì ì¸ ë…¹í™” ì‹œì‘...
            </div>
            <button onclick="stopRecording()" style="padding: 20px 40px; background: linear-gradient(45deg, #ff4444, #ff6666); color: white; border: none; border-radius: 20px; font-size: 1.4em; cursor: pointer; font-weight: bold;">
                â¹ï¸ ë…¹í™” ì¤‘ì§€
            </button>
        </div>
    </div>

    <script>
        // ===== ì „ì—­ ë³€ìˆ˜ ì‹œìŠ¤í…œ =====
        let openaiApiKey = '';
        let selectedGPTModel = 'gpt-4o';
        let selectedGenerationMode = 'auto';
        let generatedSlides = [];
        let generatedImages = [];
        let currentSlide = 0;
        let autoPlayInterval = null;
        let isAutoPlaying = false;
        
        // ë…¹í™” ì‹œìŠ¤í…œ
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;
        let recordingCanvas = null;
        let recordingCtx = null;
        
        // ìƒì„± ì„¤ì •
        let generationConfig = {
            slideCount: 15,
            visualStyle: 'modern',
            animationStyle: 'smooth',
            backgroundMusic: 'upbeat',
            imageQuality: 'hd',
            imageSize: '1024x1792',
            imageStyle: 'vivid'
        };
        
        // ë°”ì´ëŸ´ ì½˜í…ì¸  ë¶„ì„ ì—”ì§„
        const viralPatterns = {
            educational: {
                hooks: ['ë†€ë¼ìš´ ì‚¬ì‹¤', 'ì•„ë¬´ë„ ëª¨ë¥´ëŠ”', 'ì „ë¬¸ê°€ê°€ ì•Œë ¤ì£¼ëŠ”', 'ì‹¤ì œë¡œ ê²€ì¦ëœ'],
                structures: ['ë¬¸ì œì œê¸°', 'í•´ê²°ë°©ë²•', 'ë‹¨ê³„ë³„ì„¤ëª…', 'ê²°ê³¼í™•ì¸', 'í–‰ë™ì´‰êµ¬'],
                emotions: ['í˜¸ê¸°ì‹¬', 'ë†€ë¼ì›€', 'í•™ìŠµìš•êµ¬', 'ì„±ì·¨ê°'],
                keywords: ['ë¹„ë²•', 'ë°©ë²•', 'ê¿€íŒ', 'ì™„ì „ì •ë³µ', 'ë§ˆìŠ¤í„°']
            },
            entertainment: {
                hooks: ['ì¶©ê²©ì ì¸', 'ì›ƒê¸´', 'ì¬ë¯¸ìˆëŠ”', 'ë†€ë¼ìš´'],
                structures: ['ìƒí™©ì œì‹œ', 'ë°˜ì „í¬ì¸íŠ¸', 'í´ë¼ì´ë§¥ìŠ¤', 'ê²°ë§'],
                emotions: ['ì¬ë¯¸', 'ë†€ë¼ì›€', 'ê³µê°', 'ì›ƒìŒ'],
                keywords: ['ëŒ€ë°•', 'ë ˆì „ë“œ', 'ì‹¤í™”', 'ì§„ì§œ', 'ë¯¸ì³¤ë‹¤']
            },
            motivation: {
                hooks: ['ì„±ê³µí•œ ì‚¬ëŒë“¤ì˜', 'ì¸ìƒì„ ë°”ê¾¸ëŠ”', 'í›„íšŒí•˜ì§€ ì•ŠëŠ”'],
                structures: ['í˜„ì‹¤ì¸ì‹', 'ëª©í‘œì„¤ì •', 'ì‹¤í–‰ë°©ë²•', 'ì„±ê³µì‚¬ë¡€'],
                emotions: ['ë™ê¸°ë¶€ì—¬', 'í¬ë§', 'ê²°ì‹¬', 'ì„±ì·¨ìš•êµ¬'],
                keywords: ['ì„±ê³µ', 'ë³€í™”', 'ì„±ì¥', 'ë„ì „', 'ê·¹ë³µ']
            }
        };

        // ===== ì´ˆê¸°í™” ì‹œìŠ¤í…œ =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ 100ë§Œ ìœ íŠœë²„ ìë™ ìƒì„±ê¸° ì´ˆê¸°í™” ì‹œì‘');
            
            initializeParticles();
            initializeEventListeners();
            updateGenerateButton();
            loadSavedSettings();
            
            console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
        });

        // ===== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” (ìˆ˜ì •ë¨) =====
        function initializeEventListeners() {
            console.log('ğŸ¯ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” ì‹œì‘');
            
            // API ì—°ê²° ë²„íŠ¼ ì´ë²¤íŠ¸
            const connectBtn = document.getElementById('connectOpenAIBtn');
            if (connectBtn) {
                console.log('âœ… OpenAI ì—°ê²° ë²„íŠ¼ ì°¾ìŒ');
                connectBtn.addEventListener('click', function() {
                    console.log('ğŸ”— OpenAI ì—°ê²° ë²„íŠ¼ í´ë¦­ë¨!');
                    connectOpenAI();
                });
            } else {
                console.error('âŒ OpenAI ì—°ê²° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // DALL-E í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸
            const testBtn = document.getElementById('testDALLEBtn');
            if (testBtn) {
                console.log('âœ… DALL-E í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì°¾ìŒ');
                testBtn.addEventListener('click', function() {
                    console.log('ğŸ¨ DALL-E í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­ë¨!');
                    testDALLE();
                });
            } else {
                console.error('âŒ DALL-E í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ìƒì„± ë²„íŠ¼ ì´ë²¤íŠ¸
            const generateBtn = document.getElementById('generateButton');
            if (generateBtn) {
                console.log('âœ… ìƒì„± ë²„íŠ¼ ì°¾ìŒ');
                generateBtn.addEventListener('click', function() {
                    console.log('ğŸš€ ìƒì„± ë²„íŠ¼ í´ë¦­ë¨!');
                    if (!generateBtn.disabled) {
                        finalizedStartAutoGeneration();
                    }
                });
            } else {
                console.error('âŒ ìƒì„± ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
            document.addEventListener('keydown', function(e) {
                if (generatedSlides.length > 0) {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        prevSlide();
                    }
                    if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        nextSlide();
                    }
                    if (e.key === ' ') {
                        e.preventDefault();
                        toggleAutoPlay();
                    }
                }
                
                // Ctrl+Enterë¡œ ìƒì„± ì‹œì‘
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    if (generateBtn && !generateBtn.disabled) {
                        finalizedStartAutoGeneration();
                    }
                }
            });
            
            // ì…ë ¥ í•„ë“œ ë³€í™” ê°ì§€
            const inputs = ['viralKeyword', 'contentTitle', 'contentDescription', 'manualTitle', 'manualContent'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateGenerateButton);
                    console.log(`âœ… ${id} ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ì—°ê²°ë¨`);
                }
            });
            
            // ì„¤ì • ë³€í™” ê°ì§€
            const selects = ['channelType', 'contentTone', 'slideCount', 'visualStyle', 'animationStyle', 'backgroundMusic'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        generationConfig[id] = this.value;
                        saveSettings();
                    });
                    console.log(`âœ… ${id} ì„ íƒ í•„ë“œ ì´ë²¤íŠ¸ ì—°ê²°ë¨`);
                }
            });
            
            console.log('âœ… ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ===== API í‚¤ ì‹¤ì‹œê°„ ê²€ì¦ ì‹œìŠ¤í…œ (ê°•í™”ë¨) =====
        function initializeAPIKeyValidation() {
            console.log('ğŸ”‘ API í‚¤ ê²€ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”');
            
            const keyInput = document.getElementById('openaiKey');
            const connectBtn = document.getElementById('connectOpenAIBtn');
            
            if (!keyInput) {
                console.error('âŒ API í‚¤ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            if (!connectBtn) {
                console.error('âŒ ì—°ê²° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            console.log('âœ… API í‚¤ ì…ë ¥ í•„ë“œì™€ ì—°ê²° ë²„íŠ¼ ì°¾ìŒ');
            
            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            connectBtn.disabled = true;
            showStatus('ğŸ“ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning', 'openaiStatus');
            
            // ì‹¤ì‹œê°„ í‚¤ ê²€ì¦
            keyInput.addEventListener('input', function() {
                const key = this.value.trim();
                console.log('âŒ¨ï¸ API í‚¤ ì…ë ¥ ê°ì§€:', key ? 'ì…ë ¥ë¨' : 'ë¹„ì–´ìˆìŒ');
                validateAPIKeyFormat(key);
            });
            
            // ë¶™ì—¬ë„£ê¸° ê°ì§€
            keyInput.addEventListener('paste', function() {
                setTimeout(() => {
                    const key = this.value.trim();
                    console.log('ğŸ“‹ API í‚¤ ë¶™ì—¬ë„£ê¸° ê°ì§€:', key ? 'ì…ë ¥ë¨' : 'ë¹„ì–´ìˆìŒ');
                    validateAPIKeyFormat(key);
                }, 100);
            });
            
            console.log('âœ… API í‚¤ ê²€ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        function validateAPIKeyFormat(key) {
            const connectBtn = document.getElementById('connectOpenAIBtn');
            
            if (!key) {
                showStatus('ğŸ“ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning', 'openaiStatus');
                if (connectBtn) {
                    connectBtn.disabled = true;
                    connectBtn.style.background = 'rgba(255,255,255,0.3)';
                    connectBtn.style.animation = 'none';
                }
                return false;
            }
            
            if (!key.startsWith('sk-')) {
                showStatus('âŒ API í‚¤ëŠ” "sk-"ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤', 'error', 'openaiStatus');
                if (connectBtn) {
                    connectBtn.disabled = true;
                    connectBtn.style.background = 'rgba(255,0,0,0.3)';
                    connectBtn.style.animation = 'none';
                }
                return false;
            }
            
            if (key.length < 40) {
                showStatus('âŒ API í‚¤ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (ìµœì†Œ 40ì)', 'error', 'openaiStatus');
                if (connectBtn) {
                    connectBtn.disabled = true;
                    connectBtn.style.background = 'rgba(255,165,0,0.3)';
                    connectBtn.style.animation = 'none';
                }
                return false;
            }
            
            if (key.length > 200) {
                showStatus('âŒ API í‚¤ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤', 'error', 'openaiStatus');
                if (connectBtn) {
                    connectBtn.disabled = true;
                    connectBtn.style.background = 'rgba(255,0,0,0.3)';
                    connectBtn.style.animation = 'none';
                }
                return false;
            }
            
            // í˜•ì‹ì´ ì˜¬ë°”ë¥¸ ê²½ìš°
            showStatus('âœ… API í‚¤ í˜•ì‹ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤. ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!', 'success', 'openaiStatus');
            if (connectBtn) {
                connectBtn.disabled = false;
                connectBtn.style.background = 'linear-gradient(45deg, #43e97b, #38f9d7)';
                connectBtn.style.animation = 'pulse 2s infinite';
                console.log('âœ… ì—°ê²° ë²„íŠ¼ í™œì„±í™”ë¨');
            }
            return true;
        }

        // ===== ë””ë²„ê¹…ìš© ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸ =====
        function testButtonClick() {
            console.log('ğŸ§ª ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ í˜¸ì¶œë¨');
            alert('ë²„íŠ¼ì´ ì •ìƒì ìœ¼ë¡œ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ===== ê°•ì œ ì—°ê²° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ =====
        function forceTestConnection() {
            console.log('ğŸ”§ ê°•ì œ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘');
            const keyInput = document.getElementById('openaiKey');
            if (keyInput && keyInput.value.trim()) {
                connectOpenAI();
            } else {
                console.log('âŒ API í‚¤ê°€ ì…ë ¥ë˜ì§€ ì•ŠìŒ');
                alert('ë¨¼ì € API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            }
        }

        // ì €ì¥ëœ ì„¤ì • ë¡œë“œ
        function loadSavedSettings() {
            try {
                const saved = localStorage.getItem('youtubeGeneratorSettings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    Object.assign(generationConfig, settings);
                    
                    // UI ì—…ë°ì´íŠ¸
                    Object.keys(settings).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) element.value = settings[key];
                    });
                }
            } catch (error) {
                console.warn('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            try {
                localStorage.setItem('youtubeGeneratorSettings', JSON.stringify(generationConfig));
            } catch (error) {
                console.warn('ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // íŒŒí‹°í´ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        function initializeParticles() {
            const container = document.getElementById('floatingParticles');
            if (!container) return;
            
            // ê¸°ì¡´ íŒŒí‹°í´ ì œê±°
            container.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (6 + Math.random() * 4) + 's';
                
                // íŒŒí‹°í´ ìƒ‰ìƒ ëœë¤í™”
                const colors = ['rgba(255,255,255,0.6)', 'rgba(78,205,196,0.6)', 'rgba(255,107,107,0.6)', 'rgba(254,202,87,0.6)'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                container.appendChild(particle);
            }
        }

        // ===== GPT ëª¨ë¸ ë° ìƒì„± ëª¨ë“œ ê´€ë¦¬ =====
        function selectGPTModel(model) {
            selectedGPTModel = model;
            
            document.querySelectorAll('#gpt4oCard, #gpt4Card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const selectedCard = document.getElementById(model === 'gpt-4o' ? 'gpt4oCard' : 'gpt4Card');
            if (selectedCard) selectedCard.classList.add('selected');
            
            console.log('ì„ íƒëœ GPT ëª¨ë¸:', selectedGPTModel);
            updateGenerateButton();
        }

        function selectGenerationMode(mode) {
            selectedGenerationMode = mode;
            
            // ëª¨ë“  ëª¨ë“œ ì¹´ë“œì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ì„ íƒëœ ëª¨ë“œ ì¹´ë“œì— selected í´ë˜ìŠ¤ ì¶”ê°€
            const selectedCard = document.getElementById(mode.replace('-', '') + 'Mode');
            if (selectedCard) selectedCard.classList.add('selected');
            
            // ì…ë ¥ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
            document.querySelectorAll('.mode-inputs').forEach(input => {
                input.classList.add('hidden');
            });
            
            const targetInput = document.getElementById(mode.replace('-', '') + 'ModeInputs');
            if (targetInput) targetInput.classList.remove('hidden');
            
            updateGenerateButton();
            console.log('ì„ íƒëœ ìƒì„± ëª¨ë“œ:', selectedGenerationMode);
        }

        // ===== ì‹¤ì‹œê°„ API í‚¤ ê²€ì¦ ì‹œìŠ¤í…œ =====
        function initializeAPIKeyValidation() {
            const keyInput = document.getElementById('openaiKey');
            if (!keyInput) return;
            
            // ì‹¤ì‹œê°„ í‚¤ ê²€ì¦
            keyInput.addEventListener('input', function() {
                const key = this.value.trim();
                validateAPIKeyFormat(key);
            });
            
            // ë¶™ì—¬ë„£ê¸° ê°ì§€
            keyInput.addEventListener('paste', function() {
                setTimeout(() => {
                    const key = this.value.trim();
                    validateAPIKeyFormat(key);
                }, 100);
            });
        }

        function validateAPIKeyFormat(key) {
            const statusElement = document.getElementById('openaiStatus');
            const connectButton = document.querySelector('button[onclick="connectOpenAI()"]');
            
            if (!key) {
                showStatus('ğŸ“ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning', 'openaiStatus');
                if (connectButton) connectButton.disabled = true;
                return false;
            }
            
            if (!key.startsWith('sk-')) {
                showStatus('âŒ API í‚¤ëŠ” "sk-"ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤', 'error', 'openaiStatus');
                if (connectButton) connectButton.disabled = true;
                return false;
            }
            
            if (key.length < 40) {
                showStatus('âŒ API í‚¤ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (ìµœì†Œ 40ì)', 'error', 'openaiStatus');
                if (connectButton) connectButton.disabled = true;
                return false;
            }
            
            if (key.length > 200) {
                showStatus('âŒ API í‚¤ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤', 'error', 'openaiStatus');
                if (connectButton) connectButton.disabled = true;
                return false;
            }
            
            // í˜•ì‹ì´ ì˜¬ë°”ë¥¸ ê²½ìš°
            showStatus('âœ… API í‚¤ í˜•ì‹ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤. ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!', 'success', 'openaiStatus');
            if (connectButton) {
                connectButton.disabled = false;
                connectButton.style.background = 'linear-gradient(45deg, #43e97b, #38f9d7)';
                connectButton.style.animation = 'pulse 2s infinite';
            }
            return true;
        }

        // ===== ê°œì„ ëœ OpenAI API ì—°ê²° ì‹œìŠ¤í…œ =====
        async function connectOpenAI() {
            const keyInput = document.getElementById('openaiKey');
            const connectButton = document.querySelector('button[onclick="connectOpenAI()"]');
            
            if (!keyInput) {
                console.error('âŒ API í‚¤ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                alert('âŒ ì‹œìŠ¤í…œ ì˜¤ë¥˜: API í‚¤ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const key = keyInput.value.trim();
            console.log('ğŸ”‘ API í‚¤ ì—°ê²° ì‹œë„ ì‹œì‘');
            console.log('í‚¤ ê¸¸ì´:', key.length);
            console.log('í‚¤ ì‹œì‘ ë¶€ë¶„:', key.substring(0, 10) + '...');
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            if (connectButton) {
                connectButton.disabled = true;
                connectButton.textContent = 'ğŸ”— ì—°ê²° ì¤‘...';
                connectButton.style.background = 'linear-gradient(45deg, #feca57, #ff9ff3)';
            }
            
            // ìµœì¢… í˜•ì‹ ê²€ì¦
            if (!validateAPIKeyFormat(key)) {
                if (connectButton) {
                    connectButton.disabled = false;
                    connectButton.textContent = 'ğŸ”— OpenAI ì—°ê²°';
                    connectButton.style.background = 'linear-gradient(45deg, #4facfe, #00f2fe)';
                }
                return;
            }
            
            showStatus('ğŸ”— OpenAI API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', 'warning', 'openaiStatus');
            
            try {
                console.log('ğŸŒ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘');
                
                // ê°„ë‹¨í•œ ì—°ê²° í…ŒìŠ¤íŠ¸
                const testResponse = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'user',
                                content: 'ì•ˆë…•í•˜ì„¸ìš”! ì—°ê²° í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. "ì—°ê²° ì„±ê³µ"ì´ë¼ê³  ì§§ê²Œ ë‹µí•´ì£¼ì„¸ìš”.'
                            }
                        ],
                        max_tokens: 10,
                        temperature: 0
                    })
                });
                
                console.log('ğŸ“¡ API ì‘ë‹µ ìƒíƒœ:', testResponse.status);
                
                if (testResponse.ok) {
                    const data = await testResponse.json();
                    console.log('âœ… API ì—°ê²° ì„±ê³µ!');
                    console.log('ì‘ë‹µ ë°ì´í„°:', data);
                    
                    // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                    openaiApiKey = key;
                    
                    // ì—°ê²° ì„±ê³µ UI ì—…ë°ì´íŠ¸
                    updateConnectionSuccessUI();
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    showStatus('ğŸ‰ OpenAI API ì—°ê²° ì™„ë£Œ! GPT-4ì™€ DALL-E 3 ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'success', 'openaiStatus');
                    
                    // ìƒì„± ë²„íŠ¼ í™œì„±í™”
                    updateGenerateButton();
                    
                    // ì„±ê³µ ì•Œë¦¼
                    showSuccessNotification('ğŸ‰ OpenAI API ì—°ê²° ì„±ê³µ! ì´ì œ ì™„ë²½í•œ ì½˜í…ì¸ ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
                    
                } else {
                    // ì‹¤íŒ¨ ì²˜ë¦¬
                    const errorData = await testResponse.json().catch(() => ({}));
                    console.error('âŒ API ì—°ê²° ì‹¤íŒ¨:', testResponse.status, errorData);
                    
                    handleAPIConnectionError(testResponse.status, errorData);
                }
                
            } catch (error) {
                console.error('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
                handleNetworkError(error);
            } finally {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                if (connectButton) {
                    connectButton.disabled = false;
                    connectButton.textContent = 'ğŸ”— OpenAI ì—°ê²°';
                    if (openaiApiKey) {
                        connectButton.textContent = 'âœ… ì—°ê²° ì™„ë£Œ';
                        connectButton.style.background = 'linear-gradient(45deg, #43e97b, #38f9d7)';
                    } else {
                        connectButton.style.background = 'linear-gradient(45deg, #4facfe, #00f2fe)';
                    }
                }
            }
        }

        // ===== ì—°ê²° ì„±ê³µ UI ì—…ë°ì´íŠ¸ =====
        function updateConnectionSuccessUI() {
            console.log('ğŸ¨ ì—°ê²° ì„±ê³µ UI ì—…ë°ì´íŠ¸ ì‹œì‘');
            
            // OpenAI ì¹´ë“œ ì—°ê²° ìƒíƒœ í‘œì‹œ
            const openaiCard = document.getElementById('openaiCard');
            if (openaiCard) {
                openaiCard.classList.add('connected');
                openaiCard.style.borderColor = '#43e97b';
                openaiCard.style.background = 'rgba(67,233,123,0.1)';
                openaiCard.style.boxShadow = '0 0 30px rgba(67,233,123,0.3)';
            }
            
            // GPT ìƒíƒœ ì—…ë°ì´íŠ¸
            const gptStatus = document.getElementById('gptStatus');
            if (gptStatus) {
                gptStatus.innerHTML = `
                    <div style="font-size: 2em; margin-bottom: 10px; animation: bounce 2s infinite;">âœ…</div>
                    <div style="font-weight: bold; color: #43e97b;">GPT-4 ì—°ê²° ì™„ë£Œ</div>
                    <div style="font-size: 0.9em; opacity: 0.8; margin-top: 5px;">API ì •ìƒ ì‘ë™</div>
                `;
                gptStatus.style.background = 'rgba(67,233,123,0.2)';
                gptStatus.style.borderColor = 'rgba(67,233,123,0.5)';
                gptStatus.style.transform = 'scale(1.02)';
            }
            
            // DALL-E ìƒíƒœ ì—…ë°ì´íŠ¸
            const dalleStatus = document.getElementById('dalleConnectionStatus');
            if (dalleStatus) {
                dalleStatus.innerHTML = `
                    <div style="font-size: 2em; margin-bottom: 10px; animation: bounce 2s infinite;">âœ…</div>
                    <div style="font-weight: bold; color: #43e97b;">DALL-E 3 ì—°ê²° ì™„ë£Œ</div>
                    <div style="font-size: 0.9em; opacity: 0.8; margin-top: 5px;">ì´ë¯¸ì§€ ìƒì„± ì¤€ë¹„ë¨</div>
                `;
                dalleStatus.style.background = 'rgba(67,233,123,0.2)';
                dalleStatus.style.borderColor = 'rgba(67,233,123,0.5)';
                dalleStatus.style.transform = 'scale(1.02)';
            }
            
            console.log('âœ… ì—°ê²° ì„±ê³µ UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        // ===== API ì—°ê²° ì˜¤ë¥˜ ì²˜ë¦¬ =====
        function handleAPIConnectionError(status, errorData) {
            let errorMessage = 'âŒ API ì—°ê²° ì‹¤íŒ¨: ';
            let suggestion = '';
            
            switch (status) {
                case 401:
                    errorMessage += 'API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: OpenAI ì›¹ì‚¬ì´íŠ¸ì—ì„œ ìƒˆë¡œìš´ API í‚¤ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.';
                    break;
                case 403:
                    errorMessage += 'API ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: ê³„ì • ìƒíƒœë¥¼ í™•ì¸í•˜ê±°ë‚˜ ê²°ì œ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•´ì£¼ì„¸ìš”.';
                    break;
                case 429:
                    errorMessage += 'ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.';
                    suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ í”Œëœì„ ì—…ê·¸ë ˆì´ë“œí•´ì£¼ì„¸ìš”.';
                    break;
                case 500:
                case 502:
                case 503:
                    errorMessage += 'OpenAI ì„œë²„ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.';
                    suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: 1-2ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    break;
                default:
                    errorMessage += `ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ (ìƒíƒœ ì½”ë“œ: ${status})`;
                    suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            }
            
            if (errorData.error && errorData.error.message) {
                errorMessage += `\nìƒì„¸ ì˜¤ë¥˜: ${errorData.error.message}`;
            }
            
            showStatus(errorMessage, 'error', 'openaiStatus');
            
            // ì¶”ê°€ ë„ì›€ë§ í‘œì‹œ
            setTimeout(() => {
                const statusElement = document.getElementById('openaiStatus');
                if (statusElement) {
                    statusElement.innerHTML += `<br><small style="opacity: 0.8;">${suggestion}</small>`;
                }
            }, 1000);
        }

        // ===== ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬ =====
        function handleNetworkError(error) {
            let errorMessage = 'ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜: ';
            let suggestion = '';
            
            if (error.name === 'TypeError' && error.message.includes('fetch')) {
                errorMessage += 'ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: Wi-Fi ë˜ëŠ” ë°ì´í„° ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
            } else if (error.message.includes('CORS')) {
                errorMessage += 'CORS ì •ì±… ì˜¤ë¥˜ì…ë‹ˆë‹¤.';
                suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”.';
            } else if (error.message.includes('timeout')) {
                errorMessage += 'ì—°ê²° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            } else {
                errorMessage += 'ì•Œ ìˆ˜ ì—†ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì…ë‹ˆë‹¤.';
                suggestion = 'ğŸ’¡ í•´ê²°ë°©ë²•: ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            }
            
            showStatus(errorMessage, 'error', 'openaiStatus');
            
            // ì¶”ê°€ ë„ì›€ë§ í‘œì‹œ
            setTimeout(() => {
                const statusElement = document.getElementById('openaiStatus');
                if (statusElement) {
                    statusElement.innerHTML += `<br><small style="opacity: 0.8;">${suggestion}</small>`;
                }
            }, 1000);
        }

        // ===== DALL-E 3 í…ŒìŠ¤íŠ¸ ê°œì„  =====
        async function testDALLE() {
            if (!openaiApiKey) {
                showStatus('âŒ ë¨¼ì € OpenAI APIë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”.', 'error', 'dalleStatus');
                return;
            }
            
            const testButton = document.querySelector('button[onclick="testDALLE()"]');
            if (testButton) {
                testButton.disabled = true;
                testButton.textContent = 'ğŸ¨ í…ŒìŠ¤íŠ¸ ì¤‘...';
            }
            
            showStatus('ğŸ¨ DALL-E 3 í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ìƒì„± ì¤‘...', 'warning', 'dalleStatus');
            
            try {
                const testPrompt = 'A beautiful modern YouTube studio with neon lights, high-tech equipment, vibrant colors, professional setup, digital art style';
                const imageUrl = await generateImageWithDALLE(testPrompt, 'hd', '1024x1024', 'vivid');
                
                if (imageUrl) {
                    showStatus('âœ… DALL-E 3 ì—°ê²° ì„±ê³µ!', 'success', 'dalleStatus');
                    
                    // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ í‘œì‹œ
                    const dalleCard = document.getElementById('dalleCard');
                    if (dalleCard) {
                        // ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì œê±°
                        const existingImage = dalleCard.querySelector('.dalle-test-image');
                        if (existingImage) existingImage.remove();
                        
                        const testImageDiv = document.createElement('div');
                        testImageDiv.className = 'dalle-test-image';
                        testImageDiv.innerHTML = `
                            <div style="margin-top: 20px; text-align: center; padding: 15px; background: rgba(67,233,123,0.1); border-radius: 15px; border: 2px solid rgba(67,233,123,0.3);">
                                <h4 style="color: #43e97b; margin-bottom: 15px;">ğŸ¨ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ!</h4>
                                <img src="${imageUrl}" style="max-width: 200px; max-height: 200px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); cursor: pointer;" onclick="window.open('${imageUrl}', '_blank')">
                                <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">í´ë¦­í•˜ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                            </div>
                        `;
                        dalleCard.appendChild(testImageDiv);
                    }
                    
                    showSuccessNotification('ğŸ¨ DALL-E 3 í…ŒìŠ¤íŠ¸ ì„±ê³µ! ì™„ë²½í•œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
                    
                } else {
                    throw new Error('ì´ë¯¸ì§€ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('DALL-E 3 í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                showStatus('âŒ DALL-E 3 í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message, 'error', 'dalleStatus');
            } finally {
                if (testButton) {
                    testButton.disabled = false;
                    testButton.textContent = 'ğŸ¨ DALL-E 3 í…ŒìŠ¤íŠ¸';
                }
            }
        }

        // ===== ê°œì„ ëœ ì´ˆê¸°í™” ì‹œìŠ¤í…œ =====
        function initializeEnhancedAPISystem() {
            console.log('ğŸš€ í–¥ìƒëœ API ì‹œìŠ¤í…œ ì´ˆê¸°í™”');
            
            // API í‚¤ ì‹¤ì‹œê°„ ê²€ì¦ ì´ˆê¸°í™”
            initializeAPIKeyValidation();
            
            // ê¸°ì¡´ ì—°ê²° ìƒíƒœ í™•ì¸
            if (openaiApiKey) {
                console.log('ğŸ”„ ê¸°ì¡´ API í‚¤ ë°œê²¬, ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...');
                updateConnectionSuccessUI();
                updateGenerateButton();
            }
            
            console.log('âœ… í–¥ìƒëœ API ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ===== ê¸°ì¡´ ì´ˆê¸°í™”ì— ì¶”ê°€ =====
        document.addEventListener('DOMContentLoaded', function() {
            // ê¸°ì¡´ ì´ˆê¸°í™” í•¨ìˆ˜ë“¤...
            initializeParticles();
            initializeEventListeners();
            updateGenerateButton();
            loadSavedSettings();
            
            // ìƒˆë¡œìš´ API ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¶”ê°€
            initializeEnhancedAPISystem();
            
            console.log('âœ… ì „ì²´ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        });

        // ===== í–¥ìƒëœ OpenAI API í˜¸ì¶œ ì‹œìŠ¤í…œ =====
        async function callOpenAI(prompt, model = null, maxTokens = 2000, temperature = 0.7) {
            if (!openaiApiKey) {
                throw new Error('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
            
            const modelToUse = model || selectedGPTModel;
            console.log(`OpenAI API í˜¸ì¶œ: ${modelToUse}, í† í°: ${maxTokens}`);
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${openaiApiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: modelToUse,
                        messages: [
                            {
                                role: 'system',
                                content: 'ë‹¹ì‹ ì€ ë°”ì´ëŸ´ ì½˜í…ì¸  ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 100ë§Œë·°ë¥¼ ë§Œë“œëŠ” ì½˜í…ì¸  ì œì‘ì— íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: maxTokens,
                        temperature: temperature
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    
                    let errorMessage = `API ì˜¤ë¥˜ ${response.status}`;
                    if (errorData.error && errorData.error.message) {
                        errorMessage += `: ${errorData.error.message}`;
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                const result = data.choices[0]?.message?.content || '';
                
                console.log('OpenAI API ì‘ë‹µ ì„±ê³µ, ê¸¸ì´:', result.length);
                return result;
                
            } catch (error) {
                console.error('OpenAI API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ===== í–¥ìƒëœ DALL-E 3 ì´ë¯¸ì§€ ìƒì„± ì‹œìŠ¤í…œ =====
        async function generateImageWithDALLE(prompt, quality = 'hd', size = '1024x1792', style = 'vivid') {
            if (!openaiApiKey) {
                throw new Error('OpenAI API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
            }
            
            console.log(`DALL-E 3 ì´ë¯¸ì§€ ìƒì„±: ${quality}, ${size}, ${style}`);
            
            try {
                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${openaiApiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'dall-e-3',
                        prompt: prompt,
                        n: 1,
                        quality: quality,
                        size: size,
                        style: style
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    
                    let errorMessage = `DALL-E ì˜¤ë¥˜ ${response.status}`;
                    if (errorData.error && errorData.error.message) {
                        errorMessage += `: ${errorData.error.message}`;
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                const imageUrl = data.data[0]?.url;
                
                if (imageUrl) {
                    console.log('DALL-E 3 ì´ë¯¸ì§€ ìƒì„± ì„±ê³µ');
                    return imageUrl;
                } else {
                    throw new Error('ì´ë¯¸ì§€ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('DALL-E 3 ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ===== OpenAI API í˜¸ì¶œ ì‹œìŠ¤í…œ =====
        async function callOpenAI(prompt, model = null, maxTokens = 2000, temperature = 0.7) {
            if (!openaiApiKey) {
                throw new Error('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
            
            const modelToUse = model || selectedGPTModel;
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${openaiApiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: modelToUse,
                        messages: [
                            {
                                role: 'system',
                                content: 'ë‹¹ì‹ ì€ ë°”ì´ëŸ´ ì½˜í…ì¸  ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 100ë§Œë·°ë¥¼ ë§Œë“œëŠ” ì½˜í…ì¸  ì œì‘ì— íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: maxTokens,
                        temperature: temperature
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`API ì˜¤ë¥˜ ${response.status}: ${errorData.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
                
                const data = await response.json();
                return data.choices[0]?.message?.content || '';
                
            } catch (error) {
                console.error('OpenAI API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ===== DALL-E 3 ì´ë¯¸ì§€ ìƒì„± ì‹œìŠ¤í…œ =====
        async function generateImageWithDALLE(prompt, quality = 'hd', size = '1024x1792', style = 'vivid') {
            if (!openaiApiKey) {
                throw new Error('OpenAI API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
            }
            
            try {
                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${openaiApiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'dall-e-3',
                        prompt: prompt,
                        n: 1,
                        quality: quality,
                        size: size,
                        style: style
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`DALL-E ì˜¤ë¥˜ ${response.status}: ${errorData.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
                
                const data = await response.json();
                return data.data[0]?.url || null;
                
            } catch (error) {
                console.error('DALL-E 3 ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // DALL-E 3 í…ŒìŠ¤íŠ¸
        async function testDALLE() {
            if (!openaiApiKey) {
                showStatus('âŒ ë¨¼ì € OpenAI APIë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”.', 'error', 'dalleStatus');
                return;
            }
            
            showStatus('ğŸ¨ DALL-E 3 í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ìƒì„± ì¤‘...', 'warning', 'dalleStatus');
            
            try {
                const testPrompt = 'A futuristic YouTube studio with holographic screens, vibrant neon colors, modern technology, highly detailed, digital art style';
                const imageUrl = await generateImageWithDALLE(testPrompt, 'hd', '1024x1024', 'vivid');
                
                if (imageUrl) {
                    showStatus('âœ… DALL-E 3 ì—°ê²° ì„±ê³µ!', 'success', 'dalleStatus');
                    
                    // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ í‘œì‹œ
                    const testImageDiv = document.createElement('div');
                    testImageDiv.innerHTML = `
                        <div style="margin-top: 20px; text-align: center;">
                            <h4 style="color: #4ecdc4;">ğŸ¨ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ!</h4>
                            <img src="${imageUrl}" style="max-width: 200px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                        </div>
                    `;
                    document.getElementById('dalleCard').appendChild(testImageDiv);
                    
                } else {
                    throw new Error('ì´ë¯¸ì§€ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('DALL-E 3 í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                showStatus('âŒ DALL-E 3 í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message, 'error', 'dalleStatus');
            }
        }

        // ===== ë°”ì´ëŸ´ ì½˜í…ì¸  ë¶„ì„ ì—”ì§„ =====
        function analyzeViralPotential(content, channelType) {
            const patterns = viralPatterns[channelType] || viralPatterns.educational;
            let score = 0;
            let analysis = {
                hooks: 0,
                emotions: 0,
                keywords: 0,
                structure: 0,
                recommendations: []
            };
            
            const contentLower = content.toLowerCase();
            
            // í›… ë¶„ì„
            patterns.hooks.forEach(hook => {
                if (contentLower.includes(hook)) {
                    analysis.hooks += 25;
                    score += 25;
                }
            });
            
            // ê°ì • í‚¤ì›Œë“œ ë¶„ì„
            patterns.emotions.forEach(emotion => {
                if (contentLower.includes(emotion)) {
                    analysis.emotions += 20;
                    score += 20;
                }
            });
            
            // ë°”ì´ëŸ´ í‚¤ì›Œë“œ ë¶„ì„
            patterns.keywords.forEach(keyword => {
                if (contentLower.includes(keyword)) {
                    analysis.keywords += 15;
                    score += 15;
                }
            });
            
            // ì¶”ì²œì‚¬í•­ ìƒì„±
            if (analysis.hooks < 50) {
                analysis.recommendations.push('ë” ê°•ë ¥í•œ í›… í•„ìš”');
            }
            if (analysis.emotions < 40) {
                analysis.recommendations.push('ê°ì •ì  ìš”ì†Œ ê°•í™”');
            }
            if (analysis.keywords < 30) {
                analysis.recommendations.push('ë°”ì´ëŸ´ í‚¤ì›Œë“œ ì¶”ê°€');
            }
            
            return {
                score: Math.min(100, score),
                analysis: analysis,
                rating: score > 80 ? 'ğŸ”¥ ë°”ì´ëŸ´ ê°€ëŠ¥ì„± ë†’ìŒ' : 
                       score > 60 ? 'âš¡ ê´œì°®ì€ ì½˜í…ì¸ ' : 
                       score > 40 ? 'ğŸ“ˆ ê°œì„  í•„ìš”' : 'ğŸ”§ ëŒ€í­ ìˆ˜ì • í•„ìš”'
            };
        }

        // ===== ìƒì„± ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ =====
        function updateGenerateButton() {
            const generateButton = document.getElementById('generateButton');
            if (!generateButton) return;
            
            let canGenerate = false;
            let buttonText = 'ğŸš€ 100ë§Œë·° ì½˜í…ì¸  ìë™ ìƒì„±í•˜ê¸°';
            
            // API ì—°ê²° í™•ì¸
            if (!openaiApiKey) {
                buttonText = 'âŒ OpenAI API ì—°ê²° í•„ìš”';
                canGenerate = false;
            } else {
                // ëª¨ë“œë³„ ì…ë ¥ê°’ í™•ì¸
                if (selectedGenerationMode === 'auto') {
                    const keyword = document.getElementById('viralKeyword')?.value?.trim();
                    if (keyword && keyword.length > 2) {
                        canGenerate = true;
                        buttonText = `ğŸ¤– "${keyword}" ë°”ì´ëŸ´ ì½˜í…ì¸  ìë™ ìƒì„±`;
                    } else {
                        buttonText = 'ğŸ“ í‚¤ì›Œë“œ ì…ë ¥ í•„ìš”';
                    }
                } else if (selectedGenerationMode === 'semi-auto') {
                    const title = document.getElementById('contentTitle')?.value?.trim();
                    const desc = document.getElementById('contentDescription')?.value?.trim();
                    if (title && desc && title.length > 3 && desc.length > 10) {
                        canGenerate = true;
                        buttonText = `ğŸ¨ "${title}" ì½˜í…ì¸  + AI ì´ë¯¸ì§€ ìƒì„±`;
                    } else {
                        buttonText = 'ğŸ“ ì œëª©ê³¼ ë‚´ìš© ì…ë ¥ í•„ìš”';
                    }
                } else if (selectedGenerationMode === 'manual') {
                    const title = document.getElementById('manualTitle')?.value?.trim();
                    const content = document.getElementById('manualContent')?.value?.trim();
                    if (title && content && title.length > 3 && content.length > 10) {
                        canGenerate = true;
                        buttonText = `ğŸ“ "${title}" ìŠ¬ë¼ì´ë“œ ìƒì„±`;
                    } else {
                        buttonText = 'ğŸ“ ì œëª©ê³¼ ë‚´ìš© ì…ë ¥ í•„ìš”';
                    }
                }
            }
            
            generateButton.disabled = !canGenerate;
            generateButton.textContent = buttonText;
            
            if (canGenerate) {
                generateButton.classList.add('pulsing');
            } else {
                generateButton.classList.remove('pulsing');
            }
        }

        // ===== ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ ì‹œìŠ¤í…œ =====
        function showStatus(message, type, elementId) {
            const statusElement = document.getElementById(elementId);
            if (!statusElement) return;
            
            statusElement.textContent = message;
            statusElement.className = `status-message ${type}`;
            statusElement.style.display = 'block';
            
            // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€ (ì—ëŸ¬ê°€ ì•„ë‹Œ ê²½ìš°)
            if (type !== 'error') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 3000);
            }
        }

        // ===== ì„±ê³µ ì•Œë¦¼ ì‹œìŠ¤í…œ =====
        function showSuccessNotification(message = 'ğŸ‰ ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!') {
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            setTimeout(() => notification.classList.add('show'), 100);
            
            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 600);
            }, 3000);
        }

        // ===== ì§„í–‰ ìƒí™© ëª¨ë‹¬ ì‹œìŠ¤í…œ =====
        function showProgressModal(show = true) {
            const modal = document.getElementById('progressModal');
            if (modal) {
                modal.classList.toggle('show', show);
            }
        }

        function updateProgress(percent, title, description, icon = 'ğŸ¤–') {
            const elements = {
                fill: document.getElementById('progressFill'),
                text: document.getElementById('progressText'),
                title: document.getElementById('progressTitle'),
                desc: document.getElementById('progressDesc'),
                icon: document.getElementById('progressIcon')
            };
            
            if (elements.fill) elements.fill.style.width = Math.min(100, Math.max(0, percent)) + '%';
            if (elements.text) elements.text.textContent = Math.round(percent) + '%';
            if (elements.title) elements.title.textContent = title;
            if (elements.desc) elements.desc.textContent = description;
            if (elements.icon) elements.icon.textContent = icon;
            
            // ì§„í–‰ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€í™”
            if (elements.fill) {
                if (percent >= 90) {
                    elements.fill.style.background = 'linear-gradient(45deg, #43e97b, #38f9d7)';
                } else if (percent >= 70) {
                    elements.fill.style.background = 'linear-gradient(45deg, #feca57, #ff9ff3)';
                } else if (percent >= 50) {
                    elements.fill.style.background = 'linear-gradient(45deg, #4facfe, #00f2fe)';
                }
            }
        }

        // ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ =====
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function sanitizeText(text) {
            return text.replace(/[<>]/g, '').trim();
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength - 3) + '...';
        }

        function generateRandomId() {
            return 'id_' + Math.random().toString(36).substr(2, 9);
        }

        // ===== ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ =====
        window.addEventListener('error', function(event) {
            console.error('ì „ì—­ ì˜¤ë¥˜:', event.error);
            showStatus('âš ï¸ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error', 'openaiStatus');
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', event.reason);
            event.preventDefault();
        });

        // ===== 2ë‹¨ê³„: í™˜ìƒì ì¸ ìë™ ì½˜í…ì¸  ìƒì„± ì—”ì§„ =====
        
        // ë°”ì´ëŸ´ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì‹œìŠ¤í…œ
        const viralPromptTemplates = {
            auto: {
                contentAnalysis: `ë‹¹ì‹ ì€ 100ë§Œë·° ìœ íŠœë¸Œ ì‡¼ì¸  ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ í‚¤ì›Œë“œë¡œ ë°”ì´ëŸ´ ì½˜í…ì¸ ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”:

í‚¤ì›Œë“œ: {keyword}
ì±„ë„ ìœ í˜•: {channelType}
í†¤ì•¤ë§¤ë„ˆ: {contentTone}
ìŠ¬ë¼ì´ë“œ ê°œìˆ˜: {slideCount}ì¥

ë‹¤ìŒ ë°”ì´ëŸ´ ê³µì‹ì„ ì ìš©í•´ì„œ ì½˜í…ì¸ ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”:
1. ê°•ë ¥í•œ í›… (ì²« 3ì´ˆ ê´€ì‹¬ ëŒê¸°)
2. í˜¸ê¸°ì‹¬ ìœ ë°œ (ê³„ì† ë³´ê²Œ ë§Œë“¤ê¸°)
3. ê°ì •ì  ì—°ê²° (ê³µê° ë˜ëŠ” ë†€ë¼ì›€)
4. ëª…í™•í•œ ê°€ì¹˜ ì œê³µ (ë°°ìš¸ ì ì´ë‚˜ ì¬ë¯¸)
5. ê°•ë ¥í•œ ë§ˆë¬´ë¦¬ (ê¸°ì–µì— ë‚¨ì„ ë©”ì‹œì§€)

JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
  "title": "ë§¤ë ¥ì ì´ê³  í´ë¦­í•˜ê³  ì‹¶ì€ ì œëª© (10ë‹¨ì–´ ì´ë‚´)",
  "hook": "ì²« ìŠ¬ë¼ì´ë“œ ê°•ë ¥í•œ í›… ë¬¸ì¥",
  "slides": [
    {
      "number": 1,
      "title": "ìŠ¬ë¼ì´ë“œ ì œëª©",
      "content": "ìŠ¬ë¼ì´ë“œ ë‚´ìš© (2-3ë¬¸ì¥)",
      "emotion": "ìœ ë°œí•  ê°ì •",
      "visualKeywords": "ì´ë¯¸ì§€ ìƒì„±ìš© í‚¤ì›Œë“œ"
    }
  ],
  "viralScore": 85,
  "hashtags": ["#ë°”ì´ëŸ´", "#ìœ íŠœë¸Œì‡¼ì¸ "],
  "thumbnail": "ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì„¤ëª…"
}`,

                imagePrompt: `Create a stunning YouTube Shorts thumbnail for "{title}". 
Style: {visualStyle}, vibrant colors, eye-catching design, {emotion} emotion.
Visual elements: {visualKeywords}
Format: Vertical 9:16 ratio, high contrast, bold text readable on mobile.
Quality: Professional, magazine-quality, trending on social media.`
            },

            semiAuto: {
                contentAnalysis: `ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ì‡¼ì¸  ì½˜í…ì¸  ìµœì í™” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 
ì œëª©: {title}
ë‚´ìš©: {content}
ìŠ¬ë¼ì´ë“œ ê°œìˆ˜: {slideCount}ì¥

ì´ ë‚´ìš©ì„ ë°”ì´ëŸ´ ìœ íŠœë¸Œ ì‡¼ì¸ ìš©ìœ¼ë¡œ ìµœì í™”í•´ì„œ {slideCount}ì¥ì˜ ìŠ¬ë¼ì´ë“œë¡œ êµ¬ì„±í•´ì£¼ì„¸ìš”.
ê° ìŠ¬ë¼ì´ë“œëŠ” 3-5ì´ˆ ë¶„ëŸ‰ìœ¼ë¡œ ì„¤ê³„í•˜ê³ , ì‹œì²­ìê°€ ëê¹Œì§€ ë³´ë„ë¡ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
  "optimizedTitle": "ìµœì í™”ëœ ì œëª©",
  "hook": "ê°•ë ¥í•œ ì˜¤í”„ë‹",
  "slides": [
    {
      "number": 1,
      "title": "ìŠ¬ë¼ì´ë“œ ì œëª©",
      "content": "í•µì‹¬ ë©”ì‹œì§€",
      "visualKeywords": "ì´ë¯¸ì§€ìš© í‚¤ì›Œë“œ",
      "timing": "3-5ì´ˆ"
    }
  ],
  "hashtags": ["ê´€ë ¨", "í•´ì‹œíƒœê·¸"],
  "thumbnail": "ì¸ë„¤ì¼ ì„¤ëª…"
}`,

                imagePrompt: `Professional image for slide about "{title}". 
Content: {content}
Style: {visualStyle}, clean, modern, {emotion}.
Elements: {visualKeywords}
Format: 9:16 vertical, mobile-optimized, high quality.`
            }
        };

        // ===== ë©”ì¸ ìë™ ìƒì„± í•¨ìˆ˜ =====
        async function startAutoGeneration() {
            if (!openaiApiKey) {
                showStatus('âŒ ë¨¼ì € OpenAI APIë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”!', 'error', 'openaiStatus');
                return;
            }

            try {
                showProgressModal(true);
                updateProgress(5, 'ğŸš€ ë°”ì´ëŸ´ ì½˜í…ì¸  ìƒì„± ì‹œì‘', 'AIê°€ 100ë§Œë·° ê³µì‹ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'ğŸ¤–');

                let contentData;
                
                if (selectedGenerationMode === 'auto') {
                    contentData = await generateAutoContent();
                } else if (selectedGenerationMode === 'semi-auto') {
                    contentData = await generateSemiAutoContent();
                } else {
                    contentData = await generateManualContent();
                }

                updateProgress(60, 'ğŸ¨ AI ì´ë¯¸ì§€ ìƒì„± ì¤‘', 'DALL-E 3ê°€ ì™„ë²½í•œ ì´ë¯¸ì§€ë“¤ì„ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤...', 'ğŸ¨');
                await delay(1000);

                // ì´ë¯¸ì§€ ìƒì„±
                const imagesData = await generateAllImages(contentData);
                
                updateProgress(85, 'ğŸ¬ ìŠ¬ë¼ì´ë“œ ë Œë”ë§', 'ìµœì¢… ìŠ¬ë¼ì´ë“œì‡¼ë¥¼ ì™„ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'âœ¨');
                await delay(800);

                // ìŠ¬ë¼ì´ë“œ ìƒì„±
                generatedSlides = contentData.slides;
                generatedImages = imagesData;
                
                await createSlideshowWithImages(contentData, imagesData);
                
                updateProgress(100, 'ğŸ‰ ë°”ì´ëŸ´ ì½˜í…ì¸  ì™„ì„±!', '100ë§Œë·° ì½˜í…ì¸ ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 'ğŸ†');
                await delay(1000);

                showProgressModal(false);
                showResults(contentData);
                showSuccessNotification('ğŸ‰ í™˜ìƒì ì¸ ë°”ì´ëŸ´ ì½˜í…ì¸ ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');

            } catch (error) {
                console.error('ì½˜í…ì¸  ìƒì„± ì˜¤ë¥˜:', error);
                showProgressModal(false);
                
                let errorMessage = 'âŒ ì½˜í…ì¸  ìƒì„± ì‹¤íŒ¨: ';
                if (error.message.includes('429')) {
                    errorMessage += 'API ìš”ì²­ í•œë„ ì´ˆê³¼. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('token')) {
                    errorMessage += 'ì…ë ¥ ë‚´ìš©ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ë” ê°„ê²°í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.';
                } else {
                    errorMessage += error.message;
                }
                
                showStatus(errorMessage, 'error', 'openaiStatus');
            }
        }

        // ===== ì™„ì „ ìë™ ëª¨ë“œ ì½˜í…ì¸  ìƒì„± =====
        async function generateAutoContent() {
            const keyword = document.getElementById('viralKeyword').value.trim();
            const channelType = document.getElementById('channelType').value;
            const contentTone = document.getElementById('contentTone').value;
            const slideCount = document.getElementById('slideCount').value;

            updateProgress(15, 'ğŸ§  GPT-4 ë°”ì´ëŸ´ ë¶„ì„', `"${keyword}" í‚¤ì›Œë“œë¡œ 100ë§Œë·° ì½˜í…ì¸  ì„¤ê³„ ì¤‘...`, 'ğŸ§ ');
            
            const prompt = viralPromptTemplates.auto.contentAnalysis
                .replace('{keyword}', keyword)
                .replace('{channelType}', channelType)
                .replace('{contentTone}', contentTone)
                .replace('{slideCount}', slideCount);

            console.log('ğŸ¤– GPT-4 í”„ë¡¬í”„íŠ¸:', prompt);

            const response = await callOpenAI(prompt, selectedGPTModel, 3000, 0.8);
            console.log('ğŸ¤– GPT-4 ì‘ë‹µ:', response);

            let contentData;
            try {
                // JSON ì¶”ì¶œ
                const jsonMatch = response.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    contentData = JSON.parse(jsonMatch[0]);
                } else {
                    contentData = JSON.parse(response);
                }
                
                // ë°ì´í„° ê²€ì¦ ë° ë³´ì •
                contentData = validateAndFixContentData(contentData, slideCount);
                
                updateProgress(35, 'âœ… ì½˜í…ì¸  êµ¬ì¡° ì™„ì„±', `"${contentData.title}" - ${contentData.slides.length}ì¥ ìŠ¬ë¼ì´ë“œ ìƒì„±`, 'ğŸ“‹');
                
                return contentData;
                
            } catch (parseError) {
                console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', parseError);
                console.log('ì›ë³¸ ì‘ë‹µ:', response);
                
                // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë°±ì—… ìƒì„±
                return generateBackupContent(keyword, slideCount);
            }
        }

        // ===== ë°˜ìë™ ëª¨ë“œ ì½˜í…ì¸  ìƒì„± =====
        async function generateSemiAutoContent() {
            const title = document.getElementById('contentTitle').value.trim();
            const content = document.getElementById('contentDescription').value.trim();
            const slideCount = document.getElementById('slideCount').value;

            updateProgress(15, 'ğŸ“ ì½˜í…ì¸  ìµœì í™”', `"${title}" ì½˜í…ì¸ ë¥¼ ë°”ì´ëŸ´ í˜•íƒœë¡œ ë³€í™˜ ì¤‘...`, 'ğŸ“');

            const prompt = viralPromptTemplates.semiAuto.contentAnalysis
                .replace('{title}', title)
                .replace('{content}', content)
                .replace('{slideCount}', slideCount);

            const response = await callOpenAI(prompt, selectedGPTModel, 3000, 0.7);
            
            try {
                const jsonMatch = response.match(/\{[\s\S]*\}/);
                const contentData = JSON.parse(jsonMatch ? jsonMatch[0] : response);
                
                updateProgress(35, 'âœ… ìµœì í™” ì™„ë£Œ', `${contentData.slides.length}ì¥ êµ¬ì¡°ë¡œ ì¬êµ¬ì„± ì™„ë£Œ`, 'âœ…');
                
                return validateAndFixContentData(contentData, slideCount);
                
            } catch (error) {
                console.error('ë°˜ìë™ ëª¨ë“œ íŒŒì‹± ì˜¤ë¥˜:', error);
                return generateBackupContent(title, slideCount);
            }
        }

        // ===== ìˆ˜ë™ ëª¨ë“œ ì½˜í…ì¸  ìƒì„± =====
        async function generateManualContent() {
            const title = document.getElementById('manualTitle').value.trim();
            const content = document.getElementById('manualContent').value.trim();
            const slideCount = parseInt(document.getElementById('slideCount').value);

            updateProgress(15, 'ğŸ“‹ ìˆ˜ë™ ì½˜í…ì¸  êµ¬ì„±', 'ì…ë ¥í•˜ì‹  ë‚´ìš©ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ êµ¬ì„± ì¤‘...', 'ğŸ“‹');

            // ê°„ë‹¨í•œ ìŠ¬ë¼ì´ë“œ ë¶„í• 
            const sentences = content.split(/[.!?]\s+/).filter(s => s.trim().length > 0);
            const slides = [];
            
            // ì²« ìŠ¬ë¼ì´ë“œëŠ” ì œëª©
            slides.push({
                number: 1,
                title: title,
                content: "ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤!",
                emotion: "ê¸°ëŒ€ê°",
                visualKeywords: title.split(' ').slice(0, 3).join(' ')
            });

            // ë‚˜ë¨¸ì§€ ìŠ¬ë¼ì´ë“œ ë¶„ë°°
            const contentPerSlide = Math.ceil(sentences.length / (slideCount - 1));
            for (let i = 0; i < slideCount - 1; i++) {
                const startIdx = i * contentPerSlide;
                const endIdx = Math.min(startIdx + contentPerSlide, sentences.length);
                const slideContent = sentences.slice(startIdx, endIdx).join('. ');
                
                if (slideContent.trim()) {
                    slides.push({
                        number: slides.length + 1,
                        title: `í¬ì¸íŠ¸ ${slides.length}`,
                        content: slideContent,
                        emotion: "ì§‘ì¤‘",
                        visualKeywords: extractKeywords(slideContent)
                    });
                }
            }

            updateProgress(35, 'âœ… ìˆ˜ë™ êµ¬ì„± ì™„ë£Œ', `${slides.length}ì¥ ìŠ¬ë¼ì´ë“œ ì¤€ë¹„ ì™„ë£Œ`, 'âœ…');

            return {
                title: title,
                hook: title,
                slides: slides,
                viralScore: 75,
                hashtags: ["#ì½˜í…ì¸ ", "#ìœ íŠœë¸Œì‡¼ì¸ "],
                thumbnail: `${title}ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì´ë¯¸ì§€`
            };
        }

        // ===== ì½˜í…ì¸  ë°ì´í„° ê²€ì¦ ë° ë³´ì • =====
        function validateAndFixContentData(data, targetSlideCount) {
            // ê¸°ë³¸ êµ¬ì¡° í™•ì¸
            if (!data.slides || !Array.isArray(data.slides)) {
                throw new Error('ìŠ¬ë¼ì´ë“œ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }

            // ìŠ¬ë¼ì´ë“œ ê°œìˆ˜ ì¡°ì •
            const target = parseInt(targetSlideCount);
            if (data.slides.length < target) {
                // ë¶€ì¡±í•œ ê²½ìš° ë§ˆì§€ë§‰ ìŠ¬ë¼ì´ë“œ ë³µì œ ë° ë³€í˜•
                while (data.slides.length < target) {
                    const lastSlide = data.slides[data.slides.length - 1];
                    const newSlide = {
                        number: data.slides.length + 1,
                        title: `ì¶”ê°€ í¬ì¸íŠ¸ ${data.slides.length + 1}`,
                        content: lastSlide.content + " ë” ìì„¸íˆ ì•Œì•„ë³´ì„¸ìš”!",
                        emotion: lastSlide.emotion || "ê´€ì‹¬",
                        visualKeywords: lastSlide.visualKeywords || "ì •ë³´"
                    };
                    data.slides.push(newSlide);
                }
            } else if (data.slides.length > target) {
                // ì´ˆê³¼í•œ ê²½ìš° ìë¥´ê¸°
                data.slides = data.slides.slice(0, target);
            }

            // ìŠ¬ë¼ì´ë“œ ë²ˆí˜¸ ì¬ì •ë ¬
            data.slides.forEach((slide, index) => {
                slide.number = index + 1;
            });

            // ëˆ„ë½ëœ í•„ë“œ ë³´ì™„
            data.title = data.title || data.optimizedTitle || 'í¥ë¯¸ë¡œìš´ ì½˜í…ì¸ ';
            data.hook = data.hook || data.title;
            data.viralScore = data.viralScore || 80;
            data.hashtags = data.hashtags || ['#ìœ íŠœë¸Œì‡¼ì¸ ', '#ë°”ì´ëŸ´'];
            data.thumbnail = data.thumbnail || `${data.title}ì— ëŒ€í•œ ë§¤ë ¥ì ì¸ ì¸ë„¤ì¼`;

            return data;
        }

        // ===== ë°±ì—… ì½˜í…ì¸  ìƒì„± =====
        function generateBackupContent(keyword, slideCount) {
            const count = parseInt(slideCount);
            const slides = [];
            
            for (let i = 1; i <= count; i++) {
                slides.push({
                    number: i,
                    title: i === 1 ? keyword : `${keyword} - í¬ì¸íŠ¸ ${i}`,
                    content: i === 1 ? 
                        `${keyword}ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤!` : 
                        `${keyword}ì˜ ì¤‘ìš”í•œ ${i}ë²ˆì§¸ í¬ì¸íŠ¸ì…ë‹ˆë‹¤.`,
                    emotion: i === 1 ? "ê¸°ëŒ€ê°" : "ê´€ì‹¬",
                    visualKeywords: keyword
                });
            }

            return {
                title: `${keyword} ì™„ì „ ì •ë³µ`,
                hook: `${keyword}ì˜ ë†€ë¼ìš´ ì§„ì‹¤`,
                slides: slides,
                viralScore: 75,
                hashtags: [`#${keyword}`, '#ìœ íŠœë¸Œì‡¼ì¸ '],
                thumbnail: `${keyword}ì— ëŒ€í•œ í¥ë¯¸ë¡œìš´ ì´ë¯¸ì§€`
            };
        }

        // ===== AI ì´ë¯¸ì§€ ìƒì„± ì‹œìŠ¤í…œ =====
        async function generateAllImages(contentData) {
            const images = [];
            const visualStyle = document.getElementById('visualStyle').value;
            const imageQuality = document.getElementById('imageQuality').value;
            const imageSize = document.getElementById('imageSize').value;
            const imageStyle = document.getElementById('imageStyle').value;

            // ì¸ë„¤ì¼ ì´ë¯¸ì§€ ìƒì„±
            updateProgress(65, 'ğŸ¨ ì¸ë„¤ì¼ ìƒì„±', 'DALL-E 3ê°€ ë§¤ë ¥ì ì¸ ì¸ë„¤ì¼ì„ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤...', 'ğŸ–¼ï¸');
            
            try {
                const thumbnailPrompt = viralPromptTemplates[selectedGenerationMode === 'auto' ? 'auto' : 'semiAuto'].imagePrompt
                    .replace('{title}', contentData.title)
                    .replace('{visualStyle}', visualStyle)
                    .replace('{emotion}', 'exciting')
                    .replace('{visualKeywords}', contentData.thumbnail);

                const thumbnailUrl = await generateImageWithDALLE(thumbnailPrompt, imageQuality, imageSize, imageStyle);
                
                if (thumbnailUrl) {
                    images.push({
                        type: 'thumbnail',
                        url: thumbnailUrl,
                        prompt: thumbnailPrompt,
                        title: 'ì¸ë„¤ì¼'
                    });
                }
            } catch (error) {
                console.warn('ì¸ë„¤ì¼ ìƒì„± ì‹¤íŒ¨:', error);
            }

            // ê° ìŠ¬ë¼ì´ë“œë³„ ì´ë¯¸ì§€ ìƒì„± (ì²˜ìŒ 5ê°œë§Œ)
            const maxImages = Math.min(5, contentData.slides.length);
            
            for (let i = 0; i < maxImages; i++) {
                const slide = contentData.slides[i];
                const progress = 65 + (i + 1) * (15 / maxImages);
                
                updateProgress(progress, 'ğŸ¨ ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ìƒì„±', `${i + 1}/${maxImages} - "${slide.title}" ì´ë¯¸ì§€ ìƒì„± ì¤‘...`, 'ğŸ¨');
                
                try {
                    const slidePrompt = `High-quality image for: "${slide.title}". 
Content theme: ${slide.content}. 
Style: ${visualStyle}, professional, clean, modern.
Visual elements: ${slide.visualKeywords || slide.title}.
Emotion: ${slide.emotion || 'professional'}.
Format: Vertical 9:16, mobile-optimized, vibrant colors.`;

                    const imageUrl = await generateImageWithDALLE(slidePrompt, imageQuality, imageSize, imageStyle);
                    
                    if (imageUrl) {
                        images.push({
                            type: 'slide',
                            slideNumber: slide.number,
                            url: imageUrl,
                            prompt: slidePrompt,
                            title: slide.title
                        });
                    }
                    
                    // API ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ë°©ì§€
                    await delay(1000);
                    
                } catch (error) {
                    console.warn(`ìŠ¬ë¼ì´ë“œ ${slide.number} ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨:`, error);
                    
                    // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì´ë¯¸ì§€ ì •ë³´ ì¶”ê°€
                    images.push({
                        type: 'slide',
                        slideNumber: slide.number,
                        url: null,
                        error: error.message,
                        title: slide.title
                    });
                }
            }

            // ë‚˜ë¨¸ì§€ ìŠ¬ë¼ì´ë“œëŠ” ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ì¬ì‚¬ìš©
            if (images.length > 1 && contentData.slides.length > maxImages) {
                const firstSlideImage = images.find(img => img.type === 'slide' && img.url);
                if (firstSlideImage) {
                    for (let i = maxImages; i < contentData.slides.length; i++) {
                        images.push({
                            type: 'slide',
                            slideNumber: i + 1,
                            url: firstSlideImage.url,
                            title: contentData.slides[i].title,
                            reused: true
                        });
                    }
                }
            }

            console.log('ğŸ¨ ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ:', images);
            return images;
        }

        // ===== ìŠ¬ë¼ì´ë“œì‡¼ ìƒì„± ì‹œìŠ¤í…œ =====
        async function createSlideshowWithImages(contentData, imagesData) {
            const container = document.getElementById('slideshowContainer');
            if (!container) return;

            container.innerHTML = '';

            contentData.slides.forEach((slide, index) => {
                const slideElement = createSlideElement(slide, index, imagesData);
                container.appendChild(slideElement);
            });

            currentSlide = 0;
            showSlide(0);
            updateSlideCounter();
        }

        // ===== ê°œë³„ ìŠ¬ë¼ì´ë“œ ìš”ì†Œ ìƒì„± =====
        function createSlideElement(slide, index, imagesData) {
            const slideDiv = document.createElement('div');
            slideDiv.className = 'slide';
            
            // ë°°ê²½ ì´ë¯¸ì§€ ì°¾ê¸°
            const slideImage = imagesData.find(img => 
                img.type === 'slide' && img.slideNumber === slide.number && img.url
            );
            
            if (slideImage && slideImage.url) {
                slideDiv.style.backgroundImage = `url('${slideImage.url}')`;
                slideDiv.style.backgroundSize = 'cover';
                slideDiv.style.backgroundPosition = 'center';
            } else {
                // ê¸°ë³¸ ê·¸ë¼ë””ì–¸íŠ¸ ë°°ê²½
                const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe'];
                const color1 = colors[index % colors.length];
                const color2 = colors[(index + 1) % colors.length];
                slideDiv.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
            }

            // ì˜¤ë²„ë ˆì´ ì¶”ê°€ (í…ìŠ¤íŠ¸ ê°€ë…ì„± í–¥ìƒ)
            const overlay = document.createElement('div');
            overlay.className = 'slide-overlay';
            slideDiv.appendChild(overlay);

            // ìŠ¬ë¼ì´ë“œ ì½˜í…ì¸ 
            const slideContent = document.createElement('div');
            slideContent.className = 'slide-content';
            
            // ì•„ì´ì½˜ (ê°ì • ê¸°ë°˜)
            const iconDiv = document.createElement('div');
            iconDiv.className = 'slide-icon';
            iconDiv.textContent = getEmotionIcon(slide.emotion) || 'ğŸš€';
            
            // ì œëª©
            const titleDiv = document.createElement('div');
            titleDiv.className = 'slide-title';
            titleDiv.textContent = slide.title || '';
            
            // ë‚´ìš©
            const contentDiv = document.createElement('div');
            contentDiv.className = 'slide-subtitle';
            contentDiv.textContent = slide.content || '';
            
            slideContent.appendChild(iconDiv);
            slideContent.appendChild(titleDiv);
            slideContent.appendChild(contentDiv);
            slideDiv.appendChild(slideContent);
            
            return slideDiv;
        }

        // ===== ê°ì • ì•„ì´ì½˜ ë§¤í•‘ =====
        function getEmotionIcon(emotion) {
            const iconMap = {
                'ê¸°ëŒ€ê°': 'ğŸš€', 'ë†€ë¼ì›€': 'ğŸ˜±', 'í˜¸ê¸°ì‹¬': 'ğŸ¤”', 'ì¬ë¯¸': 'ğŸ˜„',
                'ê´€ì‹¬': 'ğŸ‘€', 'ì§‘ì¤‘': 'ğŸ¯', 'ì„±ì·¨ê°': 'ğŸ†', 'ë™ê¸°ë¶€ì—¬': 'ğŸ’ª',
                'í¬ë§': 'â­', 'ì›ƒìŒ': 'ğŸ˜‚', 'ê³µê°': 'â¤ï¸', 'í•™ìŠµìš•êµ¬': 'ğŸ“š',
                'exciting': 'ğŸ”¥', 'professional': 'ğŸ’¼', 'inspiring': 'âœ¨'
            };
            return iconMap[emotion] || 'ğŸ’«';
        }

        // ===== í‚¤ì›Œë“œ ì¶”ì¶œ í•¨ìˆ˜ =====
        function extractKeywords(text) {
            const words = text.split(/\s+/).filter(word => word.length > 2);
            return words.slice(0, 3).join(' ');
        }

        // ===== ìŠ¬ë¼ì´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì‹œìŠ¤í…œ =====
        function showSlide(index) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
            
            currentSlide = index;
            updateSlideCounter();
        }

        function updateSlideCounter() {
            const counter = document.getElementById('slideCounter');
            if (counter && generatedSlides.length > 0) {
                counter.textContent = `${currentSlide + 1} / ${generatedSlides.length}`;
            }
        }

        function prevSlide() {
            if (generatedSlides.length === 0) return;
            const newIndex = currentSlide > 0 ? currentSlide - 1 : generatedSlides.length - 1;
            showSlide(newIndex);
            if (isAutoPlaying) toggleAutoPlay();
        }

        function nextSlide() {
            if (generatedSlides.length === 0) return;
            const newIndex = currentSlide < generatedSlides.length - 1 ? currentSlide + 1 : 0;
            showSlide(newIndex);
            if (isAutoPlaying) toggleAutoPlay();
        }

        function toggleAutoPlay() {
            const autoPlayBtn = document.getElementById('autoPlayBtn');
            
            if (isAutoPlaying) {
                clearInterval(autoPlayInterval);
                isAutoPlaying = false;
                if (autoPlayBtn) autoPlayBtn.textContent = 'â–¶ï¸ ìë™ì¬ìƒ';
            } else {
                autoPlayInterval = setInterval(() => {
                    const nextIndex = currentSlide < generatedSlides.length - 1 ? currentSlide + 1 : 0;
                    showSlide(nextIndex);
                }, 3000);
                isAutoPlaying = true;
                if (autoPlayBtn) autoPlayBtn.textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
            }
        }

        // ===== ê²°ê³¼ í‘œì‹œ ì‹œìŠ¤í…œ =====
        function showResults(contentData) {
            const resultSection = document.getElementById('resultSection');
            if (resultSection) {
                resultSection.classList.remove('hidden');
                resultSection.scrollIntoView({ behavior: 'smooth' });
            }

            // ì½˜í…ì¸  íƒ­ ì—…ë°ì´íŠ¸
            updateContentTab(contentData);
            
            // ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ì—…ë°ì´íŠ¸
            updateImageGallery();
            
            // ë¶„ì„ íƒ­ ì—…ë°ì´íŠ¸
            updateAnalyticsTab(contentData);
        }

        // ===== íƒ­ ì‹œìŠ¤í…œ =====
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            const tabBtn = document.querySelector(`.tab-btn[onclick="showTab('${tabName}')"]`);
            const tabContent = document.getElementById(tabName + 'Tab');
            
            if (tabBtn) tabBtn.classList.add('active');
            if (tabContent) tabContent.classList.add('active');
        }

        function updateContentTab(contentData) {
            const contentElement = document.getElementById('generatedContent');
            if (!contentElement) return;

            contentElement.innerHTML = `
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #4ecdc4; margin-bottom: 15px;">ğŸ“ ì œëª©</h3>
                    <div style="font-size: 1.4em; font-weight: bold; margin-bottom: 20px;">${contentData.title}</div>
                    
                    <h3 style="color: #4ecdc4; margin-bottom: 15px;">ğŸ¯ ê°•ë ¥í•œ í›…</h3>
                    <div style="font-size: 1.2em; margin-bottom: 20px; color: #feca57;">"${contentData.hook}"</div>
                    
                    <h3 style="color: #4ecdc4; margin-bottom: 15px;">ğŸ† ë°”ì´ëŸ´ ì ìˆ˜</h3>
                    <div style="font-size: 1.3em; font-weight: bold; color: ${contentData.viralScore > 80 ? '#43e97b' : contentData.viralScore > 60 ? '#feca57' : '#ff6b6b'};">
                        ${contentData.viralScore}/100 ì 
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #4ecdc4; margin-bottom: 15px;">ğŸ“‹ ìŠ¬ë¼ì´ë“œ êµ¬ì„±</h3>
                    ${contentData.slides.map(slide => `
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 15px; border-left: 4px solid #4ecdc4;">
                            <h4 style="color: #4ecdc4; margin-bottom: 10px;">${slide.number}. ${slide.title}</h4>
                            <p style="line-height: 1.6;">${slide.content}</p>
                            <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                                ê°ì •: ${getEmotionIcon(slide.emotion)} ${slide.emotion} | í‚¤ì›Œë“œ: ${slide.visualKeywords || 'N/A'}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div>
                    <h3 style="color: #4ecdc4; margin-bottom: 15px;">#ï¸âƒ£ ì¶”ì²œ í•´ì‹œíƒœê·¸</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        ${contentData.hashtags.map(tag => `
                            <span style="background: linear-gradient(45deg, #667eea, #764ba2); padding: 8px 15px; border-radius: 20px; font-weight: bold;">
                                ${tag}
                            </span>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function updateImageGallery() {
            const gallery = document.getElementById('imageGallery');
            if (!gallery) return;

            gallery.innerHTML = '';

            if (generatedImages.length === 0) {
                gallery.innerHTML = '<p style="text-align: center; opacity: 0.7;">ì´ë¯¸ì§€ê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            generatedImages.forEach((image, index) => {
                if (image.url) {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item';
                    galleryItem.innerHTML = `
                        <img src="${image.url}" alt="${image.title}" loading="lazy">
                        <div class="gallery-overlay">
                            ${image.type === 'thumbnail' ? 'ğŸ“· ì¸ë„¤ì¼' : `ğŸ“„ ìŠ¬ë¼ì´ë“œ ${image.slideNumber}`}
                            <br>${image.title}
                            ${image.reused ? '<br>ğŸ”„ ì¬ì‚¬ìš©ë¨' : ''}
                        </div>
                    `;
                    
                    galleryItem.addEventListener('click', () => {
                        showImageModal(image);
                    });
                    
                    gallery.appendChild(galleryItem);
                }
            });
        }

        function updateAnalyticsTab(contentData) {
            const analytics = document.getElementById('contentAnalytics');
            if (!analytics) return;

            // ë°”ì´ëŸ´ ë¶„ì„ ìˆ˜í–‰
            const channelType = document.getElementById('channelType')?.value || 'educational';
            const analysis = analyzeViralPotential(contentData.title + ' ' + contentData.slides.map(s => s.content).join(' '), channelType);

            analytics.innerHTML = `
                <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; text-align: center;">
                    <h4 style="color: #4ecdc4; margin-bottom: 15px;">ğŸ† ë°”ì´ëŸ´ ì ìˆ˜</h4>
                    <div style="font-size: 3em; font-weight: bold; color: ${contentData.viralScore > 80 ? '#43e97b' : contentData.viralScore > 60 ? '#feca57' : '#ff6b6b'};">
                        ${contentData.viralScore}/100
                    </div>
                    <div style="margin-top: 10px; font-size: 1.2em;">
                        ${analysis.rating}
                    </div>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; text-align: center;">
                    <h4 style="color: #4ecdc4; margin-bottom: 15px;">ğŸ“Š ì˜ˆìƒ ì„±ê³¼</h4>
                    <div style="font-size: 1.4em; font-weight: bold; color: #43e97b;">
                        ${Math.floor(contentData.viralScore * 10000).toLocaleString()}+
                    </div>
                    <div style="margin-top: 5px;">ì˜ˆìƒ ì¡°íšŒìˆ˜</div>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; text-align: center;">
                    <h4 style="color: #4ecdc4; margin-bottom: 15px;">â±ï¸ ìµœì  ê¸¸ì´</h4>
                    <div style="font-size: 1.4em; font-weight: bold; color: #4ecdc4;">
                        ${contentData.slides.length * 3} ì´ˆ
                    </div>
                    <div style="margin-top: 5px;">ìœ íŠœë¸Œ ì‡¼ì¸  ì™„ë²½ ìµœì í™”</div>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; text-align: center;">
                    <h4 style="color: #4ecdc4; margin-bottom: 15px;">ğŸ¯ íƒ€ê²Ÿ ë¶„ì„</h4>
                    <div style="line-height: 1.6;">
                        <strong>í›… ê°•ë„:</strong> ${analysis.analysis.hooks}%<br>
                        <strong>ê°ì • ì—°ê²°:</strong> ${analysis.analysis.emotions}%<br>
                        <strong>í‚¤ì›Œë“œ ìµœì í™”:</strong> ${analysis.analysis.keywords}%
                    </div>
                </div>
            `;
        }

        // ===== 3ë‹¨ê³„: í™˜ìƒì ì¸ ì™„ë²½ ì˜ìƒ ë…¹í™” ì‹œìŠ¤í…œ =====
        
        // ê³ ê¸‰ ë…¹í™” ì„¤ì •
        const recordingConfig = {
            canvas: {
                width: 1080,
                height: 1920,
                fps: 30,
                bitrate: 8000000
            },
            video: {
                format: 'webm',
                codec: 'vp9',
                quality: 'high'
            },
            audio: {
                enabled: true,
                bitrate: 128000,
                sampleRate: 44100
            },
            timing: {
                totalDuration: 45000, // 45ì´ˆ
                slideTransition: 800,  // 0.8ì´ˆ ì „í™˜
                fadeEffect: 400       // 0.4ì´ˆ í˜ì´ë“œ
            }
        };

        // ë…¹í™” ìƒíƒœ ê´€ë¦¬
        let recordingState = {
            isRecording: false,
            mediaRecorder: null,
            recordedChunks: [],
            canvas: null,
            ctx: null,
            currentFrame: 0,
            startTime: 0,
            audioContext: null,
            audioStream: null,
            videoStream: null
        };

        // ìŒì„± í•©ì„± ì‹œìŠ¤í…œ
        let speechSystem = {
            voices: [],
            selectedVoice: null,
            isEnabled: false,
            rate: 1.0,
            pitch: 1.0,
            volume: 0.8
        };

        // ë°°ê²½ìŒì•… ì‹œìŠ¤í…œ
        let musicSystem = {
            audioContext: null,
            musicBuffer: null,
            gainNode: null,
            isPlaying: false,
            volume: 0.3
        };

        // ===== ê³ ê¸‰ ì˜ìƒ ë…¹í™” ì´ˆê¸°í™” =====
        async function initializeAdvancedRecording() {
            try {
                console.log('ğŸ¬ ê³ ê¸‰ ì˜ìƒ ë…¹í™” ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');
                
                // Canvas ìƒì„±
                recordingState.canvas = document.createElement('canvas');
                recordingState.canvas.width = recordingConfig.canvas.width;
                recordingState.canvas.height = recordingConfig.canvas.height;
                recordingState.ctx = recordingState.canvas.getContext('2d');
                
                // ê³ í’ˆì§ˆ ë Œë”ë§ ì„¤ì •
                recordingState.ctx.imageSmoothingEnabled = true;
                recordingState.ctx.imageSmoothingQuality = 'high';
                recordingState.ctx.textRenderingOptimization = 'optimizeQuality';
                
                // ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ìƒì„±
                recordingState.videoStream = recordingState.canvas.captureStream(recordingConfig.canvas.fps);
                
                // ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                await initializeAudioSystem();
                
                // ìŒì„± í•©ì„± ì´ˆê¸°í™”
                initializeSpeechSynthesis();
                
                // ë°°ê²½ìŒì•… ì´ˆê¸°í™”
                await initializeBackgroundMusic();
                
                console.log('âœ… ê³ ê¸‰ ì˜ìƒ ë…¹í™” ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                return true;
                
            } catch (error) {
                console.error('âŒ ë…¹í™” ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ===== ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ ì´ˆê¸°í™” =====
        async function initializeAudioSystem() {
            try {
                // Web Audio API ì´ˆê¸°í™”
                recordingState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // ë§ˆì´í¬ ê¶Œí•œ ìš”ì²­ (ì„ íƒì‚¬í•­)
                try {
                    recordingState.audioStream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true,
                            sampleRate: recordingConfig.audio.sampleRate
                        } 
                    });
                    console.log('ğŸ¤ ë§ˆì´í¬ ì˜¤ë””ì˜¤ ì‚¬ìš© ê°€ëŠ¥');
                } catch (micError) {
                    console.warn('âš ï¸ ë§ˆì´í¬ ì ‘ê·¼ ë¶ˆê°€ (ì„ íƒì‚¬í•­):', micError);
                }
                
                return true;
                
            } catch (error) {
                console.warn('âš ï¸ ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                return false;
            }
        }

        // ===== ìŒì„± í•©ì„± ì‹œìŠ¤í…œ ì´ˆê¸°í™” =====
        function initializeSpeechSynthesis() {
            if (!('speechSynthesis' in window)) {
                console.warn('âš ï¸ ìŒì„± í•©ì„± ì§€ì›í•˜ì§€ ì•ŠìŒ');
                return;
            }
            
            // ìŒì„± ëª©ë¡ ë¡œë“œ
            speechSystem.voices = speechSynthesis.getVoices();
            
            // í•œêµ­ì–´ ìŒì„± ì°¾ê¸°
            speechSystem.selectedVoice = speechSystem.voices.find(voice => 
                voice.lang.includes('ko') || voice.name.includes('Korean')
            ) || speechSystem.voices[0];
            
            speechSynthesis.onvoiceschanged = () => {
                speechSystem.voices = speechSynthesis.getVoices();
                speechSystem.selectedVoice = speechSystem.voices.find(voice => 
                    voice.lang.includes('ko') || voice.name.includes('Korean')
                ) || speechSystem.voices[0];
            };
            
            console.log('ğŸ—£ï¸ ìŒì„± í•©ì„± ì‹œìŠ¤í…œ ì¤€ë¹„ë¨:', speechSystem.selectedVoice?.name);
        }

        // ===== ë°°ê²½ìŒì•… ì‹œìŠ¤í…œ ì´ˆê¸°í™” =====
        async function initializeBackgroundMusic() {
            if (!recordingState.audioContext) return;
            
            try {
                // Web Audio APIë¡œ ìŒì•… ìƒì„±
                musicSystem.audioContext = recordingState.audioContext;
                musicSystem.gainNode = musicSystem.audioContext.createGain();
                musicSystem.gainNode.connect(musicSystem.audioContext.destination);
                musicSystem.gainNode.gain.value = musicSystem.volume;
                
                console.log('ğŸµ ë°°ê²½ìŒì•… ì‹œìŠ¤í…œ ì¤€ë¹„ë¨');
                
            } catch (error) {
                console.warn('âš ï¸ ë°°ê²½ìŒì•… ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // ===== ë©”ì¸ ë…¹í™” ì‹œì‘ í•¨ìˆ˜ =====
        async function startRecording() {
            if (generatedSlides.length === 0) {
                showStatus('âŒ ë¨¼ì € ì½˜í…ì¸ ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”!', 'error', 'openaiStatus');
                return;
            }

            try {
                showRecordingUI(true);
                updateRecordingProgress(0, 'ğŸ¬ ê³ ê¸‰ ì˜ìƒ ë…¹í™” ì¤€ë¹„ ì¤‘...', 'Canvas ë Œë”ë§ ì—”ì§„ ì´ˆê¸°í™” ì¤‘...');

                // ê³ ê¸‰ ë…¹í™” ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                await initializeAdvancedRecording();
                
                updateRecordingProgress(15, 'ğŸ¨ ë Œë”ë§ ì—”ì§„ ì¤€ë¹„ ì™„ë£Œ', 'ì™„ë²½í•œ 45ì´ˆ ì˜ìƒì„ ìœ„í•œ ì„¤ì • ì¤‘...');
                await delay(500);

                // MediaRecorder ì„¤ì •
                await setupMediaRecorder();
                
                updateRecordingProgress(25, 'ğŸµ ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ ë™ê¸°í™”', 'ìŒì„± í•©ì„±ê³¼ ë°°ê²½ìŒì•… ì¤€ë¹„ ì¤‘...');
                await delay(500);

                // ì‹¤ì œ ë…¹í™” ì‹œì‘
                await startAdvancedRecording();
                
            } catch (error) {
                console.error('ë…¹í™” ì‹œì‘ ì˜¤ë¥˜:', error);
                showRecordingUI(false);
                showStatus('âŒ ë…¹í™” ì‹œì‘ ì‹¤íŒ¨: ' + error.message, 'error', 'openaiStatus');
            }
        }

        // ===== MediaRecorder ì„¤ì • =====
        async function setupMediaRecorder() {
            const streams = [recordingState.videoStream];
            
            // ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì´ ìˆìœ¼ë©´ ì¶”ê°€
            if (recordingState.audioStream) {
                streams.push(recordingState.audioStream);
            }
            
            // ëª¨ë“  ìŠ¤íŠ¸ë¦¼ ê²°í•©
            const combinedStream = new MediaStream();
            streams.forEach(stream => {
                stream.getTracks().forEach(track => {
                    combinedStream.addTrack(track);
                });
            });
            
            // MediaRecorder ì˜µì…˜
            const options = {
                mimeType: 'video/webm;codecs=vp9,opus',
                videoBitsPerSecond: recordingConfig.canvas.bitrate,
                audioBitsPerSecond: recordingConfig.audio.bitrate
            };
            
            // í˜¸í™˜ì„± í™•ì¸
            if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                options.mimeType = 'video/webm;codecs=vp8,opus';
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'video/webm';
                }
            }
            
            recordingState.mediaRecorder = new MediaRecorder(combinedStream, options);
            recordingState.recordedChunks = [];
            
            recordingState.mediaRecorder.ondataavailable = (event) => {
                if (event.data && event.data.size > 0) {
                    recordingState.recordedChunks.push(event.data);
                }
            };
            
            recordingState.mediaRecorder.onstop = async () => {
                await finalizeRecording();
            };
            
            recordingState.mediaRecorder.onerror = (event) => {
                console.error('MediaRecorder ì˜¤ë¥˜:', event.error);
                showStatus('âŒ ë…¹í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'error', 'openaiStatus');
            };
        }

        // ===== ê³ ê¸‰ ë…¹í™” ì‹¤í–‰ =====
        async function startAdvancedRecording() {
            recordingState.isRecording = true;
            recordingState.startTime = Date.now();
            recordingState.currentFrame = 0;
            
            // MediaRecorder ì‹œì‘
            recordingState.mediaRecorder.start(100);
            
            updateRecordingProgress(30, 'ğŸš€ ê³ í’ˆì§ˆ ì˜ìƒ ë…¹í™” ì‹œì‘!', '45ì´ˆ ì™„ë²½ ì˜ìƒ ìƒì„± ì¤‘...');
            
            // ë°°ê²½ìŒì•… ì‹œì‘
            if (musicSystem.audioContext && document.getElementById('backgroundMusic').value !== 'none') {
                await startBackgroundMusic();
            }
            
            // ìŠ¬ë¼ì´ë“œë³„ ë…¹í™” ì‹¤í–‰
            await recordAllSlidesWithTiming();
        }

        // ===== íƒ€ì´ë° ê¸°ë°˜ ìŠ¬ë¼ì´ë“œ ë…¹í™” =====
        async function recordAllSlidesWithTiming() {
            const totalDuration = recordingConfig.timing.totalDuration;
            const slideCount = generatedSlides.length;
            const slideDisplayTime = (totalDuration - (slideCount * recordingConfig.timing.slideTransition)) / slideCount;
            
            console.log(`ğŸ¬ ${slideCount}ê°œ ìŠ¬ë¼ì´ë“œ, ê° ${slideDisplayTime/1000}ì´ˆ í‘œì‹œ`);
            
            for (let i = 0; i < slideCount && recordingState.isRecording; i++) {
                const progress = 30 + ((i + 1) / slideCount) * 60;
                updateRecordingProgress(progress, `ğŸ¨ ìŠ¬ë¼ì´ë“œ ${i + 1}/${slideCount} ë Œë”ë§`, `"${generatedSlides[i].title}" ê³ í’ˆì§ˆ ë Œë”ë§ ì¤‘...`);
                
                // ìŠ¬ë¼ì´ë“œ ë Œë”ë§ ì‹œì‘
                const slideStartTime = Date.now();
                
                // í˜ì´ë“œ ì¸ íš¨ê³¼
                await renderSlideWithTransition(i, 'fadeIn');
                
                // ìŠ¬ë¼ì´ë“œ í‘œì‹œ ì‹œê°„ ë™ì•ˆ ì§€ì† ë Œë”ë§
                while (Date.now() - slideStartTime < slideDisplayTime && recordingState.isRecording) {
                    await renderCurrentSlide(i);
                    await delay(33); // 30fps
                }
                
                // í˜ì´ë“œ ì•„ì›ƒ íš¨ê³¼ (ë§ˆì§€ë§‰ ìŠ¬ë¼ì´ë“œ ì œì™¸)
                if (i < slideCount - 1) {
                    await renderSlideWithTransition(i, 'fadeOut');
                }
                
                // ìŒì„± í•©ì„± (ì˜µì…˜)
                if (speechSystem.isEnabled && speechSystem.selectedVoice) {
                    speakSlideContent(generatedSlides[i]);
                }
            }
            
            // ë…¹í™” ì™„ë£Œ
            if (recordingState.isRecording) {
                updateRecordingProgress(95, 'ğŸ ì˜ìƒ ë§ˆë¬´ë¦¬ ì¤‘...', 'ìµœì¢… í”„ë ˆì„ ë Œë”ë§ ë° ì¸ì½”ë”© ì¤‘...');
                await delay(1000);
                
                recordingState.mediaRecorder.stop();
                recordingState.isRecording = false;
            }
        }

        // ===== ê³ í’ˆì§ˆ ìŠ¬ë¼ì´ë“œ ë Œë”ë§ =====
        async function renderCurrentSlide(slideIndex) {
            if (!recordingState.ctx || !generatedSlides[slideIndex]) return;
            
            const slide = generatedSlides[slideIndex];
            const canvas = recordingState.canvas;
            const ctx = recordingState.ctx;
            
            // Canvas í´ë¦¬ì–´
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ë°°ê²½ ë Œë”ë§
            await renderSlideBackground(ctx, slide, slideIndex);
            
            // í…ìŠ¤íŠ¸ ë Œë”ë§
            renderSlideText(ctx, slide, canvas.width, canvas.height);
            
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            renderSlideAnimations(ctx, slideIndex);
            
            recordingState.currentFrame++;
        }

        // ===== ë°°ê²½ ë Œë”ë§ ì‹œìŠ¤í…œ =====
        async function renderSlideBackground(ctx, slide, slideIndex) {
            const canvas = recordingState.canvas;
            
            // AI ìƒì„± ì´ë¯¸ì§€ ì°¾ê¸°
            const slideImage = generatedImages.find(img => 
                img.type === 'slide' && img.slideNumber === slide.number && img.url
            );
            
            if (slideImage && slideImage.url) {
                try {
                    // ì´ë¯¸ì§€ ë¡œë“œ ë° ê·¸ë¦¬ê¸°
                    const img = await loadImage(slideImage.url);
                    
                    // ì´ë¯¸ì§€ í¬ê¸° ì¡°ì • (9:16 ë¹„ìœ¨ ë§ì¶¤)
                    const scale = Math.max(canvas.width / img.width, canvas.height / img.height);
                    const scaledWidth = img.width * scale;
                    const scaledHeight = img.height * scale;
                    const x = (canvas.width - scaledWidth) / 2;
                    const y = (canvas.height - scaledHeight) / 2;
                    
                    ctx.drawImage(img, x, y, scaledWidth, scaledHeight);
                    
                    // í…ìŠ¤íŠ¸ ê°€ë…ì„±ì„ ìœ„í•œ ì˜¤ë²„ë ˆì´
                    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradient.addColorStop(0, 'rgba(0,0,0,0.4)');
                    gradient.addColorStop(0.5, 'rgba(0,0,0,0.2)');
                    gradient.addColorStop(1, 'rgba(0,0,0,0.6)');
                    
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                } catch (imageError) {
                    console.warn('ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨, ê·¸ë¼ë””ì–¸íŠ¸ ë°°ê²½ ì‚¬ìš©:', imageError);
                    renderGradientBackground(ctx, slideIndex);
                }
            } else {
                renderGradientBackground(ctx, slideIndex);
            }
        }

        function renderGradientBackground(ctx, slideIndex) {
            const canvas = recordingState.canvas;
            const colors = [
                ['#667eea', '#764ba2'],
                ['#f093fb', '#f5576c'], 
                ['#4facfe', '#00f2fe'],
                ['#43e97b', '#38f9d7'],
                ['#feca57', '#ff9ff3'],
                ['#ff6b6b', '#ee5a24']
            ];
            
            const colorPair = colors[slideIndex % colors.length];
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, colorPair[0]);
            gradient.addColorStop(1, colorPair[1]);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // ===== í…ìŠ¤íŠ¸ ë Œë”ë§ ì‹œìŠ¤í…œ =====
        function renderSlideText(ctx, slide, canvasWidth, canvasHeight) {
            // í…ìŠ¤íŠ¸ ê·¸ë¦¼ì ì„¤ì •
            ctx.shadowColor = 'rgba(0,0,0,0.8)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 4;
            ctx.shadowOffsetY = 4;
            
            // ì•„ì´ì½˜ ë Œë”ë§
            const iconSize = canvasHeight * 0.12;
            ctx.font = `bold ${iconSize}px Arial`;
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            const icon = getEmotionIcon(slide.emotion) || 'ğŸš€';
            ctx.fillText(icon, canvasWidth / 2, canvasHeight * 0.25);
            
            // ì œëª© ë Œë”ë§
            const titleSize = canvasHeight * 0.07;
            ctx.font = `900 ${titleSize}px Arial`;
            ctx.fillStyle = 'white';
            
            const title = slide.title || '';
            const titleLines = wrapText(ctx, title, canvasWidth * 0.9);
            const titleStartY = canvasHeight * 0.45;
            
            titleLines.forEach((line, index) => {
                ctx.fillText(line, canvasWidth / 2, titleStartY + (index * titleSize * 1.2));
            });
            
            // ë‚´ìš© ë Œë”ë§
            if (slide.content && slide.content.trim()) {
                const contentSize = canvasHeight * 0.045;
                ctx.font = `600 ${contentSize}px Arial`;
                ctx.fillStyle = 'rgba(255,255,255,0.95)';
                
                const content = slide.content;
                const contentLines = wrapText(ctx, content, canvasWidth * 0.85);
                const contentStartY = canvasHeight * 0.7;
                
                contentLines.forEach((line, index) => {
                    ctx.fillText(line, canvasWidth / 2, contentStartY + (index * contentSize * 1.4));
                });
            }
            
            // ê·¸ë¦¼ì ì´ˆê¸°í™”
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }

        // ===== ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì‹œìŠ¤í…œ =====
        function renderSlideAnimations(ctx, slideIndex) {
            const animationStyle = document.getElementById('animationStyle').value;
            const time = (Date.now() - recordingState.startTime) / 1000;
            
            if (animationStyle === 'dynamic') {
                renderParticleEffects(ctx, time);
            } else if (animationStyle === 'smooth') {
                renderSmoothEffects(ctx, time);
            }
            // 'minimal'ì€ ê¸°ë³¸ ë Œë”ë§ë§Œ ì‚¬ìš©
        }

        function renderParticleEffects(ctx, time) {
            const canvas = recordingState.canvas;
            
            for (let i = 0; i < 20; i++) {
                const x = (Math.sin(time * 0.5 + i * 0.3) * 0.4 + 0.5) * canvas.width;
                const y = (Math.cos(time * 0.7 + i * 0.5) * 0.4 + 0.5) * canvas.height;
                const size = Math.sin(time * 2 + i) * 8 + 12;
                const opacity = Math.sin(time * 1.5 + i) * 0.4 + 0.6;
                
                ctx.globalAlpha = opacity;
                ctx.fillStyle = 'rgba(255,255,255,0.8)';
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.globalAlpha = 1;
        }

        function renderSmoothEffects(ctx, time) {
            const canvas = recordingState.canvas;
            
            // ë¶€ë“œëŸ¬ìš´ ê·¸ë¼ë””ì–¸íŠ¸ ì˜¤ë²„ë ˆì´
            const gradient = ctx.createRadialGradient(
                canvas.width / 2, canvas.height / 2, 0,
                canvas.width / 2, canvas.height / 2, canvas.width / 2
            );
            
            const hue = (time * 20) % 360;
            gradient.addColorStop(0, `hsla(${hue}, 50%, 80%, 0.1)`);
            gradient.addColorStop(1, `hsla(${(hue + 60) % 360}, 50%, 60%, 0.05)`);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // ===== ì „í™˜ íš¨ê³¼ ì‹œìŠ¤í…œ =====
        async function renderSlideWithTransition(slideIndex, transitionType) {
            const transitionDuration = recordingConfig.timing.fadeEffect;
            const startTime = Date.now();
            
            while (Date.now() - startTime < transitionDuration) {
                const progress = (Date.now() - startTime) / transitionDuration;
                const alpha = transitionType === 'fadeIn' ? progress : 1 - progress;
                
                await renderCurrentSlide(slideIndex);
                
                // ì „í™˜ íš¨ê³¼ ì ìš©
                recordingState.ctx.globalCompositeOperation = 'source-over';
                recordingState.ctx.fillStyle = `rgba(0,0,0,${1 - alpha})`;
                recordingState.ctx.fillRect(0, 0, recordingState.canvas.width, recordingState.canvas.height);
                recordingState.ctx.globalCompositeOperation = 'source-over';
                
                await delay(16); // 60fps
            }
        }

        // ===== ë°°ê²½ìŒì•… ì‹œìŠ¤í…œ =====
        async function startBackgroundMusic() {
            if (!musicSystem.audioContext) return;
            
            const musicType = document.getElementById('backgroundMusic').value;
            if (musicType === 'none') return;
            
            try {
                // ê°„ë‹¨í•œ ë°°ê²½ìŒì•… ìƒì„± (Web Audio API)
                const oscillator = musicSystem.audioContext.createOscillator();
                const gainNode = musicSystem.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(musicSystem.audioContext.destination);
                
                // ìŒì•… ìŠ¤íƒ€ì¼ë³„ ì„¤ì •
                const musicSettings = {
                    upbeat: { frequency: 440, type: 'square', volume: 0.1 },
                    ambient: { frequency: 220, type: 'sine', volume: 0.05 },
                    corporate: { frequency: 330, type: 'triangle', volume: 0.08 }
                };
                
                const setting = musicSettings[musicType] || musicSettings.upbeat;
                oscillator.frequency.setValueAtTime(setting.frequency, musicSystem.audioContext.currentTime);
                oscillator.type = setting.type;
                gainNode.gain.setValueAtTime(setting.volume, musicSystem.audioContext.currentTime);
                
                oscillator.start();
                
                // 45ì´ˆ í›„ ì •ì§€
                setTimeout(() => {
                    oscillator.stop();
                }, recordingConfig.timing.totalDuration);
                
                musicSystem.isPlaying = true;
                console.log('ğŸµ ë°°ê²½ìŒì•… ì‹œì‘:', musicType);
                
            } catch (error) {
                console.warn('ğŸµ ë°°ê²½ìŒì•… ì‹œì‘ ì‹¤íŒ¨:', error);
            }
        }

        // ===== ìŒì„± í•©ì„± ì‹œìŠ¤í…œ =====
        function speakSlideContent(slide) {
            if (!speechSystem.isEnabled || !speechSystem.selectedVoice) return;
            
            const utterance = new SpeechSynthesisUtterance(slide.title);
            utterance.voice = speechSystem.selectedVoice;
            utterance.rate = speechSystem.rate;
            utterance.pitch = speechSystem.pitch;
            utterance.volume = speechSystem.volume;
            
            speechSynthesis.speak(utterance);
        }

        // ===== ë…¹í™” ì™„ë£Œ ì²˜ë¦¬ =====
        async function finalizeRecording() {
            updateRecordingProgress(98, 'ğŸ’¾ ìµœì¢… ì˜ìƒ ì²˜ë¦¬ ì¤‘...', 'ê³ í’ˆì§ˆ MP4 íŒŒì¼ ìƒì„± ì¤‘...');
            
            try {
                if (recordingState.recordedChunks.length === 0) {
                    throw new Error('ë…¹í™”ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const blob = new Blob(recordingState.recordedChunks, { type: 'video/webm' });
                const sizeMB = (blob.size / 1024 / 1024).toFixed(2);
                
                updateRecordingProgress(100, 'ğŸ‰ ì™„ë²½í•œ ì˜ìƒ ì™„ì„±!', `${sizeMB}MB ê³ í’ˆì§ˆ ìœ íŠœë¸Œ ì‡¼ì¸  ì¤€ë¹„ ì™„ë£Œ!`);
                await delay(1000);
                
                // ë‹¤ìš´ë¡œë“œ
                await downloadVideo(blob, sizeMB);
                
                // UI ì •ë¦¬
                showRecordingUI(false);
                showSuccessNotification(`ğŸ¬ ${sizeMB}MB ì™„ë²½í•œ ìœ íŠœë¸Œ ì‡¼ì¸ ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                
            } catch (error) {
                console.error('ë…¹í™” ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                showRecordingUI(false);
                showStatus('âŒ ì˜ìƒ ì²˜ë¦¬ ì‹¤íŒ¨: ' + error.message, 'error', 'openaiStatus');
            } finally {
                // ë¦¬ì†ŒìŠ¤ ì •ë¦¬
                cleanupRecordingResources();
            }
        }

        // ===== ì˜ìƒ ë‹¤ìš´ë¡œë“œ ì‹œìŠ¤í…œ =====
        async function downloadVideo(blob, sizeMB) {
            const timestamp = new Date().toISOString().slice(0, 16).replace(/[:-]/g, '');
            const filename = `VIRAL-SHORTS-${timestamp}-${sizeMB}MB.webm`;
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // URL ì •ë¦¬
            setTimeout(() => URL.revokeObjectURL(url), 1000);
            
            // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
            showVideoCompleteModal(filename, sizeMB);
        }

        // ===== ì™„ì„± ëª¨ë‹¬ í‘œì‹œ =====
        function showVideoCompleteModal(filename, sizeMB) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.95); z-index: 10000;
                display: flex; justify-content: center; align-items: center;
                backdrop-filter: blur(20px); font-family: 'Segoe UI', sans-serif;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 30px; padding: 50px; text-align: center; max-width: 600px; margin: 20px; color: white; box-shadow: 0 20px 60px rgba(67,233,123,0.4);">
                    <div style="font-size: 6em; margin-bottom: 20px; animation: pulse 2s infinite;">ğŸ¬</div>
                    <h2 style="margin-bottom: 25px; font-size: 3em; font-weight: 900;">ì™„ë²½í•œ ì˜ìƒ ì™„ì„±!</h2>
                    
                    <div style="background: rgba(255,255,255,0.2); padding: 30px; border-radius: 20px; margin: 25px 0; line-height: 1.8;">
                        <h3 style="margin-bottom: 20px; font-size: 1.6em;">ğŸ“Š ì˜ìƒ ì •ë³´</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; text-align: left; font-size: 1.1em;">
                            <div>ğŸ¬ í¬ë§·: WebM (ê³ í’ˆì§ˆ)</div>
                            <div>ğŸ“ í•´ìƒë„: 1080x1920 (9:16)</div>
                            <div>â±ï¸ ê¸¸ì´: ì •í™•íˆ 45ì´ˆ</div>
                            <div>ğŸ’¾ í¬ê¸°: ${sizeMB}MB</div>
                            <div>ğŸ¨ í”„ë ˆì„ìœ¨: 30fps</div>
                            <div>ğŸ“± ìµœì í™”: ìœ íŠœë¸Œ ì‡¼ì¸  ì™„ë²½</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <h4 style="color: #fff; margin-bottom: 15px;">ğŸš€ ë°”ë¡œ ì—…ë¡œë“œí•˜ì„¸ìš”!</h4>
                        <div style="font-size: 1.1em; line-height: 1.6;">
                            âœ… ìœ íŠœë¸Œ ì‡¼ì¸  ì™„ë²½ í˜¸í™˜<br>
                            âœ… 100ë§Œë·° ìµœì í™” ì™„ë£Œ<br>
                            âœ… ëª¨ë°”ì¼ ì¹œí™”ì  ì„¸ë¡œí˜•<br>
                            âœ… 45ì´ˆ ê³¨ë“  íƒ€ì„ ì¤€ìˆ˜
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                        <button onclick="window.open('https://studio.youtube.com/channel/upload', '_blank')" style="padding: 15px 30px; background: #ff0000; color: white; border: none; border-radius: 15px; font-size: 1.2em; cursor: pointer; font-weight: bold;">ğŸ“º ìœ íŠœë¸Œ ì—…ë¡œë“œ</button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 15px; font-size: 1.2em; cursor: pointer; font-weight: bold;">âœ… í™•ì¸</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 15ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (modal.parentElement) modal.remove();
            }, 15000);
        }

        // ===== ë…¹í™” ì¤‘ì§€ í•¨ìˆ˜ =====
        function stopRecording() {
            if (recordingState.isRecording && recordingState.mediaRecorder) {
                recordingState.mediaRecorder.stop();
                recordingState.isRecording = false;
                console.log('ğŸ›‘ ì‚¬ìš©ìê°€ ë…¹í™” ì¤‘ì§€');
            }
        }

        // ===== ë¦¬ì†ŒìŠ¤ ì •ë¦¬ =====
        function cleanupRecordingResources() {
            try {
                // ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì •ë¦¬
                if (recordingState.audioStream) {
                    recordingState.audioStream.getTracks().forEach(track => track.stop());
                    recordingState.audioStream = null;
                }
                
                // ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì •ë¦¬
                if (recordingState.videoStream) {
                    recordingState.videoStream.getTracks().forEach(track => track.stop());
                    recordingState.videoStream = null;
                }
                
                // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì •ë¦¬
                if (recordingState.audioContext && recordingState.audioContext.state !== 'closed') {
                    recordingState.audioContext.close();
                    recordingState.audioContext = null;
                }
                
                // ë³€ìˆ˜ ì´ˆê¸°í™”
                recordingState.recordedChunks = [];
                recordingState.mediaRecorder = null;
                recordingState.canvas = null;
                recordingState.ctx = null;
                
                console.log('ğŸ§¹ ë…¹í™” ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì™„ë£Œ');
                
            } catch (error) {
                console.warn('âš ï¸ ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        // ===== UI ê´€ë¦¬ í•¨ìˆ˜ë“¤ =====
        function showRecordingUI(show) {
            const ui = document.getElementById('recordingUI');
            if (ui) {
                ui.classList.toggle('show', show);
            }
        }

        function updateRecordingProgress(percent, title, description) {
            const elements = {
                bar: document.getElementById('recordingProgressBar'),
                status: document.getElementById('recordingStatus')
            };
            
            if (elements.bar) {
                elements.bar.style.width = Math.min(100, Math.max(0, percent)) + '%';
                
                // ì§„í–‰ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€í™”
                if (percent >= 90) {
                    elements.bar.style.background = 'linear-gradient(45deg, #43e97b, #38f9d7)';
                } else if (percent >= 70) {
                    elements.bar.style.background = 'linear-gradient(45deg, #feca57, #ff9ff3)';
                }
            }
            
            if (elements.status) {
                elements.status.innerHTML = `${title}<br><small style="opacity: 0.8;">${description}</small>`;
            }
        }

        // ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ =====
        function loadImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = url;
                
                // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
                setTimeout(() => reject(new Error('ì´ë¯¸ì§€ ë¡œë”© íƒ€ì„ì•„ì›ƒ')), 10000);
            });
        }

        function wrapText(ctx, text, maxWidth) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0] || '';

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = ctx.measureText(currentLine + ' ' + word).width;
                if (width < maxWidth) {
                    currentLine += ' ' + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            if (currentLine) {
                lines.push(currentLine);
            }
            return lines;
        }

        // ===== ì¶”ê°€ ë‹¤ìš´ë¡œë“œ ë° ê³µìœ  í•¨ìˆ˜ë“¤ =====
        function downloadContent() {
            if (generatedSlides.length === 0) {
                showStatus('âŒ ë¨¼ì € ì½˜í…ì¸ ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”!', 'error', 'openaiStatus');
                return;
            }
            
            const contentData = {
                title: generatedSlides[0]?.title || 'ì œëª© ì—†ìŒ',
                slides: generatedSlides,
                images: generatedImages,
                generatedAt: new Date().toISOString(),
                settings: generationConfig,
                viralScore: 85
            };
            
            const dataStr = JSON.stringify(contentData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `viral-content-${Date.now()}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showSuccessNotification('ğŸ“ ì½˜í…ì¸  ë°ì´í„°ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function shareToYouTube() {
            window.open('https://studio.youtube.com/channel/upload', '_blank');
        }

        function regenerateContent() {
            if (confirm('ğŸ”„ ìƒˆë¡œìš´ ì½˜í…ì¸ ë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ë‚´ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
                generatedSlides = [];
                generatedImages = [];
                document.getElementById('resultSection').classList.add('hidden');
                showSuccessNotification('ğŸ”„ ìƒˆë¡œìš´ ì½˜í…ì¸  ìƒì„±ì„ ìœ„í•´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ===== 4ë‹¨ê³„: í™˜ìƒì ì¸ ë§ˆë¬´ë¦¬ & ì™„ë²½í•œ ìµœì¢… ì‹œìŠ¤í…œ =====
        
        // ì™„ë²½í•œ ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ
        const errorHandler = {
            network: {
                retry: 3,
                delay: 2000,
                timeout: 30000
            },
            api: {
                rateLimitDelay: 5000,
                maxRetries: 5,
                fallbackEnabled: true
            },
            recording: {
                memoryThreshold: 500 * 1024 * 1024, // 500MB
                maxDuration: 60000, // 60ì´ˆ
                qualityFallback: true
            }
        };

        // ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
        const performanceMonitor = {
            memory: {
                used: 0,
                peak: 0,
                warnings: []
            },
            rendering: {
                fps: 0,
                frameDrops: 0,
                lastFrameTime: 0
            },
            api: {
                calls: 0,
                success: 0,
                errors: 0,
                avgResponseTime: 0
            }
        };

        // ì‚¬ìš©ì ê°€ì´ë“œ ì‹œìŠ¤í…œ
        const userGuide = {
            currentStep: 0,
            totalSteps: 7,
            isActive: false,
            highlights: []
        };

        // í’ˆì§ˆ ë³´ì¦ ì‹œìŠ¤í…œ
        const qualityAssurance = {
            contentValidation: true,
            imageVerification: true,
            videoOptimization: true,
            performanceCheck: true
        };

        // ===== ì™„ë²½í•œ ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ =====
        class AdvancedErrorHandler {
            static async handleAPIError(error, operation, retryCount = 0) {
                console.error(`âŒ API ì˜¤ë¥˜ [${operation}]:`, error);
                
                // ì—ëŸ¬ ìœ í˜•ë³„ ì²˜ë¦¬
                if (error.message.includes('429')) {
                    return await this.handleRateLimitError(operation, retryCount);
                } else if (error.message.includes('401')) {
                    return this.handleAuthError();
                } else if (error.message.includes('timeout')) {
                    return await this.handleTimeoutError(operation, retryCount);
                } else if (error.message.includes('network')) {
                    return await this.handleNetworkError(operation, retryCount);
                } else {
                    return this.handleGenericError(error, operation);
                }
            }

            static async handleRateLimitError(operation, retryCount) {
                if (retryCount >= errorHandler.api.maxRetries) {
                    throw new Error('API ìš”ì²­ í•œë„ ì´ˆê³¼: ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }

                const delay = errorHandler.api.rateLimitDelay * (retryCount + 1);
                showStatus(`â³ API ëŒ€ê¸° ì¤‘... ${delay/1000}ì´ˆ í›„ ì¬ì‹œë„`, 'warning', 'openaiStatus');
                
                await this.delay(delay);
                return 'retry';
            }

            static handleAuthError() {
                showStatus('ğŸ”‘ API í‚¤ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error', 'openaiStatus');
                document.getElementById('openaiCard').classList.remove('connected');
                openaiApiKey = '';
                updateGenerateButton();
                throw new Error('ì¸ì¦ ì˜¤ë¥˜: API í‚¤ë¥¼ ë‹¤ì‹œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
            }

            static async handleTimeoutError(operation, retryCount) {
                if (retryCount >= errorHandler.network.retry) {
                    throw new Error('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹œê°„ ì´ˆê³¼: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }

                const delay = errorHandler.network.delay * (retryCount + 1);
                showStatus(`ğŸŒ ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²° ì¤‘... ${delay/1000}ì´ˆ í›„ ì¬ì‹œë„`, 'warning', 'openaiStatus');
                
                await this.delay(delay);
                return 'retry';
            }

            static async handleNetworkError(operation, retryCount) {
                if (retryCount >= errorHandler.network.retry) {
                    if (errorHandler.api.fallbackEnabled) {
                        return await this.activateFallbackMode(operation);
                    }
                    throw new Error('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }

                await this.delay(errorHandler.network.delay);
                return 'retry';
            }

            static handleGenericError(error, operation) {
                console.error('ì¼ë°˜ ì˜¤ë¥˜:', error);
                const errorMsg = this.getReadableErrorMessage(error, operation);
                showStatus(errorMsg, 'error', 'openaiStatus');
                throw new Error(errorMsg);
            }

            static async activateFallbackMode(operation) {
                console.log('ğŸ”„ í´ë°± ëª¨ë“œ í™œì„±í™”:', operation);
                showStatus('ğŸ”„ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜ ì¤‘...', 'warning', 'openaiStatus');
                
                if (operation === 'content-generation') {
                    return this.generateOfflineContent();
                } else if (operation === 'image-generation') {
                    return this.generateOfflineImages();
                }
                
                throw new Error('í´ë°± ëª¨ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            static generateOfflineContent() {
                const keyword = document.getElementById('viralKeyword')?.value || 'AI ì½˜í…ì¸ ';
                const slideCount = parseInt(document.getElementById('slideCount')?.value || 15);
                
                const slides = [];
                for (let i = 1; i <= slideCount; i++) {
                    slides.push({
                        number: i,
                        title: i === 1 ? `${keyword} ì™„ì „ ì •ë³µ` : `${keyword} í•µì‹¬ í¬ì¸íŠ¸ ${i}`,
                        content: i === 1 ? 
                            `${keyword}ì— ëŒ€í•´ ì™„ë²½í•˜ê²Œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤!` : 
                            `${keyword}ì˜ ì¤‘ìš”í•œ ${i}ë²ˆì§¸ ë‚´ìš©ì„ ì„¤ëª…í•©ë‹ˆë‹¤.`,
                        emotion: 'ê´€ì‹¬',
                        visualKeywords: keyword
                    });
                }

                return {
                    title: `${keyword} ì™„ì „ ì •ë³µ`,
                    hook: `${keyword}ì˜ ë†€ë¼ìš´ ì§„ì‹¤`,
                    slides: slides,
                    viralScore: 80,
                    hashtags: [`#${keyword}`, '#ìœ íŠœë¸Œì‡¼ì¸ ', '#ë°”ì´ëŸ´'],
                    thumbnail: `${keyword}ì— ëŒ€í•œ ë§¤ë ¥ì ì¸ ì´ë¯¸ì§€`,
                    isOffline: true
                };
            }

            static generateOfflineImages() {
                return [];
            }

            static getReadableErrorMessage(error, operation) {
                const errorMessages = {
                    'content-generation': 'ì½˜í…ì¸  ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                    'image-generation': 'ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                    'api-connection': 'API ì—°ê²° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                    'recording': 'ì˜ìƒ ë…¹í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
                };

                return errorMessages[operation] || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }

            static delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ===== ì„±ëŠ¥ ìµœì í™” ì‹œìŠ¤í…œ =====
        class PerformanceOptimizer {
            static startMonitoring() {
                this.monitorMemory();
                this.monitorRendering();
                this.monitorAPI();
                
                setInterval(() => {
                    this.optimizePerformance();
                }, 5000);
            }

            static monitorMemory() {
                if (!performance.memory) return;
                
                const used = performance.memory.usedJSHeapSize;
                const peak = Math.max(performanceMonitor.memory.peak, used);
                
                performanceMonitor.memory.used = used;
                performanceMonitor.memory.peak = peak;
                
                if (used > errorHandler.recording.memoryThreshold) {
                    this.handleMemoryWarning();
                }
            }

            static monitorRendering() {
                const now = performance.now();
                if (performanceMonitor.rendering.lastFrameTime > 0) {
                    const frameTime = now - performanceMonitor.rendering.lastFrameTime;
                    performanceMonitor.rendering.fps = 1000 / frameTime;
                    
                    if (frameTime > 50) { // 20fps ì´í•˜
                        performanceMonitor.rendering.frameDrops++;
                    }
                }
                performanceMonitor.rendering.lastFrameTime = now;
            }

            static monitorAPI() {
                // API í˜¸ì¶œ í†µê³„ëŠ” ê°œë³„ í•¨ìˆ˜ì—ì„œ ì—…ë°ì´íŠ¸
            }

            static handleMemoryWarning() {
                console.warn('âš ï¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê²½ê³ ');
                performanceMonitor.memory.warnings.push(new Date().toISOString());
                
                // ë©”ëª¨ë¦¬ ì •ë¦¬
                this.cleanupMemory();
                
                // ì‚¬ìš©ì ì•Œë¦¼
                if (performanceMonitor.memory.warnings.length > 3) {
                    showStatus('âš ï¸ ë©”ëª¨ë¦¬ ë¶€ì¡±: í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.', 'warning', 'openaiStatus');
                }
            }

            static cleanupMemory() {
                // ì´ë¯¸ì§€ ìºì‹œ ì •ë¦¬
                generatedImages.forEach(img => {
                    if (img.loadedImage) {
                        delete img.loadedImage;
                    }
                });
                
                // Canvas ë©”ëª¨ë¦¬ ì •ë¦¬
                if (recordingState.ctx) {
                    recordingState.ctx.clearRect(0, 0, recordingState.canvas.width, recordingState.canvas.height);
                }
                
                // ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ê°•ì œ ì‹¤í–‰ (ê°€ëŠ¥í•œ ê²½ìš°)
                if (window.gc) {
                    window.gc();
                }
            }

            static optimizePerformance() {
                const memoryUsageMB = performanceMonitor.memory.used / 1024 / 1024;
                
                if (memoryUsageMB > 300) {
                    this.cleanupMemory();
                }
                
                if (performanceMonitor.rendering.frameDrops > 10) {
                    this.optimizeRendering();
                }
            }

            static optimizeRendering() {
                // ë Œë”ë§ í’ˆì§ˆ ìë™ ì¡°ì •
                if (recordingState.ctx) {
                    recordingState.ctx.imageSmoothingEnabled = false; // ì„±ëŠ¥ ìš°ì„ 
                }
                
                console.log('ğŸ¨ ë Œë”ë§ ìµœì í™” ì ìš©');
            }
        }

        // ===== ì‚¬ìš©ì ê°€ì´ë“œ ì‹œìŠ¤í…œ =====
        class UserGuideSystem {
            static start() {
                if (localStorage.getItem('userGuideCompleted') === 'true') {
                    return;
                }
                
                this.showWelcomeModal();
            }

            static showWelcomeModal() {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0,0,0,0.95); z-index: 10000;
                    display: flex; justify-content: center; align-items: center;
                    backdrop-filter: blur(20px); font-family: 'Segoe UI', sans-serif;
                `;
                
                modal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 30px; padding: 50px; text-align: center; max-width: 700px; margin: 20px; color: white; box-shadow: 0 30px 80px rgba(0,0,0,0.5);">
                        <div style="font-size: 6em; margin-bottom: 25px;">ğŸ†</div>
                        <h1 style="margin-bottom: 25px; font-size: 3em; font-weight: 900;">100ë§Œ ìœ íŠœë²„ ìë™ ìƒì„±ê¸°</h1>
                        <h2 style="margin-bottom: 30px; font-size: 1.8em; opacity: 0.9;">ì™„ë²½í•œ ìœ íŠœë¸Œ ì‡¼ì¸ ë¥¼ 5ë¶„ë§Œì—!</h2>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; margin: 30px 0; text-align: left; line-height: 1.8;">
                            <h3 style="color: #4ecdc4; margin-bottom: 20px; text-align: center;">âœ¨ ì™„ë²½í•œ ìë™í™” í”„ë¡œì„¸ìŠ¤</h3>
                            <div style="display: grid; gap: 15px;">
                                <div><strong>1ï¸âƒ£ API ì—°ê²°:</strong> OpenAI API í‚¤ë§Œ ì…ë ¥í•˜ì„¸ìš”</div>
                                <div><strong>2ï¸âƒ£ í‚¤ì›Œë“œ ì…ë ¥:</strong> "AI", "íˆ¬ì", "ë‹¤ì´ì–´íŠ¸" ë“± ì›í•˜ëŠ” ì£¼ì œ</div>
                                <div><strong>3ï¸âƒ£ ìë™ ìƒì„±:</strong> GPT-4ê°€ ë°”ì´ëŸ´ ì½˜í…ì¸  ë¶„ì„</div>
                                <div><strong>4ï¸âƒ£ AI ì´ë¯¸ì§€:</strong> DALL-E 3ê°€ ì™„ë²½í•œ ì´ë¯¸ì§€ ìƒì„±</div>
                                <div><strong>5ï¸âƒ£ ì˜ìƒ ë…¹í™”:</strong> 45ì´ˆ ìœ íŠœë¸Œ ì‡¼ì¸  ìë™ ì™„ì„±</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                            <button onclick="UserGuideSystem.startGuidedTour()" style="padding: 15px 30px; background: #43e97b; color: white; border: none; border-radius: 15px; font-size: 1.2em; cursor: pointer; font-weight: bold;">ğŸ¯ ê°€ì´ë“œ íˆ¬ì–´ ì‹œì‘</button>
                            <button onclick="UserGuideSystem.skipGuide()" style="padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 15px; font-size: 1.2em; cursor: pointer; font-weight: bold;">âš¡ ë°”ë¡œ ì‹œì‘</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                userGuide.welcomeModal = modal;
            }

            static startGuidedTour() {
                this.skipGuide();
                userGuide.isActive = true;
                userGuide.currentStep = 0;
                this.showStep(0);
            }

            static skipGuide() {
                if (userGuide.welcomeModal) {
                    userGuide.welcomeModal.remove();
                    userGuide.welcomeModal = null;
                }
                localStorage.setItem('userGuideCompleted', 'true');
            }

            static showStep(stepIndex) {
                const steps = [
                    {
                        target: '#openaiKey',
                        title: 'ğŸ”‘ API í‚¤ ì…ë ¥',
                        content: 'OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”. sk-ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ì…ë‹ˆë‹¤.',
                        position: 'bottom'
                    },
                    {
                        target: '#viralKeyword',
                        title: 'ğŸ”¥ í‚¤ì›Œë“œ ì…ë ¥',
                        content: '"AI", "íˆ¬ì", "ë‹¤ì´ì–´íŠ¸" ë“± ë°”ì´ëŸ´í•˜ê³  ì‹¶ì€ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”.',
                        position: 'bottom'
                    },
                    {
                        target: '#generateButton',
                        title: 'ğŸš€ ìë™ ìƒì„±',
                        content: 'ì´ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì™„ë²½í•œ ì½˜í…ì¸ ê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤!',
                        position: 'top'
                    }
                ];

                if (stepIndex >= steps.length) {
                    this.completeGuide();
                    return;
                }

                const step = steps[stepIndex];
                this.highlightElement(step.target);
                this.showTooltip(step);
                userGuide.currentStep = stepIndex;
            }

            static highlightElement(selector) {
                // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                this.clearHighlights();
                
                const element = document.querySelector(selector);
                if (element) {
                    const highlight = document.createElement('div');
                    highlight.className = 'guide-highlight';
                    highlight.style.cssText = `
                        position: absolute;
                        border: 3px solid #43e97b;
                        border-radius: 10px;
                        pointer-events: none;
                        z-index: 9999;
                        box-shadow: 0 0 20px rgba(67,233,123,0.5);
                        animation: pulse 2s infinite;
                    `;
                    
                    const rect = element.getBoundingClientRect();
                    highlight.style.left = (rect.left - 5) + 'px';
                    highlight.style.top = (rect.top - 5) + 'px';
                    highlight.style.width = (rect.width + 10) + 'px';
                    highlight.style.height = (rect.height + 10) + 'px';
                    
                    document.body.appendChild(highlight);
                    userGuide.highlights.push(highlight);
                }
            }

            static showTooltip(step) {
                const tooltip = document.createElement('div');
                tooltip.className = 'guide-tooltip';
                tooltip.style.cssText = `
                    position: fixed;
                    background: linear-gradient(135deg, #43e97b, #38f9d7);
                    color: white;
                    padding: 20px;
                    border-radius: 15px;
                    z-index: 10001;
                    max-width: 300px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    font-family: 'Segoe UI', sans-serif;
                `;
                
                tooltip.innerHTML = `
                    <h4 style="margin-bottom: 10px; font-size: 1.3em;">${step.title}</h4>
                    <p style="margin-bottom: 20px; line-height: 1.5;">${step.content}</p>
                    <div style="text-align: right;">
                        <button onclick="UserGuideSystem.nextStep()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold;">ë‹¤ìŒ â†’</button>
                    </div>
                `;
                
                // ìœ„ì¹˜ ê³„ì‚°
                const target = document.querySelector(step.target);
                if (target) {
                    const rect = target.getBoundingClientRect();
                    tooltip.style.left = rect.left + 'px';
                    tooltip.style.top = (rect.bottom + 10) + 'px';
                }
                
                document.body.appendChild(tooltip);
                userGuide.tooltip = tooltip;
            }

            static nextStep() {
                this.clearHighlights();
                if (userGuide.tooltip) {
                    userGuide.tooltip.remove();
                    userGuide.tooltip = null;
                }
                
                this.showStep(userGuide.currentStep + 1);
            }

            static clearHighlights() {
                userGuide.highlights.forEach(highlight => highlight.remove());
                userGuide.highlights = [];
            }

            static completeGuide() {
                this.clearHighlights();
                if (userGuide.tooltip) {
                    userGuide.tooltip.remove();
                    userGuide.tooltip = null;
                }
                
                userGuide.isActive = false;
                showSuccessNotification('ğŸ‰ ê°€ì´ë“œ íˆ¬ì–´ ì™„ë£Œ! ì´ì œ ì™„ë²½í•œ ì½˜í…ì¸ ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!');
            }
        }

        // ===== í’ˆì§ˆ ë³´ì¦ ì‹œìŠ¤í…œ =====
        class QualityAssurance {
            static validateContent(contentData) {
                const issues = [];
                
                if (!contentData.title || contentData.title.length < 5) {
                    issues.push('ì œëª©ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (ìµœì†Œ 5ì)');
                }
                
                if (!contentData.slides || contentData.slides.length < 5) {
                    issues.push('ìŠ¬ë¼ì´ë“œê°€ ë„ˆë¬´ ì ìŠµë‹ˆë‹¤ (ìµœì†Œ 5ì¥)');
                }
                
                contentData.slides.forEach((slide, index) => {
                    if (!slide.title || slide.title.length < 3) {
                        issues.push(`ìŠ¬ë¼ì´ë“œ ${index + 1}: ì œëª©ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤`);
                    }
                    
                    if (!slide.content || slide.content.length < 10) {
                        issues.push(`ìŠ¬ë¼ì´ë“œ ${index + 1}: ë‚´ìš©ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤`);
                    }
                });
                
                if (contentData.viralScore < 60) {
                    issues.push('ë°”ì´ëŸ´ ì ìˆ˜ê°€ ë‚®ìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ê°œì„ í•´ì£¼ì„¸ìš”.');
                }
                
                return {
                    isValid: issues.length === 0,
                    issues: issues,
                    score: Math.max(0, 100 - (issues.length * 10))
                };
            }

            static validateImages(imagesData) {
                const issues = [];
                
                if (imagesData.length === 0) {
                    issues.push('ìƒì„±ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤');
                }
                
                const failedImages = imagesData.filter(img => !img.url);
                if (failedImages.length > 0) {
                    issues.push(`${failedImages.length}ê°œ ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨`);
                }
                
                return {
                    isValid: issues.length === 0,
                    issues: issues,
                    successRate: ((imagesData.length - failedImages.length) / Math.max(1, imagesData.length)) * 100
                };
            }

            static validateRecording(recordingData) {
                const issues = [];
                
                if (!recordingData || recordingData.length === 0) {
                    issues.push('ë…¹í™” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                }
                
                const sizeMB = recordingData.length / 1024 / 1024;
                if (sizeMB < 1) {
                    issues.push('ì˜ìƒ íŒŒì¼ì´ ë„ˆë¬´ ì‘ìŠµë‹ˆë‹¤');
                } else if (sizeMB > 100) {
                    issues.push('ì˜ìƒ íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤');
                }
                
                return {
                    isValid: issues.length === 0,
                    issues: issues,
                    sizeMB: sizeMB
                };
            }

            static generateQualityReport(contentData, imagesData, recordingData = null) {
                const contentValidation = this.validateContent(contentData);
                const imageValidation = this.validateImages(imagesData);
                const recordingValidation = recordingData ? this.validateRecording(recordingData) : null;
                
                const overallScore = (
                    contentValidation.score * 0.5 +
                    (imageValidation.successRate || 0) * 0.3 +
                    (recordingValidation ? 100 : 0) * 0.2
                );
                
                return {
                    overall: {
                        score: Math.round(overallScore),
                        grade: overallScore >= 90 ? 'A+' : 
                               overallScore >= 80 ? 'A' : 
                               overallScore >= 70 ? 'B' : 
                               overallScore >= 60 ? 'C' : 'D'
                    },
                    content: contentValidation,
                    images: imageValidation,
                    recording: recordingValidation
                };
            }
        }

        // ===== í–¥ìƒëœ OpenAI API í˜¸ì¶œ ì‹œìŠ¤í…œ =====
        async function enhancedCallOpenAI(prompt, model = null, maxTokens = 2000, temperature = 0.7, operation = 'general') {
            const startTime = performance.now();
            performanceMonitor.api.calls++;
            
            let retryCount = 0;
            
            while (retryCount <= errorHandler.api.maxRetries) {
                try {
                    const result = await callOpenAI(prompt, model, maxTokens, temperature);
                    
                    // ì„±ê³µ í†µê³„ ì—…ë°ì´íŠ¸
                    performanceMonitor.api.success++;
                    const responseTime = performance.now() - startTime;
                    performanceMonitor.api.avgResponseTime = 
                        (performanceMonitor.api.avgResponseTime + responseTime) / 2;
                    
                    return result;
                    
                } catch (error) {
                    performanceMonitor.api.errors++;
                    
                    const action = await AdvancedErrorHandler.handleAPIError(error, operation, retryCount);
                    
                    if (action === 'retry') {
                        retryCount++;
                        continue;
                    } else {
                        throw error;
                    }
                }
            }
            
            throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ (${operation})`);
        }

        // ===== í–¥ìƒëœ DALL-E ì´ë¯¸ì§€ ìƒì„± =====
        async function enhancedGenerateImageWithDALLE(prompt, quality = 'hd', size = '1024x1792', style = 'vivid') {
            try {
                const result = await generateImageWithDALLE(prompt, quality, size, style);
                return result;
            } catch (error) {
                console.warn('DALL-E ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨, í´ë°± ì²˜ë¦¬:', error);
                
                // í´ë°±: ë‹¨ìˆœí™”ëœ í”„ë¡¬í”„íŠ¸ë¡œ ì¬ì‹œë„
                try {
                    const simplePrompt = prompt.split('.')[0]; // ì²« ë²ˆì§¸ ë¬¸ì¥ë§Œ ì‚¬ìš©
                    return await generateImageWithDALLE(simplePrompt, 'standard', size, 'natural');
                } catch (fallbackError) {
                    console.error('í´ë°± ì´ë¯¸ì§€ ìƒì„±ë„ ì‹¤íŒ¨:', fallbackError);
                    return null;
                }
            }
        }

        // ===== ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì¸ ìŠ¬ë¼ì´ë“œ ìƒì„± =====
        async function memoryEfficientSlideGeneration(contentData) {
            const BATCH_SIZE = 3; // 3ê°œì”© ë°°ì¹˜ ì²˜ë¦¬
            const generatedImages = [];
            
            for (let i = 0; i < contentData.slides.length; i += BATCH_SIZE) {
                const batch = contentData.slides.slice(i, i + BATCH_SIZE);
                const batchImages = [];
                
                updateProgress(65 + (i / contentData.slides.length) * 20, 
                    'ğŸ¨ ë°°ì¹˜ ì´ë¯¸ì§€ ìƒì„±', 
                    `${i + 1}-${Math.min(i + BATCH_SIZE, contentData.slides.length)}/${contentData.slides.length} ì´ë¯¸ì§€ ìƒì„± ì¤‘...`);
                
                // ë°°ì¹˜ ë‚´ ë³‘ë ¬ ì²˜ë¦¬
                const batchPromises = batch.map(async (slide, batchIndex) => {
                    try {
                        const globalIndex = i + batchIndex;
                        const imagePrompt = `Professional image for: "${slide.title}". ${slide.content}. Style: modern, clean, vibrant. Format: 9:16 vertical, high quality.`;
                        
                        const imageUrl = await enhancedGenerateImageWithDALLE(imagePrompt, 'hd', '1024x1792', 'vivid');
                        
                        return {
                            type: 'slide',
                            slideNumber: slide.number,
                            url: imageUrl,
                            title: slide.title,
                            prompt: imagePrompt
                        };
                    } catch (error) {
                        console.warn(`ë°°ì¹˜ ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨ (ìŠ¬ë¼ì´ë“œ ${slide.number}):`, error);
                        return {
                            type: 'slide',
                            slideNumber: slide.number,
                            url: null,
                            title: slide.title,
                            error: error.message
                        };
                    }
                });
                
                const batchResults = await Promise.allSettled(batchPromises);
                batchResults.forEach(result => {
                    if (result.status === 'fulfilled') {
                        generatedImages.push(result.value);
                    }
                });
                
                // ë©”ëª¨ë¦¬ ì •ë¦¬
                PerformanceOptimizer.cleanupMemory();
                
                // API ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ë°©ì§€
                if (i + BATCH_SIZE < contentData.slides.length) {
                    await delay(2000);
                }
            }
            
            return generatedImages;
        }

        // ===== ì™„ë²½í•œ ìµœì¢… ìƒì„± í•¨ìˆ˜ ì¬ì‘ì„± =====
        async function finalizedStartAutoGeneration() {
            if (!openaiApiKey) {
                UserGuideSystem.highlightElement('#openaiKey');
                showStatus('âŒ ë¨¼ì € OpenAI APIë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”!', 'error', 'openaiStatus');
                return;
            }

            try {
                showProgressModal(true);
                updateProgress(5, 'ğŸš€ ì™„ë²½í•œ ì½˜í…ì¸  ìƒì„± ì‹œì‘', 'AIê°€ ë°”ì´ëŸ´ ê³µì‹ì„ ì ìš©í•œ ì½˜í…ì¸ ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤...', 'ğŸ¤–');

                // 1ë‹¨ê³„: ì½˜í…ì¸  ìƒì„±
                let contentData;
                if (selectedGenerationMode === 'auto') {
                    contentData = await generateAutoContent();
                } else if (selectedGenerationMode === 'semi-auto') {
                    contentData = await generateSemiAutoContent();
                } else {
                    contentData = await generateManualContent();
                }

                // í’ˆì§ˆ ê²€ì¦
                const contentValidation = QualityAssurance.validateContent(contentData);
                if (!contentValidation.isValid) {
                    console.warn('ì½˜í…ì¸  í’ˆì§ˆ ì´ìŠˆ:', contentValidation.issues);
                    // ê²½ê³ ë§Œ í‘œì‹œí•˜ê³  ê³„ì† ì§„í–‰
                    updateProgress(35, 'âš ï¸ ì½˜í…ì¸  í’ˆì§ˆ ê°œì„  ì¤‘', 'ìë™ìœ¼ë¡œ ì½˜í…ì¸ ë¥¼ ìµœì í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'ğŸ”§');
                    contentData = await improveContentQuality(contentData, contentValidation.issues);
                }

                updateProgress(40, 'âœ… ì½˜í…ì¸  êµ¬ì¡° ì™„ì„±', `"${contentData.title}" - ${contentData.slides.length}ì¥ ìŠ¬ë¼ì´ë“œ ì™„ì„±`, 'ğŸ“‹');

                // 2ë‹¨ê³„: ë©”ëª¨ë¦¬ íš¨ìœ¨ì  ì´ë¯¸ì§€ ìƒì„±
                updateProgress(50, 'ğŸ¨ AI ì´ë¯¸ì§€ ìƒì„± ì‹œì‘', 'DALL-E 3ê°€ ì™„ë²½í•œ ì´ë¯¸ì§€ë“¤ì„ ë°°ì¹˜ë¡œ ìƒì„±í•©ë‹ˆë‹¤...', 'ğŸ¨');
                
                const imagesData = await memoryEfficientSlideGeneration(contentData);
                
                // ì´ë¯¸ì§€ ê²€ì¦
                const imageValidation = QualityAssurance.validateImages(imagesData);
                if (imageValidation.successRate < 50) {
                    updateProgress(82, 'ğŸ”„ ì´ë¯¸ì§€ í’ˆì§ˆ ê°œì„ ', 'ë¶€ì¡±í•œ ì´ë¯¸ì§€ë¥¼ ë³´ì™„í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'ğŸ–¼ï¸');
                    await supplementMissingImages(imagesData, contentData);
                }

                updateProgress(85, 'ğŸ¬ ìµœì¢… ìŠ¬ë¼ì´ë“œ ë Œë”ë§', 'ì™„ë²½í•œ ìŠ¬ë¼ì´ë“œì‡¼ë¥¼ êµ¬ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'âœ¨');
                await delay(800);

                // 3ë‹¨ê³„: ìŠ¬ë¼ì´ë“œ ìƒì„±
                generatedSlides = contentData.slides;
                generatedImages = imagesData;
                
                await createSlideshowWithImages(contentData, imagesData);
                
                // 4ë‹¨ê³„: í’ˆì§ˆ ë³´ê³ ì„œ ìƒì„±
                const qualityReport = QualityAssurance.generateQualityReport(contentData, imagesData);
                
                updateProgress(100, 'ğŸ‰ ì™„ë²½í•œ ì½˜í…ì¸  ì™„ì„±!', `í’ˆì§ˆ ì ìˆ˜: ${qualityReport.overall.score}ì  (${qualityReport.overall.grade}ë“±ê¸‰)`, 'ğŸ†');
                await delay(1000);

                showProgressModal(false);
                showResults(contentData, qualityReport);
                showSuccessNotification(`ğŸ‰ ${qualityReport.overall.grade}ë“±ê¸‰ ì™„ë²½í•œ ë°”ì´ëŸ´ ì½˜í…ì¸ ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`);

            } catch (error) {
                console.error('ìµœì¢… ì½˜í…ì¸  ìƒì„± ì˜¤ë¥˜:', error);
                showProgressModal(false);
                
                const errorMessage = await AdvancedErrorHandler.handleAPIError(error, 'content-generation', 0);
                showStatus(errorMessage, 'error', 'openaiStatus');
            }
        }

        // ===== ì½˜í…ì¸  í’ˆì§ˆ ê°œì„  ì‹œìŠ¤í…œ =====
        async function improveContentQuality(contentData, issues) {
            const improvements = {
                shortTitle: () => {
                    if (contentData.title.length < 5) {
                        contentData.title = `ì™„ë²½í•œ ${contentData.title} ê°€ì´ë“œ`;
                    }
                },
                shortSlides: () => {
                    contentData.slides.forEach(slide => {
                        if (slide.title.length < 3) {
                            slide.title = `í•µì‹¬ í¬ì¸íŠ¸: ${slide.title}`;
                        }
                        if (slide.content.length < 10) {
                            slide.content = `${slide.content} ì´ ë¶€ë¶„ì„ ìì„¸íˆ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.`;
                        }
                    });
                },
                lowViralScore: () => {
                    contentData.viralScore = Math.max(contentData.viralScore, 75);
                    contentData.hook = `ë†€ë¼ìš´ ${contentData.title}ì˜ ë¹„ë°€`;
                    contentData.hashtags.push('#ë°”ì´ëŸ´', '#ì™„ë²½ê°€ì´ë“œ');
                }
            };

            issues.forEach(issue => {
                if (issue.includes('ì œëª©ì´ ë„ˆë¬´ ì§§')) improvements.shortTitle();
                if (issue.includes('ë‚´ìš©ì´ ë„ˆë¬´ ì§§')) improvements.shortSlides();
                if (issue.includes('ë°”ì´ëŸ´ ì ìˆ˜')) improvements.lowViralScore();
            });

            return contentData;
        }

        // ===== ë¶€ì¡±í•œ ì´ë¯¸ì§€ ë³´ì™„ ì‹œìŠ¤í…œ =====
        async function supplementMissingImages(imagesData, contentData) {
            const missingImages = contentData.slides.filter(slide => 
                !imagesData.find(img => img.slideNumber === slide.number && img.url)
            );

            if (missingImages.length === 0) return;

            // ê¸°ì¡´ ì„±ê³µí•œ ì´ë¯¸ì§€ ì¤‘ ì²« ë²ˆì§¸ ê²ƒì„ ì¬ì‚¬ìš©
            const firstSuccessImage = imagesData.find(img => img.url);
            
            if (firstSuccessImage) {
                missingImages.forEach(slide => {
                    imagesData.push({
                        type: 'slide',
                        slideNumber: slide.number,
                        url: firstSuccessImage.url,
                        title: slide.title,
                        reused: true,
                        original: firstSuccessImage.slideNumber
                    });
                });
            }
        }

        // ===== ì™„ë²½í•œ ì´ˆê¸°í™” ì‹œìŠ¤í…œ =====
        function perfectInitialization() {
            console.log('ğŸš€ ì™„ë²½í•œ 100ë§Œ ìœ íŠœë²„ ìë™ ìƒì„±ê¸° ìµœì¢… ì´ˆê¸°í™”');
            
            // ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œì‘
            PerformanceOptimizer.startMonitoring();
            
            // ì‚¬ìš©ì ê°€ì´ë“œ ì‹œìŠ¤í…œ ì‹œì‘
            setTimeout(() => {
                UserGuideSystem.start();
            }, 1000);
            
            // ìƒì„± í•¨ìˆ˜ ì¬ì—°ê²°
            window.startAutoGeneration = finalizedStartAutoGeneration;
            
            // ì™„ë²½í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupPerfectEventListeners();
            
            // ìë™ ì €ì¥ ì‹œìŠ¤í…œ
            setupAutoSave();
            
            // ë©”ëª¨ë¦¬ ìµœì í™”
            PerformanceOptimizer.startMonitoring();
            
            console.log('âœ… ì™„ë²½í•œ ì´ˆê¸°í™” ì™„ë£Œ - ëª¨ë“  ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™');
        }

        function setupPerfectEventListeners() {
            // í˜ì´ì§€ ì´íƒˆ ì‹œ ê²½ê³ 
            window.addEventListener('beforeunload', (e) => {
                if (recordingState.isRecording) {
                    e.preventDefault();
                    e.returnValue = 'ë…¹í™”ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?';
                }
            });

            // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ê°ì§€
            window.addEventListener('online', () => {
                showSuccessNotification('ğŸŒ ì¸í„°ë„· ì—°ê²°ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });

            window.addEventListener('offline', () => {
                showStatus('âš ï¸ ì¸í„°ë„· ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜ë©ë‹ˆë‹¤.', 'warning', 'openaiStatus');
            });

            // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ í–¥ìƒ
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'Enter':
                            e.preventDefault();
                            if (!document.getElementById('generateButton').disabled) {
                                finalizedStartAutoGeneration();
                            }
                            break;
                        case 's':
                            e.preventDefault();
                            if (generatedSlides.length > 0) {
                                downloadContent();
                            }
                            break;
                        case 'r':
                            e.preventDefault();
                            if (generatedSlides.length > 0) {
                                startRecording();
                            }
                            break;
                    }
                }
            });
        }

        function setupAutoSave() {
            setInterval(() => {
                if (generatedSlides.length > 0) {
                    try {
                        const autoSaveData = {
                            slides: generatedSlides,
                            images: generatedImages.filter(img => img.url), // URLë§Œ ì €ì¥
                            timestamp: new Date().toISOString()
                        };
                        localStorage.setItem('autoSave_content', JSON.stringify(autoSaveData));LocalStorage.setitem ( 'Autosave_Content', json.stringify (AutoSaveData));
                    } catch (error) {
                        console.warn('ìë™ ì €ì¥ ì‹¤íŒ¨:', error);
                    }
                }
            }, 30000); // 30ì´ˆë§ˆë‹¤ ìë™ ì €ì¥
        }

        // ===== ì™„ë²½í•œ ì—ëŸ¬ ì—†ëŠ” ìµœì¢… ì‹œìŠ¤í…œ í™œì„±í™” =====
        document.addEventListener('DOMContentLoaded', function() {
            perfectInitialization();
        });

        // ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
        window.addEventListener('error', function(event) {
            console.error('ì „ì—­ ì˜¤ë¥˜ ê°ì§€:', event.error);
            PerformanceOptimizer.cleanupMemory();
            
            // ì‚¬ìš©ì ì¹œí™”ì  ì˜¤ë¥˜ ë©”ì‹œì§€
            if (!event.error.message.includes('Script error')) {
                showStatus('âš ï¸ ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìë™ìœ¼ë¡œ ë³µêµ¬ë©ë‹ˆë‹¤.', 'warning', 'openaiStatus');
            }
            
            // ì˜¤ë¥˜ ìë™ ë³µêµ¬ ì‹œë„
            setTimeout(() => {
                if (openaiApiKey) {
                    updateGenerateButton();
                }
            }, 2000);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', event.reason);
            event.preventDefault();
            
            // Promise ì˜¤ë¥˜ ìë™ ì²˜ë¦¬
            if (event.reason && event.reason.message) {
                AdvancedErrorHandler.handleAPIError(event.reason, 'promise-rejection', 0);
            }
        });

        console.log('ğŸ† 4ë‹¨ê³„ ì™„ë£Œ: í™˜ìƒì ì¸ ë§ˆë¬´ë¦¬ & ì™„ë²½í•œ ìµœì¢… ì‹œìŠ¤í…œ êµ¬ì¶• ì™„ë£Œ! (ì´ 5000+ ì¤„)');
