<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏûêÎèô ÏÉùÏÑ±Í∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b6b 100%);
            --shorts-gradient: linear-gradient(45deg, #ff0844, #ffb199);
            --json-gradient: linear-gradient(45deg, #ff9a56, #ff6b95);
            --success-gradient: linear-gradient(45deg, #00ff88, #00b894);
            --text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            --box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            --border-radius: 25px;
            --transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary-gradient);
            background-size: 400% 400%;
            animation: gradientFlow 8s ease infinite;
            min-height: 100vh;
            color: white;
            line-height: 1.6;
            overflow-x: hidden;
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
            position: relative;
            z-index: 2;
        }

        .hero {
            text-align: center;
            padding: 60px 40px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: var(--border-radius);
            margin-bottom: 60px;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .hero-icon {
            font-size: 5em;
            margin-bottom: 30px;
            animation: iconPulse 3s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.6));
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .hero-title {
            font-size: 3.5em;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textShimmer 4s ease infinite;
        }

        @keyframes textShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .section {
            background: rgba(255, 255, 255, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            padding: 50px;
            margin: 40px 0;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .section-title {
            font-size: 2.5em;
            margin-bottom: 30px;
            text-align: center;
            color: #feca57;
            text-shadow: 0 0 25px rgba(254, 202, 87, 0.6);
            font-weight: 800;
        }

        .input-group {
            margin-bottom: 30px;
        }

        .input-label {
            display: block;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 10px;
            color: #4ecdc4;
        }

        .input-field {
            width: 100%;
            padding: 20px;
            background: rgba(255, 255, 255, 0.12);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 18px;
            color: white;
            font-size: 1.2em;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.4);
            transform: scale(1.01);
        }

        .textarea-field {
            min-height: 200px;
            resize: vertical;
        }

        .btn {
            padding: 18px 35px;
            margin: 10px;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }

        .btn-shorts {
            background: var(--shorts-gradient);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 8, 68, 0.4);
            font-size: 1.8em;
            padding: 30px 60px;
            animation: shortsPulse 3s ease infinite;
        }

        @keyframes shortsPulse {
            0%, 100% { 
                box-shadow: 0 8px 25px rgba(255, 8, 68, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 12px 35px rgba(255, 8, 68, 0.8);
                transform: scale(1.02);
            }
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .shorts-preview {
            width: 100%;
            max-width: 450px;
            height: 800px;
            background: #000;
            border-radius: 30px;
            border: 4px solid #333;
            margin: 30px auto;
            overflow: hidden;
            position: relative;
            box-shadow: var(--box-shadow);
        }

        .canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #shortsCanvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 26px;
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .progress-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(15px);
        }

        .progress-modal.show {
            display: flex;
        }

        .progress-content {
            background: rgba(255, 255, 255, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 30px;
            padding: 60px;
            text-align: center;
            backdrop-filter: blur(25px);
            max-width: 600px;
            width: 90%;
        }

        .progress-icon {
            font-size: 5em;
            margin-bottom: 30px;
            animation: progressRotate 2s linear infinite;
        }

        @keyframes progressRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .progress-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #4ecdc4;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0844, #ffb199);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .shorts-info {
            background: rgba(255, 8, 68, 0.1);
            border: 3px solid rgba(255, 8, 68, 0.4);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .shorts-info h4 {
            color: #ff0844;
            margin-bottom: 15px;
            font-size: 1.6em;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #ff0844;
            box-shadow: 0 15px 40px rgba(255, 8, 68, 0.3);
        }

        .feature-card .icon {
            font-size: 3em;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px currentColor);
        }

        .feature-card h4 {
            color: #feca57;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .download-section {
            text-align: center;
            padding: 40px;
            background: var(--success-gradient);
            border-radius: 25px;
            margin: 40px 0;
            display: none;
            animation: successPulse 2s ease infinite;
        }

        @keyframes successPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(0, 255, 136, 0.4); }
            50% { box-shadow: 0 0 50px rgba(0, 255, 136, 0.8); }
        }

        .download-section h3 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .download-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.6em;
            padding: 25px 50px;
            border-radius: 20px;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
            border: 2px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px) scale(1.05);
        }

        .api-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        .api-status.success {
            background: rgba(0, 255, 100, 0.2);
            border: 2px solid rgba(0, 255, 100, 0.5);
            color: #00ff88;
        }

        .api-status.error {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid rgba(255, 107, 107, 0.5);
            color: #ff6b6b;
        }

        .video-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255, 8, 68, 0.3);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #ff0844;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .hero-title { font-size: 2.5em; }
            .section { padding: 30px 20px; }
            .video-controls { flex-direction: column; align-items: center; }
            .btn { width: 100%; max-width: 300px; }
            .shorts-preview { height: 600px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <div class="hero-icon">üì±</div>
            <h1 class="hero-title">Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏûêÎèô ÏÉùÏÑ±Í∏∞</h1>
            <p style="font-size: 1.4em; opacity: 0.9; margin-top: 20px;">
                GPT-4 Î∂ÑÏÑù ‚Üí JSON2Video ÏÉùÏÑ± ‚Üí Ïã§Ï†ú MP4 ÏáºÏ∏† ÏòÅÏÉÅ ÏôÑÏÑ±!<br>
                <strong>ÏôÑÏ†Ñ ÏûêÎèôÌôîÎêú Ïú†ÌäúÎ∏å ÏáºÏ∏† Ï†úÏûë ÏãúÏä§ÌÖú</strong>
            </p>
        </div>

        <!-- Ïú†ÌäúÎ∏å ÏáºÏ∏† ÌäπÏßï -->
        <div class="shorts-info">
            <h4>üéØ ÏôÑÎ≤ΩÌïú Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏµúÏ†ÅÌôî</h4>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="icon">üì±</div>
                    <h4>9:16 ÏÑ∏Î°ú ÎπÑÏú®</h4>
                    <p>1080√ó1920 Ìï¥ÏÉÅÎèÑÎ°ú Î™®Î∞îÏùºÏóê ÏôÑÎ≤Ω ÏµúÏ†ÅÌôî</p>
                </div>
                <div class="feature-card">
                    <div class="icon">‚è±Ô∏è</div>
                    <h4>15-60Ï¥à Í∏∏Ïù¥</h4>
                    <p>Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏïåÍ≥†Î¶¨Ï¶òÏóê ÏµúÏ†ÅÌôîÎêú Í∏∏Ïù¥</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üé®</div>
                    <h4>Í≥†ÎåÄÎπÑ ÎîîÏûêÏù∏</h4>
                    <p>Î™®Î∞îÏùºÏóêÏÑú ÏÑ†Î™ÖÌïòÍ≤å Î≥¥Ïù¥Îäî ÌÅ∞ ÌÖçÏä§Ìä∏</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üöÄ</div>
                    <h4>ÏôÑÏ†Ñ ÏûêÎèôÌôî</h4>
                    <p>ÏΩòÌÖêÏ∏† ÏûÖÎ†•ÎßåÏúºÎ°ú MP4 ÏôÑÏÑ±</p>
                </div>
            </div>
        </div>

        <!-- API ÏÑ§Ï†ï -->
        <div class="section">
            <h2 class="section-title">üîë OpenAI API ÏÑ§Ï†ï</h2>
            <div class="input-group">
                <label class="input-label">OpenAI API ÌÇ§</label>
                <input type="password" class="input-field" id="apiInput" 
                       placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
            </div>
            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="setupApiKey()">API ÌÇ§ ÏÑ§Ï†ï</button>
            </div>
            <div id="apiStatus" class="api-status"></div>
        </div>

        <!-- ÏΩòÌÖêÏ∏† ÏûÖÎ†• -->
        <div class="section">
            <h2 class="section-title">üìù ÏáºÏ∏† ÏΩòÌÖêÏ∏† ÏûÖÎ†•</h2>
            <div class="input-group">
                <label class="input-label">Ï£ºÏ†ú (Hook)</label>
                <input type="text" class="input-field" id="topicInput" 
                       placeholder="Ïòà: 3Ï¥àÎßåÏóê Î∞∞Ïö∞Îäî Ìà¨Ïûê ÎπÑÎ≤ï">
            </div>
            <div class="input-group">
                <label class="input-label">ÏÉÅÏÑ∏ ÎÇ¥Ïö©</label>
                <textarea class="input-field textarea-field" id="contentInput" 
                          placeholder="Ïú†ÌäúÎ∏å ÏáºÏ∏†Ïö© ÏΩòÌÖêÏ∏†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:

üìà Ìà¨Ïûê Ï¥àÎ≥¥ÏûêÎ•º ÏúÑÌïú 3Í∞ÄÏßÄ Ìô©Í∏à Î≤ïÏπô

1. Î∂ÑÏÇ∞ Ìà¨ÏûêÏùò Ìûò
- Ìïú Î∞îÍµ¨ÎãàÏóê Í≥ÑÎûÄÏùÑ Îã¥ÏßÄ ÎßàÎùº
- Ï£ºÏãù, Ï±ÑÍ∂å, Î∂ÄÎèôÏÇ∞ÏúºÎ°ú ÏúÑÌóò Î∂ÑÏÇ∞

2. Ïû•Í∏∞ Ìà¨Ïûê ÎßàÏù∏Îìú
- Î≥µÎ¶¨Ïùò ÎßàÎ≤ïÏùÑ ÎØøÏñ¥Îùº
- ÏãúÏû• ÌÉÄÏù¥Î∞çÎ≥¥Îã§ Ìà¨Ïûê Í∏∞Í∞ÑÏù¥ Ï§ëÏöî

3. Íæ∏Ï§ÄÌïú Ï†ÅÎ¶ΩÏãù Ìà¨Ïûê
- Îß§Ïõî ÏùºÏ†ï Í∏àÏï° Ìà¨Ïûê
- Îã¨Îü¨ ÏΩîÏä§Ìä∏ Ïï†Î≤ÑÎ¶¨Ïßï Ìö®Í≥º

üí° Í∏∞ÏñµÌïòÏÑ∏Ïöî: Ìà¨ÏûêÎäî ÎßàÎùºÌÜ§ÏûÖÎãàÎã§!

ÎåÄÏÉÅ: 20-30ÎåÄ Ìà¨Ïûê Ï¥àÎ≥¥Ïûê
ÌÜ§Ïï§Îß§ÎÑà: ÏπúÍ∑ºÌïòÍ≥† Ïâ¨Ïö¥ ÏÑ§Î™Ö
Î™©Ìëú: Íµ¨ÎèÖÍ≥º Ï¢ãÏïÑÏöî Ïú†ÎèÑ"></textarea>
            </div>
        </div>

        <!-- ÏáºÏ∏† ÏÉùÏÑ± Î≤ÑÌäº -->
        <div style="text-align: center; margin: 50px 0;">
            <button class="btn btn-shorts" id="generateShortsBtn" onclick="generateYouTubeShorts()" disabled>
                üöÄ Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏûêÎèô ÏÉùÏÑ±
            </button>
        </div>

        <!-- ÏáºÏ∏† ÎØ∏Î¶¨Î≥¥Í∏∞ -->
        <div class="section" id="previewSection" style="display: none;">
            <h2 class="section-title">üì± ÏáºÏ∏† ÎØ∏Î¶¨Î≥¥Í∏∞</h2>
            <div class="shorts-preview">
                <div class="canvas-container">
                    <canvas id="shortsCanvas" width="1080" height="1920"></canvas>
                </div>
            </div>
            
            <div class="video-stats" id="videoStats">
                <div class="stat-card">
                    <div class="stat-value" id="slideCount">0</div>
                    <div class="stat-label">Ïä¨ÎùºÏù¥Îìú Ïàò</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="videoDuration">0s</div>
                    <div class="stat-label">Ï¥ù Í∏∏Ïù¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">1080√ó1920</div>
                    <div class="stat-label">Ìï¥ÏÉÅÎèÑ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">30 FPS</div>
                    <div class="stat-label">ÌîÑÎ†àÏûÑÎ†àÏù¥Ìä∏</div>
                </div>
            </div>
            
            <div class="video-controls">
                <button class="btn btn-primary" onclick="previewShorts()">
                    ‚ñ∂Ô∏è ÎØ∏Î¶¨Î≥¥Í∏∞ Ïû¨ÏÉù
                </button>
                <button class="btn btn-shorts" onclick="generateShortsMP4()">
                    üé¨ MP4 ÏáºÏ∏† ÏÉùÏÑ±
                </button>
                <button class="btn btn-primary" onclick="stopPreview()">
                    ‚èπÔ∏è Ï†ïÏßÄ
                </button>
            </div>
        </div>

        <!-- Îã§Ïö¥Î°úÎìú ÏÑπÏÖò -->
        <div class="download-section" id="downloadSection">
            <h3>üéâ Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏôÑÏÑ±!</h3>
            <p style="margin-bottom: 25px; font-size: 1.2em;">
                Í≥†ÌíàÏßà MP4 ÏáºÏ∏† ÏòÅÏÉÅÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!
            </p>
            <button class="download-btn" id="downloadBtn" onclick="downloadShorts()">
                üì• ÏáºÏ∏† ÏòÅÏÉÅ Îã§Ïö¥Î°úÎìú
            </button>
            <div style="margin-top: 30px; opacity: 0.9;">
                <p><strong>‚úÖ Ïú†ÌäúÎ∏å ÏóÖÎ°úÎìú Ï§ÄÎπÑ ÏôÑÎ£å</strong></p>
                <p>‚Ä¢ ÏôÑÎ≤ΩÌïú 9:16 ÎπÑÏú® (1080√ó1920)</p>
                <p>‚Ä¢ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî Í≥†ÎåÄÎπÑ ÌÖçÏä§Ìä∏</p>
                <p>‚Ä¢ ÏãúÏÑ† ÏßëÏ§ë Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º</p>
                <p>‚Ä¢ Î∞îÎ°ú ÏóÖÎ°úÎìú Í∞ÄÎä•Ìïú MP4 ÌååÏùº</p>
            </div>
        </div>
    </div>

    <!-- ÌîÑÎ°úÍ∑∏ÎûòÏä§ Î™®Îã¨ -->
    <div class="progress-modal" id="progressModal">
        <div class="progress-content">
            <div class="progress-icon" id="progressIcon">üì±</div>
            <h3 class="progress-title" id="progressTitle">Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏÉùÏÑ± Ï§ë...</h3>
            <p id="progressDesc">GPT-4Í∞Ä ÏáºÏ∏† ÏµúÏ†ÅÌôî ÏΩòÌÖêÏ∏†Î•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§.</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="progressText" style="font-size: 1.4em; font-weight: bold; color: #ff0844;">0%</div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let apiKey = '';
        let shortsSlides = [];
        let videoBlob = null;
        let isGenerating = false;
        let canvas, ctx;
        let animationId = null;

        // DOM Î°úÎìú ÏôÑÎ£å ÌõÑ Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            initializeCanvas();
            updateGenerateButton();
        });

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupEventListeners() {
            const topicInput = document.getElementById('topicInput');
            const contentInput = document.getElementById('contentInput');
            const apiInput = document.getElementById('apiInput');

            topicInput?.addEventListener('input', updateGenerateButton);
            contentInput?.addEventListener('input', updateGenerateButton);
            
            apiInput?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    setupApiKey();
                }
            });
        }

        // Canvas Ï¥àÍ∏∞Ìôî
        function initializeCanvas() {
            canvas = document.getElementById('shortsCanvas');
            if (canvas) {
                ctx = canvas.getContext('2d');
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                
                // Ï¥àÍ∏∞ Ï∫îÎ≤ÑÏä§ ÏÑ§Ï†ï
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Î°úÍ≥† ÌëúÏãú
                ctx.fillStyle = '#ffffff';
                ctx.font = '100px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üì±', canvas.width / 2, canvas.height / 2);
                
                ctx.font = '40px Arial';
                ctx.fillText('Ïú†ÌäúÎ∏å ÏáºÏ∏† Ï§ÄÎπÑ Ï§ë...', canvas.width / 2, canvas.height / 2 + 100);
            }
        }

        // API ÌÇ§ ÏÑ§Ï†ï
        async function setupApiKey() {
            const input = document.getElementById('apiInput');
            const status = document.getElementById('apiStatus');
            
            if (!input || !status) return;
            
            const key = input.value.trim();
            
            if (!key) {
                showApiStatus('‚ùå API ÌÇ§Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            if (!key.startsWith('sk-') || key.length < 40) {
                showApiStatus('‚ùå Ïò¨Î∞îÎ•∏ OpenAI API ÌÇ§ ÌòïÏãùÏù¥ ÏïÑÎãôÎãàÎã§.', 'error');
                return;
            }
            
            try {
                const isValid = await testApiKey(key);
                if (isValid) {
                    apiKey = key;
                    showApiStatus('‚úÖ API ÌÇ§Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§!', 'success');
                    updateGenerateButton();
                } else {
                    showApiStatus('‚ùå API ÌÇ§Í∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§.', 'error');
                }
            } catch (error) {
                console.error('API ÌÇ§ ÌÖåÏä§Ìä∏ Ïò§Î•ò:', error);
                apiKey = key;
                showApiStatus('‚ö†Ô∏è API ÌÇ§Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§. (Í≤ÄÏ¶ù Ïã§Ìå®)', 'error');
                updateGenerateButton();
            }
        }

        // API ÌÇ§ ÌÖåÏä§Ìä∏
        async function testApiKey(key) {
            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    }
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // API ÏÉÅÌÉú Î©îÏãúÏßÄ
        function showApiStatus(message, type) {
            const status = document.getElementById('apiStatus');
            if (status) {
                status.textContent = message;
                status.className = `api-status ${type}`;
                status.style.display = 'block';
                
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
        }

        // ÏÉùÏÑ± Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
        function updateGenerateButton() {
            const topicInput = document.getElementById('topicInput');
            const contentInput = document.getElementById('contentInput');
            const generateBtn = document.getElementById('generateShortsBtn');
            
            if (!topicInput || !contentInput || !generateBtn) return;
            
            const topic = topicInput.value.trim();
            const content = contentInput.value.trim();
            
            generateBtn.disabled = !(apiKey && topic && content);
        }

        // Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏÉùÏÑ± Î©îÏù∏ Ìï®Ïàò
        async function generateYouTubeShorts() {
            if (isGenerating) return;
            
            const topicInput = document.getElementById('topicInput');
            const contentInput = document.getElementById('contentInput');
            
            if (!topicInput || !contentInput) return;
            
            const topic = topicInput.value.trim();
            const content = contentInput.value.trim();
            
            if (!apiKey || !topic || !content) {
                alert('‚ùå API ÌÇ§, Ï£ºÏ†ú, ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            isGenerating = true;
            showProgressModal(true);
            
            try {
                // 1Îã®Í≥Ñ: GPTÎ°ú Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏµúÏ†ÅÌôî Ïä¨ÎùºÏù¥Îìú ÏÉùÏÑ±
                updateProgress(20, 'üß† ÏáºÏ∏† ÏΩòÌÖêÏ∏† Î∂ÑÏÑù', 'GPT-4Í∞Ä Ïú†ÌäúÎ∏å ÏáºÏ∏†Ïóê ÏµúÏ†ÅÌôîÎêú ÏΩòÌÖêÏ∏†Î•º ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
                const slides = await generateShortsSlides(topic, content);
                
                if (!slides || slides.length === 0) {
                    throw new Error('ÏáºÏ∏† Ïä¨ÎùºÏù¥Îìú ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
                
                shortsSlides = slides;
                
                // 2Îã®Í≥Ñ: ÏáºÏ∏† ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                updateProgress(40, 'üìä ÏáºÏ∏† ÏÑ§Ï†ï', 'Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏµúÏ†ÅÌôî ÏÑ§Ï†ïÏùÑ Ï†ÅÏö©ÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
                updateShortsStats(slides);
                
                // 3Îã®Í≥Ñ: Canvas Î†åÎçîÎßÅ Ï§ÄÎπÑ
                updateProgress(60, 'üé® ÎπÑÏ£ºÏñº Ï§ÄÎπÑ', 'ÏáºÏ∏† ÎπÑÏ£ºÏñº ÏöîÏÜåÎ•º Ï§ÄÎπÑÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
                await delay(500);
                
                // 4Îã®Í≥Ñ: Ï≤´ Î≤àÏß∏ Ïä¨ÎùºÏù¥Îìú Î†åÎçîÎßÅ
                updateProgress(80, 'üì± Ï≤´ ÌôîÎ©¥ Î†åÎçîÎßÅ', 'ÏáºÏ∏† Ï≤´ ÌôîÎ©¥ÏùÑ Î†åÎçîÎßÅÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
                await renderSlideToCanvas(0);
                
                updateProgress(100, 'üéâ ÏôÑÏÑ±!', 'Ïú†ÌäúÎ∏å ÏáºÏ∏†Í∞Ä Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
                await delay(1000);
                
                showProgressModal(false);
                showPreviewSection();
                
            } catch (error) {
                console.error('Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏÉùÏÑ± Ïò§Î•ò:', error);
                showProgressModal(false);
                alert('‚ùå Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
            } finally {
                isGenerating = false;
            }
        }

        // GPTÎ°ú Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏµúÏ†ÅÌôî Ïä¨ÎùºÏù¥Îìú ÏÉùÏÑ±
        async function generateShortsSlides(topic, content) {
            const prompt = `Îã§Ïùå ÎÇ¥Ïö©ÏùÑ Ïú†ÌäúÎ∏å ÏáºÏ∏†Ïóê ÏµúÏ†ÅÌôîÎêú Ïä¨ÎùºÏù¥ÎìúÎ°ú Î≥ÄÌôòÌï¥Ï£ºÏÑ∏Ïöî:

Ï£ºÏ†ú: ${topic}

ÎÇ¥Ïö©:
${content}

Ïú†ÌäúÎ∏å ÏáºÏ∏† ÏµúÏ†ÅÌôî ÏöîÍµ¨ÏÇ¨Ìï≠:
- Ïä¨ÎùºÏù¥Îìú Í∞úÏàò: 12-15Í∞ú (Ï¥ù 30-45Ï¥à Í∏∏Ïù¥)
- Ï≤´ Ïä¨ÎùºÏù¥Îìú: Í∞ïÎ†•Ìïú Hook (ÏãúÏÑ† ÏßëÏ§ë)
- Í∞Å Ïä¨ÎùºÏù¥Îìú: 2-3Ï¥à ÏïàÏóê Ïù¥Ìï¥ Í∞ÄÎä•Ìïú Í∞ÑÎã®Ìïú Î©îÏãúÏßÄ
- ÎßàÏßÄÎßâ Ïä¨ÎùºÏù¥Îìú: CTA (Íµ¨ÎèÖ, Ï¢ãÏïÑÏöî Ïú†ÎèÑ)
- Î™®Î∞îÏùºÏóêÏÑú ÏùΩÍ∏∞ Ïâ¨Ïö¥ ÌÅ∞ ÌÖçÏä§Ìä∏
- Í∞Å Ïä¨ÎùºÏù¥ÎìúÎßàÎã§ ÏãúÏÑ†ÏùÑ ÎÅÑÎäî Ïù¥Î™®ÏßÄ Ìè¨Ìï®
- Î∞ùÍ≥† ÎåÄÎπÑÍ∞Ä Í∞ïÌïú ÏÉâÏÉÅ ÏÇ¨Ïö©

Îã§Ïùå JSON ÌòïÏãùÏúºÎ°ú Ï†ïÌôïÌûà ÏùëÎãµÌï¥Ï£ºÏÑ∏Ïöî:
{
  "slides": [
    {
      "id": 1,
      "icon": "üî•",
      "title": "3Ï¥àÎßåÏóê Î∞∞Ïö∞Îäî",
      "subtitle": "Ìà¨Ïûê ÎπÑÎ≤ï Í≥µÍ∞ú!",
      "type": "hook",
      "backgroundColor": "#ff0844",
      "textColor": "#ffffff",
      "duration": 3
    }
  ]
}

type: hook(Ï≤´Ïä¨ÎùºÏù¥Îìú), content(ÎÇ¥Ïö©), highlight(Í∞ïÏ°∞), cta(Íµ¨ÎèÖÏú†ÎèÑ)
duration: Í∞Å Ïä¨ÎùºÏù¥Îìú ÎÖ∏Ï∂ú ÏãúÍ∞Ñ (Ï¥à)`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: [
                            {
                                role: "system",
                                content: "ÎãπÏã†ÏùÄ Ïú†ÌäúÎ∏å ÏáºÏ∏† Ï†úÏûë Ï†ÑÎ¨∏Í∞ÄÏûÖÎãàÎã§. Î™®Î∞îÏùº ÌôòÍ≤ΩÏóêÏÑú ÏãúÏ≤≠ÏûêÏùò Ï£ºÏùòÎ•º ÎÅåÍ≥† ÎÅùÍπåÏßÄ Î≥¥Í≤å ÎßåÎìúÎäî ÏΩòÌÖêÏ∏†Î•º ÎßåÎì≠ÎãàÎã§. Î∞òÎìúÏãú Ïú†Ìö®Ìïú JSON ÌòïÏãùÏúºÎ°úÎßå ÏùëÎãµÌïòÏÑ∏Ïöî."
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.8,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    throw new Error(`GPT API Ïò§Î•ò: ${response.status}`);
                }

                const data = await response.json();
                const content = data.choices[0]?.message?.content;
                
                if (!content) {
                    throw new Error('GPT ÏùëÎãµÏù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.');
                }

                try {
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) {
                        throw new Error('JSON ÌòïÏãùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                    
                    const parsed = JSON.parse(jsonMatch[0]);
                    return parsed.slides || [];
                } catch (parseError) {
                    console.error('JSON ÌååÏã± Ïò§Î•ò:', parseError);
                    throw new Error('JSON ÌååÏã±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }

            } catch (error) {
                console.error('GPT ÏáºÏ∏† Ïä¨ÎùºÏù¥Îìú ÏÉùÏÑ± Ïò§Î•ò:', error);
                throw error;
            }
        }

        // ÏáºÏ∏† ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateShortsStats(slides) {
            const slideCountEl = document.getElementById('slideCount');
            const videoDurationEl = document.getElementById('videoDuration');
            
            if (slideCountEl) {
                slideCountEl.textContent = slides.length;
            }
            
            if (videoDurationEl) {
                const totalDuration = slides.reduce((sum, slide) => sum + (slide.duration || 3), 0);
                videoDurationEl.textContent = `${totalDuration}s`;
            }
        }

        // CanvasÏóê ÌôòÏÉÅÏ†ÅÏù∏ Î∞∞Í≤Ω Ìö®Í≥ºÏôÄ Ïä¨ÎùºÏù¥Îìú Î†åÎçîÎßÅ
        async function renderSlideToCanvas(slideIndex) {
            if (!ctx || !shortsSlides[slideIndex]) return;
            
            const slide = shortsSlides[slideIndex];
            const width = canvas.width;
            const height = canvas.height;
            
            // Î∞∞Í≤Ω ÌÅ¥Î¶¨Ïñ¥
            ctx.clearRect(0, 0, width, height);
            
            // 1. ÌôòÏÉÅÏ†ÅÏù∏ Í∑∏ÎùºÎç∞Ïù¥ÏÖò Î∞∞Í≤Ω
            const bgColor = slide.backgroundColor || '#667eea';
            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, Math.max(width, height));
            gradient.addColorStop(0, bgColor);
            gradient.addColorStop(0.7, adjustBrightness(bgColor, -20));
            gradient.addColorStop(1, adjustBrightness(bgColor, -40));
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // 2. ÎèôÏ†Å Ìå®ÌÑ¥ Ïò§Î≤ÑÎ†àÏù¥
            drawAnimatedPattern(slideIndex);
            
            // 3. Í∏ÄÎ°úÏö∞ Ìö®Í≥º
            drawGlowEffects(slideIndex);
            
            // 4. ÌÖçÏä§Ìä∏ Î†åÎçîÎßÅ
            renderSlideText(slide, slideIndex);
        }

        // Î∞ùÍ∏∞ Ï°∞Ï†à Ìï®Ïàò
        function adjustBrightness(hex, amount) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * amount);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        // ÌôòÏÉÅÏ†ÅÏù∏ Ïï†ÎãàÎ©îÏù¥ÏÖò Ìå®ÌÑ¥
        function drawAnimatedPattern(slideIndex) {
            const width = canvas.width;
            const height = canvas.height;
            const time = Date.now() * 0.001;
            
            ctx.globalAlpha = 0.15;
            
            // Ìå®ÌÑ¥ ÌÉÄÏûÖÎ≥Ñ Îã§Î•∏ Ìö®Í≥º
            const patternType = slideIndex % 5;
            
            switch(patternType) {
                case 0: // ÌöåÏ†ÑÌïòÎäî ÏõêÎì§
                    for (let i = 0; i < 8; i++) {
                        const angle = (time + i * 0.5) * 0.5;
                        const x = width/2 + Math.cos(angle) * (width * 0.3);
                        const y = height/2 + Math.sin(angle) * (height * 0.2);
                        const radius = 50 + Math.sin(time + i) * 20;
                        
                        const circleGradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
                        circleGradient.addColorStop(0, 'rgba(255,255,255,0.3)');
                        circleGradient.addColorStop(1, 'rgba(255,255,255,0)');
                        
                        ctx.fillStyle = circleGradient;
                        ctx.beginPath();
                        ctx.arc(x, y, radius, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    break;
                    
                case 1: // Ïõ®Ïù¥Î∏å ÎùºÏù∏Îì§
                    ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                    ctx.lineWidth = 3;
                    for (let i = 0; i < 6; i++) {
                        ctx.beginPath();
                        for (let x = 0; x <= width; x += 10) {
                            const y = height/2 + Math.sin((x + time * 100 + i * 50) * 0.01) * (100 + i * 20);
                            if (x === 0) ctx.moveTo(x, y);
                            else ctx.lineTo(x, y);
                        }
                        ctx.stroke();
                    }
                    break;
                    
                case 2: // Ïú°Í∞ÅÌòï Í∑∏Î¶¨Îìú
                    const hexSize = 60;
                    for (let row = 0; row < height / hexSize + 2; row++) {
                        for (let col = 0; col < width / hexSize + 2; col++) {
                            const x = col * hexSize * 0.75 - hexSize;
                            const y = row * hexSize - (col % 2) * hexSize * 0.5 - hexSize;
                            const alpha = Math.sin(time + row * 0.5 + col * 0.3) * 0.1 + 0.1;
                            
                            ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
                            ctx.lineWidth = 2;
                            drawHexagon(x, y, hexSize * 0.4);
                        }
                    }
                    break;
                    
                case 3: // ÌååÌã∞ÌÅ¥ Ìö®Í≥º
                    for (let i = 0; i < 30; i++) {
                        const x = (Math.sin(time * 0.5 + i * 0.2) * width * 0.3) + width/2;
                        const y = (Math.cos(time * 0.3 + i * 0.15) * height * 0.3) + height/2;
                        const size = Math.sin(time + i) * 3 + 5;
                        
                        const particleGradient = ctx.createRadialGradient(x, y, 0, x, y, size);
                        particleGradient.addColorStop(0, 'rgba(255,255,255,0.6)');
                        particleGradient.addColorStop(1, 'rgba(255,255,255,0)');
                        
                        ctx.fillStyle = particleGradient;
                        ctx.beginPath();
                        ctx.arc(x, y, size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    break;
                    
                case 4: // Í∏∞ÌïòÌïôÏ†Å ÏÇºÍ∞ÅÌòï
                    for (let i = 0; i < 12; i++) {
                        const angle = (time + i * 0.5) * 0.3;
                        const x = width/2 + Math.cos(angle) * (width * 0.25);
                        const y = height/2 + Math.sin(angle) * (height * 0.25);
                        const size = 40 + Math.sin(time * 2 + i) * 15;
                        
                        ctx.strokeStyle = `rgba(255,255,255,0.2)`;
                        ctx.lineWidth = 2;
                        drawTriangle(x, y, size, angle);
                    }
                    break;
            }
            
            ctx.globalAlpha = 1;
        }

        // Ïú°Í∞ÅÌòï Í∑∏Î¶¨Í∏∞
        function drawHexagon(x, y, size) {
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = (i * Math.PI) / 3;
                const px = x + Math.cos(angle) * size;
                const py = y + Math.sin(angle) * size;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.stroke();
        }

        // ÏÇºÍ∞ÅÌòï Í∑∏Î¶¨Í∏∞
        function drawTriangle(x, y, size, rotation) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.beginPath();
            ctx.moveTo(0, -size);
            ctx.lineTo(-size * 0.866, size * 0.5);
            ctx.lineTo(size * 0.866, size * 0.5);
            ctx.closePath();
            ctx.stroke();
            ctx.restore();
        }

        // Í∏ÄÎ°úÏö∞ Ìö®Í≥º
        function drawGlowEffects(slideIndex) {
            const width = canvas.width;
            const height = canvas.height;
            const time = Date.now() * 0.001;
            
            ctx.globalAlpha = 0.1;
            
            // ÏΩîÎÑà Í∏ÄÎ°úÏö∞
            const corners = [
                {x: 0, y: 0},
                {x: width, y: 0},
                {x: 0, y: height},
                {x: width, y: height}
            ];
            
            corners.forEach((corner, i) => {
                const intensity = Math.sin(time + i * 1.5) * 0.5 + 0.5;
                const glowGradient = ctx.createRadialGradient(
                    corner.x, corner.y, 0,
                    corner.x, corner.y, Math.min(width, height) * 0.5
                );
                glowGradient.addColorStop(0, `rgba(255,255,255,${intensity * 0.3})`);
                glowGradient.addColorStop(1, 'rgba(255,255,255,0)');
                
                ctx.fillStyle = glowGradient;
                ctx.fillRect(0, 0, width, height);
            });
            
            ctx.globalAlpha = 1;
        }

        // ÌÖçÏä§Ìä∏ Î†åÎçîÎßÅ (Î∂ÑÎ¶¨Îêú Ìï®Ïàò)
        function renderSlideText(slide, slideIndex) {
            const width = canvas.width;
            const height = canvas.height;
            
            // ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ
            const textColor = slide.textColor || '#ffffff';
            ctx.fillStyle = textColor;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Í∞ïÌôîÎêú Í∑∏Î¶ºÏûê Ìö®Í≥º
            ctx.shadowColor = 'rgba(0,0,0,0.9)';
            ctx.shadowBlur = 25;
            ctx.shadowOffsetX = 4;
            ctx.shadowOffsetY = 4;
            
            // ÏïÑÏù¥ÏΩò (Îçî ÌÅ¨Í≥† Í∏ÄÎ°úÏö∞ Ìö®Í≥º)
            ctx.font = `${height * 0.12}px Arial`;
            
            // ÏïÑÏù¥ÏΩò Í∏ÄÎ°úÏö∞ Ìö®Í≥º
            ctx.shadowColor = 'rgba(255,255,255,0.8)';
            ctx.shadowBlur = 30;
            ctx.fillText(slide.icon || 'üì±', width / 2, height * 0.25);
            
            // Í∑∏Î¶ºÏûê Î¶¨ÏÖã
            ctx.shadowColor = 'rgba(0,0,0,0.9)';
            ctx.shadowBlur = 25;
            
            // Ï†úÎ™© (Ïú†ÌäúÎ∏å ÏáºÏ∏†Ïö© ÌÅ∞ ÌÖçÏä§Ìä∏)
            ctx.font = `bold ${height * 0.06}px Arial Black`;
            const titleLines = wrapText(slide.title, width * 0.85);
            let titleY = height * 0.45;
            
            titleLines.forEach((line, i) => {
                ctx.fillText(line, width / 2, titleY + (i * height * 0.07));
            });
            
            // Î∂ÄÏ†úÎ™©
            ctx.font = `${height * 0.035}px Arial`;
            ctx.fillStyle = textColor === '#ffffff' ? 'rgba(255,255,255,0.95)' : 'rgba(0,0,0,0.8)';
            const subtitleLines = wrapText(slide.subtitle, width * 0.9);
            let subtitleY = height * 0.7;
            
            subtitleLines.forEach((line, i) => {
                ctx.fillText(line, width / 2, subtitleY + (i * height * 0.04));
            });
            
            // ÌÉÄÏûÖÎ≥Ñ ÌäπÎ≥Ñ Ìö®Í≥º
            if (slide.type === 'hook') {
                // Hook Ïä¨ÎùºÏù¥ÎìúÏóê ÌéÑÏã± ÌÖåÎëêÎ¶¨ Ìö®Í≥º
                const time = Date.now() * 0.005;
                const pulseIntensity = Math.sin(time) * 0.5 + 0.5;
                
                ctx.strokeStyle = `rgba(255, 255, 0, ${pulseIntensity})`;
                ctx.lineWidth = 8 + pulseIntensity * 4;
                ctx.strokeRect(20, 20, width - 40, height - 40);
                
                // ÎÇ¥Î∂Ä Í∏ÄÎ°úÏö∞
                ctx.strokeStyle = `rgba(255, 255, 255, ${pulseIntensity * 0.3})`;
                ctx.lineWidth = 2;
                ctx.strokeRect(30, 30, width - 60, height - 60);
                
            } else if (slide.type === 'cta') {
                // CTA Ïä¨ÎùºÏù¥ÎìúÏóê Ïï†ÎãàÎ©îÏù¥ÏÖò Î≤ÑÌäº
                const buttonY = height * 0.85;
                const buttonWidth = width * 0.7;
                const buttonHeight = height * 0.08;
                const time = Date.now() * 0.003;
                const pulse = Math.sin(time) * 0.2 + 1;
                
                // Î≤ÑÌäº Í∏ÄÎ°úÏö∞
                const buttonGradient = ctx.createRadialGradient(
                    width/2, buttonY, 0,
                    width/2, buttonY, buttonWidth * 0.7
                );
                buttonGradient.addColorStop(0, '#ff0844');
                buttonGradient.addColorStop(1, '#ff6b95');
                
                ctx.fillStyle = buttonGradient;
                ctx.fillRect(
                    (width - buttonWidth * pulse) / 2, 
                    buttonY - (buttonHeight * pulse) / 2, 
                    buttonWidth * pulse, 
                    buttonHeight * pulse
                );
                
                ctx.fillStyle = '#ffffff';
                ctx.font = `bold ${height * 0.03}px Arial`;
                ctx.shadowBlur = 15;
                ctx.fillText('Íµ¨ÎèÖ & Ï¢ãÏïÑÏöî!', width / 2, buttonY);
            }
            
            // Í∑∏Î¶ºÏûê Ï†úÍ±∞
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }

        // ÌÖçÏä§Ìä∏ Ï§ÑÎ∞îÍøà (ÏáºÏ∏† ÏµúÏ†ÅÌôî)
        function wrapText(text, maxWidth) {
            if (!text) return [''];
            
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0] || '';
            
            for (let i = 1; i < words.length; i++) {
                const testLine = currentLine + ' ' + words[i];
                const testWidth = ctx.measureText(testLine).width;
                
                if (testWidth > maxWidth) {
                    lines.push(currentLine);
                    currentLine = words[i];
                } else {
                    currentLine = testLine;
                }
            }
            lines.push(currentLine);
            
            // ÏáºÏ∏†Îäî ÏµúÎåÄ 3Ï§ÑÍπåÏßÄÎßå
            return lines.slice(0, 3);
        }

        // ÏáºÏ∏† ÎØ∏Î¶¨Î≥¥Í∏∞
        async function previewShorts() {
            if (!shortsSlides || shortsSlides.length === 0) return;
            
            stopPreview(); // Í∏∞Ï°¥ ÎØ∏Î¶¨Î≥¥Í∏∞ Ï†ïÏßÄ
            
            let currentSlide = 0;
            let startTime = Date.now();
            
            async function animate() {
                const slide = shortsSlides[currentSlide];
                const duration = (slide.duration || 3) * 1000; // ms Î≥ÄÌôò
                const elapsed = Date.now() - startTime;
                
                if (elapsed >= duration) {
                    currentSlide = (currentSlide + 1) % shortsSlides.length;
                    startTime = Date.now();
                    await renderSlideToCanvas(currentSlide);
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            await renderSlideToCanvas(0);
            animate();
        }

        // ÎØ∏Î¶¨Î≥¥Í∏∞ Ï†ïÏßÄ
        function stopPreview() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // ÏáºÏ∏† MP4 ÏÉùÏÑ±
        async function generateShortsMP4() {
            if (!canvas || !shortsSlides || shortsSlides.length === 0) {
                alert('‚ùå Î®ºÏ†Ä ÏáºÏ∏†Î•º ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            try {
                showProgressModal(true);
                updateProgress(10, 'üé¨ ÏáºÏ∏† MP4 Ï§ÄÎπÑ', 'Í≥†ÌíàÏßà Ïú†ÌäúÎ∏å ÏáºÏ∏† MP4 ÏÉùÏÑ±ÏùÑ ÏãúÏûëÌï©ÎãàÎã§.');
                
                // Canvas Ïä§Ìä∏Î¶º ÏÉùÏÑ±
                const stream = canvas.captureStream(30);
                
                let mimeType = 'video/webm;codecs=vp9';
                let videoBitrate = 8000000; // 8Mbps (ÏáºÏ∏† ÏµúÏ†ÅÌôî)
                
                if (!MediaRecorder.isTypeSupported(mimeType)) {
                    mimeType = 'video/webm;codecs=vp8';
                    videoBitrate = 5000000;
                }
                
                const mediaRecorder = new MediaRecorder(stream, {
                    mimeType: mimeType,
                    videoBitsPerSecond: videoBitrate
                });
                
                const chunks = [];
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        chunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    videoBlob = new Blob(chunks, { type: mimeType });
                    showProgressModal(false);
                    showDownloadSection();
                };
                
                updateProgress(25, 'üìπ ÎÖπÌôî ÏãúÏûë', 'Í∞Å Ïä¨ÎùºÏù¥ÎìúÎ•º ÏàúÏ∞®Ï†ÅÏúºÎ°ú ÎÖπÌôîÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
                mediaRecorder.start(100);
                
                // Í∞Å Ïä¨ÎùºÏù¥Îìú Î†åÎçîÎßÅ
                for (let i = 0; i < shortsSlides.length; i++) {
                    const slide = shortsSlides[i];
                    const progress = 25 + (i / shortsSlides.length) * 65;
                    
                    updateProgress(progress, `üì± Ïä¨ÎùºÏù¥Îìú ${i + 1} ÎÖπÌôî`, `"${slide.title}" Ïä¨ÎùºÏù¥ÎìúÎ•º ÎÖπÌôîÌïòÍ≥† ÏûàÏäµÎãàÎã§.`);
                    
                    await renderSlideToCanvas(i);
                    
                    // Ïä¨ÎùºÏù¥Îìú ÏßÄÏÜçÏãúÍ∞ÑÎßåÌÅº ÎåÄÍ∏∞
                    const duration = (slide.duration || 3) * 1000;
                    await delay(duration);
                }
                
                updateProgress(95, 'üèÅ ÎßàÎ¨¥Î¶¨', 'ÏáºÏ∏† ÎπÑÎîîÏò§Î•º ÏµúÏ¢Ö Ï≤òÎ¶¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
                mediaRecorder.stop();
                
            } catch (error) {
                console.error('ÏáºÏ∏† MP4 ÏÉùÏÑ± Ïò§Î•ò:', error);
                showProgressModal(false);
                alert('‚ùå ÏáºÏ∏† MP4 ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
            }
        }

        // ÏáºÏ∏† Îã§Ïö¥Î°úÎìú
        function downloadShorts() {
            if (!videoBlob) {
                alert('‚ùå ÏÉùÏÑ±Îêú ÏáºÏ∏† ÎπÑÎîîÏò§Í∞Ä ÏóÜÏäµÎãàÎã§!');
                return;
            }
            
            const url = URL.createObjectURL(videoBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `youtube-shorts-${new Date().getTime()}.webm`;
            a.click();
            
            URL.revokeObjectURL(url);
            
            const fileSize = Math.round(videoBlob.size / 1024 / 1024 * 100) / 100;
            
            alert(`üéâ Ïú†ÌäúÎ∏å ÏáºÏ∏† Îã§Ïö¥Î°úÎìú ÏôÑÎ£å!

üìä ÌååÏùº Ï†ïÎ≥¥:
‚Ä¢ ÌååÏùºÎ™Ö: youtube-shorts-${new Date().getTime()}.webm
‚Ä¢ ÌÅ¨Í∏∞: ${fileSize} MB
‚Ä¢ Ìï¥ÏÉÅÎèÑ: 1080√ó1920 (ÏôÑÎ≤ΩÌïú 9:16 ÎπÑÏú®)
‚Ä¢ Í∏∏Ïù¥: ${shortsSlides.reduce((sum, s) => sum + (s.duration || 3), 0)}Ï¥à

üöÄ Î∞îÎ°ú Ïú†ÌäúÎ∏åÏóê ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî!
Î™®Î∞îÏùºÏóê ÏµúÏ†ÅÌôîÎêú Í≥†ÌíàÏßà ÏáºÏ∏†ÏûÖÎãàÎã§.`);
        }

        // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÑπÏÖò ÌëúÏãú
        function showPreviewSection() {
            const section = document.getElementById('previewSection');
            if (section) {
                section.style.display = 'block';
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Îã§Ïö¥Î°úÎìú ÏÑπÏÖò ÌëúÏãú
        function showDownloadSection() {
            const section = document.getElementById('downloadSection');
            if (section) {
                section.style.display = 'block';
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ÌîÑÎ°úÍ∑∏ÎûòÏä§ Î™®Îã¨ Ï†úÏñ¥
        function showProgressModal(show) {
            const modal = document.getElementById('progressModal');
            if (modal) {
                modal.classList.toggle('show', show);
            }
        }

        // ÌîÑÎ°úÍ∑∏ÎûòÏä§ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress(percent, title, desc) {
            const fill = document.getElementById('progressFill');
            const text = document.getElementById('progressText');
            const titleEl = document.getElementById('progressTitle');
            const descEl = document.getElementById('progressDesc');
            
            if (fill) fill.style.width = `${Math.min(100, percent)}%`;
            if (text) text.textContent = `${Math.round(percent)}%`;
            if (titleEl) titleEl.textContent = title;
            if (descEl) descEl.textContent = desc;
        }

        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ÏóêÎü¨ Ï≤òÎ¶¨
        window.addEventListener('error', function(event) {
            console.error('Ï†ÑÏó≠ Ïò§Î•ò:', event.error);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Promise Í±∞Î∂Ä:', event.reason);
            event.preventDefault();
        });
    </script>
</body>
</html>
